(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[828],{53994:(G,q,m)=>{var d={"./copy-row-action.svg":40038,"./delete-row-action.svg":77896,"./edit-row-action.svg":80525};function M(b){var k=$(b);return m(k)}function $(b){if(!m.o(d,b)){var k=new Error("Cannot find module '"+b+"'");throw k.code="MODULE_NOT_FOUND",k}return d[b]}M.keys=function(){return Object.keys(d)},M.resolve=$,G.exports=M,M.id=53994},84829:(G,q,m)=>{"use strict";m.d(q,{X:()=>ee,t:()=>M});var d=m(36599);const M=new d.InjectionToken("I18nTranslatesToken");var $=m(75629),b=m(75079),k=m(33376),c=m(13528);let x=(()=>{class C{constructor(I,_){this._translateService=I,this._i18nTranslates=_,this._destroyed$=new k.Subject,this._init()}_init(){this._subscribe(),this._initDefaultLanguage()}_initDefaultLanguage(){const I=this._translateService.currentLang,_=this._translateService.defaultLang,j=I||_;j&&this._addTranslates(j)}_subscribe(){(0,k.merge)(this._translateService.onLangChange,this._translateService.onDefaultLangChange).pipe((0,c.R)(this._destroyed$)).subscribe(I=>this._addTranslates(I.lang))}_addTranslates(I){const _=(0,b.Z)(this._i18nTranslates),j=this._translateService.defaultLang;_.forEach(P=>{const V=P[I],F=P[j];this._translateService.setTranslation(I,V,!0),this._translateService.setTranslation(j,F,!0)})}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}}return C.\u0275fac=function(I){return new(I||C)(d.\u0275\u0275inject($.sK),d.\u0275\u0275inject(M))},C.\u0275prov=d.\u0275\u0275defineInjectable({token:C,factory:C.\u0275fac}),C})(),ee=(()=>{class C{constructor(I){this._crtLibTranslateService=I}static forRoot(I){return{ngModule:C,providers:[{multi:!0,provide:M,useValue:I.i18n},x]}}}return C.\u0275fac=function(I){return new(I||C)(d.\u0275\u0275inject(x))},C.\u0275mod=d.\u0275\u0275defineNgModule({type:C}),C.\u0275inj=d.\u0275\u0275defineInjector({imports:[$.aw]}),C})();(function(){(typeof ngJitMode>"u"||ngJitMode)&&d.\u0275\u0275setNgModuleScope(ee,{exports:[$.aw]})})()},91828:(G,q,m)=>{"use strict";m.r(q),m.d(q,{BasePageComponent:()=>J,CardComponent:()=>We,HomePageComponent:()=>Je,PageComponent:()=>Ye,SchemaViewModule:()=>L,SectionComponent:()=>Ke});var d=m(64762),M=m(30660),$=m(37686),b=m(1659),k=m(21278),c=m(55069),x=m(75629),ee=m(93555),C=m(23664),X=m(73715),I=m(84829),_=m(12182),j=m(34349),P=m(94881),V=m(58377),F=m(92826),H=m(72405),g=m(16724),u=m(34553),f=m(69678),v=m(33376),s=m(36599);let mt=(()=>{class i{constructor(e,r){this._macrosHandlerService=e,this._metadataModifierService=r,this._macrosName="ResourceString"}crtOnMetaDataInit(e){var r=this;return(0,u.Z)(function*(){return(0,v.lastValueFrom)(r._macrosHandlerService.handleMarcos(r._macrosName,e,e.resources,{setPropertyFn:a=>r._metadataModifierService.updateProperty(a)}),{defaultValue:null})})()}crtOnViewModelInit(e,r,a){var n=this;return(0,u.Z)(function*(){return(0,v.lastValueFrom)(n._macrosHandlerService.handleMarcos(n._macrosName,e,a.Resources,{setPropertyFn:o=>n._metadataModifierService.updateProperty(o)}),{defaultValue:null})})()}}return i.\u0275fac=function(e){return new(e||i)(s.\u0275\u0275inject(f.p78),s.\u0275\u0275inject(g.pi))},i.\u0275prov=s.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac}),i})(),pt=(()=>{class i{_setPrimaryDataSource(e){e.modelConfig&&(e.modelConfig.primaryDataSourceName=(0,H.kC)(e))}_setScopes(e){(0,H.Fy)(e)}crtOnMetaDataInit(e){var r=this;return(0,u.Z)(function*(){const a=e;return r._setPrimaryDataSource(a),r._setScopes(a),e})()}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=s.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac}),i})(),gt=(()=>{class i{constructor(e,r){this._macrosHandlerService=e,this._metadataModifierService=r,this._macrosName="DataSourceSchemaName"}crtOnMetaDataInit(e){var r=this;return(0,u.Z)(function*(){return(0,v.lastValueFrom)(r._macrosHandlerService.handleMarcos(r._macrosName,e,e,{setPropertyFn:a=>r._metadataModifierService.updateProperty(a)}),{defaultValue:null})})()}}return i.\u0275fac=function(e){return new(e||i)(s.\u0275\u0275inject(f.p78),s.\u0275\u0275inject(g.pi))},i.\u0275prov=s.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac}),i})(),vt=(()=>{class i{constructor(e){this._featureService=e,this._autoBindToDisabled="AutoBindToDisabled",this._readonlyPropertyName="readonly"}get isProcessingDisabled(){return(0,v.lastValueFrom)(this._featureService.getFeatureState(this._autoBindToDisabled))}crtOnMetaDataInit(e){var r=this;return(0,u.Z)(function*(){if(yield r.isProcessingDisabled)return e;const a=e;return f.AXp.getViewConfigInfoByFilter(o=>(0,c.isComponentPropertyBindable)(o.type,r._readonlyPropertyName),a.viewConfig).forEach(({viewConfig:o})=>{Object.prototype.hasOwnProperty.call(o,"readonly")||(Object.prototype.hasOwnProperty.call(o,"disabled")?o.readonly=o.disabled:o.readonly=!1)}),e})()}}return i.\u0275fac=function(e){return new(e||i)(s.\u0275\u0275inject(_.UZ))},i.\u0275prov=s.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac}),i})(),yt=(()=>{class i{constructor(e){this._featureService=e,this._autoBindToDisabled="AutoBindToDisabled"}get isProcessingDisabled(){return(0,v.lastValueFrom)(this._featureService.getFeatureState(this._autoBindToDisabled))}_setAttributeViewItemName(e,r,a){const n=r.replace("$",""),o=e.viewModelConfig.attributes||{};o[n]={...o[n],viewItemName:a},e.viewModelConfig.attributes=o}_createPropertiesBindingAttribute(e,r){const a=e.viewModelConfig.attributes||{};a[r]={},e.viewModelConfig.attributes=a}_processViewConfigBinding(e,r){const a=c.ViewElementRegistry.getFormControlRelatesAttribute(r.type);if(a!==null&&r[a]){const n=r[a];this._setAttributeViewItemName(e,n,r.name),r.bindTo=n}else{const n=(0,f.AJf)(r.name);this._createPropertiesBindingAttribute(e,n),r.bindTo=`$${n}`}}crtOnMetaDataInit(e){var r=this;return(0,u.Z)(function*(){if(yield r.isProcessingDisabled)return e;const a=e,n=a.viewConfig;return f.AXp.getViewConfigInfoByFilter(l=>!!l.name,n).forEach(({viewConfig:l})=>{l.bindTo||r._processViewConfigBinding(a,l),Object.prototype.hasOwnProperty.call(l,"visible")||(l.visible=!0)}),e})()}}return i.\u0275fac=function(e){return new(e||i)(s.\u0275\u0275inject(_.UZ))},i.\u0275prov=s.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac}),i})();var de=m(66466),O=m(27969),A=m(61528),w=m(98168),qe=m(54882),ue=m(13528),ft=m(37470),St=m(74970);let W=(()=>{class i extends F.c6{constructor(){super(...arguments),this._schemaConverters=new Map}get(e){return this._schemaConverters.has(e)?this._schemaConverters.get(e):super.get(e)}register(e,r){(0,c.checkTypeNameFormat)(e,"ConverterTypeName"),(0,c.checkCrtTypeNamePascalCase)(e),this._schemaConverters.set(e,new r)}clear(){this.clearSchemaConverters(),super.clear()}clearSchemaConverters(){this._schemaConverters.clear()}}return i.\u0275fac=function(){let t;return function(r){return(t||(t=s.\u0275\u0275getInheritedFactory(i)))(r||i)}}(),i.\u0275prov=s.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac}),i})();var Ct=m(7403);let he=(()=>{class i{constructor(e,r,a,n,o,l,h){this.viewModelGenerator=e,this.modelGenerator=r,this.schemaConverterRegistry=a,this.schemaValidatorFactory=n,this.schemaValidatorTypeResolver=o,this.schemaValidatorRegistryService=l,this.metadataPreprocessorService=h}_init(e,r){return this.registerSchemaElements(e),r().pipe((0,O.U)(([a,n,o])=>({schema:a,models:n,viewModel:o})))}_preprocessOnMetadataInit(e){return(0,v.from)(this.metadataPreprocessorService.onMetaDataInit(e))}_preprocessOnModelInit(e,r){return(0,v.from)(this.metadataPreprocessorService.onModelInit(e,r))}_preprocessOnViewModelInit(e,r,a){return(0,v.from)(this.metadataPreprocessorService.onViewModelInit(e,r,a))}_generateModel(e){return e.modelConfig?this.modelGenerator.generate(e.modelConfig):(0,v.of)([])}_generateViewModel(e,r,a,n){var o;return this.viewModelGenerator.generate({viewModelConfig:e.viewModelConfig,modelConfig:e.modelConfig,resources:e.resources,models:r,scopes:((o=e.tag)===null||o===void 0?void 0:o.split("."))||[],modelInitConfigs:a,handlers:e.handlers,schemaName:n},[{provide:g.Eo,useValue:this.schemaValidatorTypeResolver},{provide:g.CI,useValue:n}])}registerSchemaElements(e){this.registerConverters(e.converters),this.registerValidators(e.validators)}getMetadataPreprocessedSchema(e,r){return this._preprocessOnMetadataInit(e)}getModels(e,r){return this._generateModel(e)}getModelPreprocessedSchema(e,r,a){return this._preprocessOnModelInit(e,r)}getViewModel(e,r,a,n){return this._generateViewModel(e,r,a,n)}getViewModelPreprocessedSchema(e,r,a,n){return this._preprocessOnViewModelInit(e,r,a)}_getModelPreprocessedSchemaData(e,r,a){return a().pipe((0,A.w)(o=>{const l=this.getModelPreprocessedSchema(e,o,r);return(0,v.combineLatest)([l,(0,v.of)(o)])}))}_getViewModelPreprocessedSchemaData(e,r,a,n){return n().pipe((0,A.w)(l=>{const h=this.getViewModelPreprocessedSchema(e,a,l,r);return(0,v.combineLatest)([h,(0,v.of)(a),(0,v.of)(l)])}))}init(e,r,a=null){return this._init(e,()=>this.getMetadataPreprocessedSchema(e,r).pipe((0,A.w)(n=>this._getModelPreprocessedSchemaData(n,r,()=>this.getModels(n,r))),(0,A.w)(([n,o])=>this._getViewModelPreprocessedSchemaData(n,r,o,()=>this.getViewModel(n,o,a,r)))))}refresh(e,r){const{schema:a,models:n,viewModel:o}=r;return this._init(a,()=>this.getMetadataPreprocessedSchema(a,e).pipe((0,A.w)(l=>this._getModelPreprocessedSchemaData(l,e,()=>(0,v.of)(n))),(0,A.w)(([l])=>this._getViewModelPreprocessedSchemaData(l,e,n,()=>(0,v.of)(o)))))}registerConverters(e){this.schemaConverterRegistry.clearSchemaConverters(),Object.entries(e||{}).forEach(([r,a])=>{this.schemaConverterRegistry.register(r,class{constructor(){this.convert=a}})})}registerValidators(e){this.schemaValidatorRegistryService.clearSchemaValidators(),Object.values(e||{}).forEach(a=>{const n=(0,Ct.Z)(a,["validator"]);this.schemaValidatorRegistryService.register(n,this.schemaValidatorFactory.create(a))})}}return i.\u0275fac=function(e){return new(e||i)(s.\u0275\u0275inject(g.QI),s.\u0275\u0275inject(g.a8),s.\u0275\u0275inject(W),s.\u0275\u0275inject(g.lU),s.\u0275\u0275inject(g.vJ),s.\u0275\u0275inject(g.eC),s.\u0275\u0275inject(g.DN))},i.\u0275prov=s.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac}),i})(),Xe=(()=>{class i extends he{constructor(e,r,a,n,o,l,h,p,y,R){super(a,n,o,l,h,p,y),this._schemaCacheService=e,this._schemaChangeListenerService=r,this.viewModelGenerator=a,this.modelGenerator=n,this.schemaConverterRegistry=o,this.schemaValidatorFactory=l,this.schemaValidatorTypeResolver=h,this.schemaValidatorRegistryService=p,this.metadataPreprocessorService=y,this.zone=R,this._destroyed$=new v.Subject,this._schemaChangeListenerService.schemaChanged$.pipe((0,ue.R)(this._destroyed$)).subscribe(S=>{S.schemaType===f.rgK.ClientUnitSchema&&this._schemaCacheService.invalidateClientUnitSchema(S.name),S.schemaType===f.rgK.EntitySchema&&this._schemaCacheService.invalidateByDataSchemaName(S.name)})}_getSnapshot(e,r){const a=this._schemaCacheService.getSchemaSnapshots(e);return a?a[r]:null}getMetadataPreprocessedSchema(e,r){const a=this._schemaCacheService.isCached(r),n=this._getSnapshot(r,f.BOC.METADATA_INIT);return!a||!n?super.getMetadataPreprocessedSchema(e).pipe((0,w.b)(o=>this._schemaCacheService.setCacheSnapshot({schemaName:r,hook:f.BOC.METADATA_INIT,snapshot:o}))):(0,v.of)(n)}getModels(e,r){return super.getModels(e).pipe((0,w.b)(a=>{const n=a.map(o=>o.dataSchemaName);this._schemaCacheService.setDataSchemaDepsToCache(r,n)}))}getModelPreprocessedSchema(e,r,a){const n=this._schemaCacheService.isCached(a),o=this._getSnapshot(a,f.BOC.MODEL_INIT);return!n||!o?super.getModelPreprocessedSchema(e,r).pipe((0,w.b)(l=>{this._schemaCacheService.setCacheSnapshot({schemaName:a,hook:f.BOC.MODEL_INIT,snapshot:l})})):(0,v.of)(o)}getViewModelPreprocessedSchema(e,r,a,n){const o=this._schemaCacheService.isCached(n),l=this._getSnapshot(n,f.BOC.VIEW_MODEL_INIT);return!o||!l?super.getViewModelPreprocessedSchema(e,r,a).pipe((0,w.b)(h=>{this._schemaCacheService.setCacheSnapshot({schemaName:n,hook:f.BOC.VIEW_MODEL_INIT,snapshot:h})})):(0,v.of)(l)}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}}return i.\u0275fac=function(e){return new(e||i)(s.\u0275\u0275inject(H.yi),s.\u0275\u0275inject(f.kBG),s.\u0275\u0275inject(g.QI),s.\u0275\u0275inject(g.a8),s.\u0275\u0275inject(W),s.\u0275\u0275inject(g.lU),s.\u0275\u0275inject(g.vJ),s.\u0275\u0275inject(g.eC),s.\u0275\u0275inject(g.DN),s.\u0275\u0275inject(s.NgZone))},i.\u0275prov=s.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac}),i})(),_t=(()=>{class i extends g.O7{_generateUnsubscribeHandlersHook(e,r=[]){e.destroy=new Proxy(e.destroy,{apply:(a,n,o)=>a.apply(n,o).pipe((0,w.b)(()=>r.forEach(h=>h())))})}_registerHandlerChain(e,r){const a=[];return e.forEach(n=>{const o=class extends c.BaseRequestHandler{handle(h){return n.handler(h,this.next)}},l=()=>new o;a.push(this.handlerChain.register({requestType:n.request,createHandler:l,source:{type:c.HandlerSourceType.Schema,...n.source},scopes:[r]}))}),a}generateLifecycleHooks(e,r){const{handlers:a,schemaName:n}=r,o=this._registerHandlerChain(a||[],n);super.generateLifecycleHooks(e,r),this._generateUnsubscribeHandlersHook(e,o)}}return i.\u0275fac=function(){let t;return function(r){return(t||(t=s.\u0275\u0275getInheritedFactory(i)))(r||i)}}(),i.\u0275prov=s.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var Rt=m(99855),Dt=m(40143),It=m(94826);function Mt(i,t){if(i&1&&(s.\u0275\u0275elementContainerStart(0,3),s.\u0275\u0275elementContainer(1,4),s.\u0275\u0275elementContainerEnd()),i&2){const e=s.\u0275\u0275nextContext(2);s.\u0275\u0275property("crtViewModel",e.schemaState.viewModel),s.\u0275\u0275advance(1),s.\u0275\u0275property("viewConfig",e.schemaState==null?null:e.schemaState.viewConfig)("selector",e.schema)}}function xt(i,t){if(i&1&&s.\u0275\u0275elementContainer(0,6),i&2){const e=t.$implicit,r=s.\u0275\u0275nextContext(3);s.\u0275\u0275property("crtViewModel",r.schemaState.viewModel)("crtViewElement",e)}}function wt(i,t){if(i&1&&s.\u0275\u0275template(0,xt,1,2,"ng-container",5),i&2){const e=s.\u0275\u0275nextContext(2);s.\u0275\u0275property("ngForOf",e.schemaState.viewConfig)}}function Et(i,t){if(i&1&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275template(1,Mt,2,3,"ng-container",1),s.\u0275\u0275pipe(2,"async"),s.\u0275\u0275template(3,wt,1,1,"ng-template",null,2,s.\u0275\u0275templateRefExtractor),s.\u0275\u0275elementContainerEnd()),i&2){const e=s.\u0275\u0275reference(4),r=s.\u0275\u0275nextContext();s.\u0275\u0275advance(1),s.\u0275\u0275property("ngIf",s.\u0275\u0275pipeBind1(2,2,r.useCompiledSchemaComponent$))("ngIfElse",e)}}let z=(()=>{class i{constructor(e,r,a,n,o,l,h,p,y,R){this._schemaPartsService=e,this._schemaCacheService=r,this._viewModelDiffPatchService=a,this._schemaConverterRegistry=n,this._schemaValidatorRegistryService=o,this._schemaService=l,this._featureService=h,this.zone=p,this._injector=y,this._cdr=R,this._destroyed$=new v.Subject,this._schemaName$=new v.Subject,this._processedSchemaBundles=[],this._fromChain=!1,this._addClsToHost=!0,this.modelInitConfigs=null,this.schemaStateGenerated=new s.EventEmitter,this._cachingFeature$=this._featureService.getFeatureState("DisableRuntimeSchemaCaching").pipe((0,de.d)(1)),this.useCompiledSchemaComponent$=this._featureService.getFeatureState("DisableCompileSchemaComponent").pipe((0,de.d)(1),(0,O.U)(S=>!S)),this._schemaInitializerService$=this._cachingFeature$.pipe((0,O.U)(S=>{var E;return this._schemaInitializerService=(E=this._schemaInitializerService)!==null&&E!==void 0?E:this._injector.get(S?he:Xe),this._schemaInitializerService}),(0,de.d)(1)),this._initSchemaInitializerService(),this._subscribeToSchemaParts()}_initSchemaInitializerService(){const e=this._schemaName$.pipe((0,A.w)(r=>this._schemaPartsService.init(r)),(0,w.b)(r=>this._schemaService.init(r)));this.zone.runOutsideAngular(()=>(0,v.combineLatest)([e,this._schemaInitializerService$]).pipe((0,qe.z)(([r])=>this._schemaInitializerService.init(r,this.schema,this.modelInitConfigs)),(0,w.b)(({schema:r})=>this._processedSchemaBundles=[r]),(0,w.b)(({schema:r,models:a,viewModel:n})=>{this._fromChain||(this._destroyView(),this.schemaState={models:a,viewModel:n,viewConfig:r.viewConfig,handlers:r.handlers,scope:this.schema,converters:r.converters,validators:r.validators},this.schemaStateGenerated.next(this.schemaState))}),(0,A.w)(()=>new v.Observable(r=>{this.zone.run(()=>{r.next(),r.complete()})})),(0,ue.R)(this._destroyed$))).subscribe()}_subscribeToSchemaParts(){const e=this._schemaPartsService.partsChanged$;this.zone.runOutsideAngular(()=>e.pipe((0,w.b)(({bundle:r})=>this._schemaService.init(r)),(0,w.b)(()=>this._schemaCacheService.invalidateClientUnitSchema(this.schema)),(0,A.w)(({bundle:r,silent:a})=>this._refreshSchema(r,a)),(0,w.b)(({schema:r})=>{this._processedSchemaBundles=[this._processedSchemaBundles.pop(),r],this.schemaStateGenerated.next({...this.schemaState,viewConfig:r.viewConfig,handlers:r.handlers,converters:r.converters,validators:r.validators})}),(0,ft.M)(e),(0,St.h)(([r,{silent:a}])=>Boolean(a)===!1),(0,A.w)(()=>this._viewModelDiffPatchService.diff(...this._processedSchemaBundles)),(0,A.w)(r=>this.schemaState.viewModel._hotSwap(r)),(0,w.b)(()=>{this.zone.run(()=>{const r=[...this._processedSchemaBundles].pop();this.schemaState.viewConfig=r.viewConfig})}))).pipe((0,ue.R)(this._destroyed$)).subscribe()}_refreshSchema(e,r){const a=this.schema,n={schema:e,models:this.schemaState.models,viewModel:this.schemaState.viewModel};return r?this._schemaInitializerService.refresh(a,n):this._schemaInitializerService.init(e,a).pipe((0,A.w)(o=>o.viewModel.destroy().pipe((0,O.U)(()=>o))))}_onSchemaNameChanged(e){this.schema=e,this._schemaConverterRegistry.clearSchemaConverters(),this._schemaValidatorRegistryService.clearSchemaValidators(),this._schemaName$.next(this.schema)}_onSchemaStateChanged(e){this.schema=e.scope,this._schemaPartsService.init(e.scope).pipe((0,v.first)()).subscribe(r=>{this._schemaService.init(r),this._schemaInitializerService.registerConverters(e.converters),this._schemaInitializerService.registerValidators(e.validators),this.schemaStateGenerated.next(e)})}_destroyView(){this.schemaState=null,this._cdr.detectChanges()}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}ngOnChanges(e){var r,a;const n=(r=e.schema)===null||r===void 0?void 0:r.currentValue,o=(a=e.schemaState)===null||a===void 0?void 0:a.currentValue;n&&(this._fromChain=!1,this._onSchemaNameChanged(n)),o&&(this._fromChain=!0,this._onSchemaStateChanged(o))}}return i.\u0275fac=function(e){return new(e||i)(s.\u0275\u0275directiveInject(H.xr),s.\u0275\u0275directiveInject(H.yi),s.\u0275\u0275directiveInject(g.HE),s.\u0275\u0275directiveInject(W),s.\u0275\u0275directiveInject(g.eC),s.\u0275\u0275directiveInject(H.QF),s.\u0275\u0275directiveInject(_.UZ),s.\u0275\u0275directiveInject(s.NgZone),s.\u0275\u0275directiveInject(s.Injector),s.\u0275\u0275directiveInject(s.ChangeDetectorRef))},i.\u0275cmp=s.\u0275\u0275defineComponent({type:i,selectors:[["crt-schema"]],hostVars:2,hostBindings:function(e,r){e&2&&s.\u0275\u0275classProp("crt-schema",r._addClsToHost)},inputs:{modelInitConfigs:"modelInitConfigs",schema:"schema",schemaState:"schemaState"},outputs:{schemaStateGenerated:"schemaStateGenerated"},features:[s.\u0275\u0275ProvidersFeature([W,{provide:F.c6,useExisting:W},g.eC,g.vJ,he,Xe,g.HE]),s.\u0275\u0275NgOnChangesFeature],decls:1,vars:1,consts:[[4,"ngIf"],[3,"crtViewModel",4,"ngIf","ngIfElse"],["viewElementDirective",""],[3,"crtViewModel"],["crtViewGenerator","",3,"viewConfig","selector"],[3,"crtViewModel","crtViewElement",4,"ngFor","ngForOf"],[3,"crtViewModel","crtViewElement"]],template:function(e,r){e&1&&s.\u0275\u0275template(0,Et,5,4,"ng-container",0),e&2&&s.\u0275\u0275property("ngIf",r.schemaState==null?null:r.schemaState.viewConfig)},directives:[M.NgIf,Rt.BU,Dt._,M.NgForOf,It.G],pipes:[M.AsyncPipe],styles:[""]}),i})(),me=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=s.\u0275\u0275defineNgModule({type:i}),i.\u0275inj=s.\u0275\u0275defineInjector({providers:[{provide:g.Gp,useClass:mt,multi:!0},{provide:g.Gp,useClass:pt,multi:!0},{provide:g.Gp,useClass:yt,multi:!0},{provide:g.Gp,useClass:vt,multi:!0},{provide:g.Gp,useClass:gt,multi:!0},g.DN,{provide:g.QI,useClass:_t}],imports:[[M.CommonModule,F.qi,g.kz,F.zu,H.ZM],F.qi,g.kz]}),i})();(function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(me,{declarations:[z],imports:[M.CommonModule,F.qi,g.kz,F.zu,H.ZM],exports:[z,F.qi,g.kz]})})();var Z=m(73068);let J=(()=>{class i{constructor(e){this.googleTagManager=e,this._init$=new v.ReplaySubject(1),this.schemaStateGenerated=new s.EventEmitter,this.schemaState=null,this.modelInitConfigs=null,this.googleTagManager.initialize().subscribe({next:()=>this._init$.next()})}set schema(e){this._schemaName=e,this._init$.subscribe({next:()=>this._sendGTMData()})}get schema(){return this._schemaName}_sendGTMData(){const e={moduleName:this.moduleName,schemaName:this.schema};this.googleTagManager.track(e)}ngOnDestroy(){this._init$.complete()}}return i.\u0275fac=function(e){return new(e||i)(s.\u0275\u0275directiveInject(_.kK))},i.\u0275dir=s.\u0275\u0275defineDirective({type:i,inputs:{schemaState:"schemaState",modelInitConfigs:"modelInitConfigs",schema:"schema"},outputs:{schemaStateGenerated:"schemaStateGenerated"}}),i})(),We=(()=>{class i extends J{constructor(){super(...arguments),this.moduleName="PageModule"}}return i.\u0275fac=function(){let t;return function(r){return(t||(t=s.\u0275\u0275getInheritedFactory(i)))(r||i)}}(),i.\u0275cmp=s.\u0275\u0275defineComponent({type:i,selectors:[["crt-card"]],features:[s.\u0275\u0275InheritDefinitionFeature],decls:1,vars:3,consts:[[1,"light-blue-green-theme",3,"schema","schemaState","modelInitConfigs","schemaStateGenerated"]],template:function(e,r){e&1&&(s.\u0275\u0275elementStart(0,"crt-schema",0),s.\u0275\u0275listener("schemaStateGenerated",function(n){return r.schemaStateGenerated.next(n)}),s.\u0275\u0275elementEnd()),e&2&&s.\u0275\u0275property("schema",r.schema)("schemaState",r.schemaState)("modelInitConfigs",r.modelInitConfigs)},directives:[z],encapsulation:2}),i})(),Je=(()=>{class i extends J{constructor(){super(...arguments),this.moduleName="HomePageModule"}}return i.\u0275fac=function(){let t;return function(r){return(t||(t=s.\u0275\u0275getInheritedFactory(i)))(r||i)}}(),i.\u0275cmp=s.\u0275\u0275defineComponent({type:i,selectors:[["crt-home-page"]],features:[s.\u0275\u0275InheritDefinitionFeature],decls:1,vars:3,consts:[[1,"light-blue-green-theme",3,"schema","schemaState","modelInitConfigs","schemaStateGenerated"]],template:function(e,r){e&1&&(s.\u0275\u0275elementStart(0,"crt-schema",0),s.\u0275\u0275listener("schemaStateGenerated",function(n){return r.schemaStateGenerated.next(n)}),s.\u0275\u0275elementEnd()),e&2&&s.\u0275\u0275property("schema",r.schema)("schemaState",r.schemaState)("modelInitConfigs",r.modelInitConfigs)},directives:[z],encapsulation:2}),i})(),Ke=(()=>{class i extends J{constructor(){super(...arguments),this.moduleName="SectionModule"}}return i.\u0275fac=function(){let t;return function(r){return(t||(t=s.\u0275\u0275getInheritedFactory(i)))(r||i)}}(),i.\u0275cmp=s.\u0275\u0275defineComponent({type:i,selectors:[["crt-section"]],features:[s.\u0275\u0275InheritDefinitionFeature],decls:1,vars:3,consts:[[1,"light-blue-green-theme",3,"schema","schemaState","modelInitConfigs","schemaStateGenerated"]],template:function(e,r){e&1&&(s.\u0275\u0275elementStart(0,"crt-schema",0),s.\u0275\u0275listener("schemaStateGenerated",function(n){return r.schemaStateGenerated.next(n)}),s.\u0275\u0275elementEnd()),e&2&&s.\u0275\u0275property("schema",r.schema)("schemaState",r.schemaState)("modelInitConfigs",r.modelInitConfigs)},directives:[z],encapsulation:2}),i})(),Ye=(()=>{class i extends J{constructor(){super(...arguments),this.moduleName="PageModule"}}return i.\u0275fac=function(){let t;return function(r){return(t||(t=s.\u0275\u0275getInheritedFactory(i)))(r||i)}}(),i.\u0275cmp=s.\u0275\u0275defineComponent({type:i,selectors:[["crt-page"]],features:[s.\u0275\u0275InheritDefinitionFeature],decls:1,vars:3,consts:[[1,"light-blue-green-theme",3,"schema","schemaState","modelInitConfigs","schemaStateGenerated"]],template:function(e,r){e&1&&(s.\u0275\u0275elementStart(0,"crt-schema",0),s.\u0275\u0275listener("schemaStateGenerated",function(n){return r.schemaStateGenerated.next(n)}),s.\u0275\u0275elementEnd()),e&2&&s.\u0275\u0275property("schema",r.schema)("schemaState",r.schemaState)("modelInitConfigs",r.modelInitConfigs)},directives:[z],encapsulation:2}),i})(),pe=class{_createGetRecordUrl(t,e,r){return{type:"crt.7XRequest",action:"GetRecordUrl",$context:t,payload:{recordId:e,entityName:r}}}convert(t,e,r){var a=this;return(0,u.Z)(function*(){const{referenceSchemaName:n}=yield(0,g.f9)(e,r),o=a._createGetRecordUrl(e,t,n);return yield c.HandlerChainService.instance.process(o)})()}};pe=(0,d.gn)([(0,c.CrtConverter)("crt.ToRecordLinkAsync")],pe);var Nt=m(42147);const bt="UseDataGridDesignFeatures",Pt="ShowDataGridSelectionCheckbox",At="DisableDataGridEditingMode",Vt="DisableCompiledCellView",Ft="EnableDataGridColumnEdit";function Ht(i){return i.getFeatureState(Vt).pipe((0,Nt.x)(),(0,O.U)(t=>!t))}const Tt={provide:P.d9u,useFactory:Ht,deps:[_.UZ]};let tr=null,Bt=(()=>{class i{constructor(e,r){this._featureService=e,this._rightsService=r}getFeatures(){return(0,v.forkJoin)([this._featureService.getFeatureState(bt),this._featureService.getFeatureState(At),this._featureService.getFeatureState(Pt),this._featureService.getFeatureState(Ft),this._rightsService.getCanExecuteOperation(V.Mn)]).pipe((0,O.U)(([e,r,a,n,o])=>({rows:{toolbar:!0,numeration:!0,selection:{displayCheckbox:a}},columns:{toolbar:e,sorting:!0,resizing:e,dragAndDrop:e,editing:n},cells:{selectable:!0},header:{toolbar:{columnsSelection:e}},operations:{canCreateDefaultGridSettings:o},editable:!r})))}}return i.\u0275fac=function(e){return new(e||i)(s.\u0275\u0275inject(_.UZ),s.\u0275\u0275inject(_._h))},i.\u0275prov=s.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),Qe={};const $t={provide:P.ud6,useFactory:()=>Qe};let kt=(()=>{class i{constructor(e){this._dataGridFeaturesService=e}init(){return this._dataGridFeaturesService.getFeatures().pipe((0,w.b)(e=>Qe=e),(0,O.U)(()=>{}))}}return i.\u0275fac=function(e){return new(e||i)(s.\u0275\u0275inject(Bt))},i.\u0275prov=s.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var jt=m(20851),et=m(75079),ge=m(31177);let Ot=(()=>{class i extends V.Ld{constructor(e,r){super(e),this._schemaPartsService=r}_updateDataSourceAttributes(e,r){return(0,u.Z)(function*(){const{columns:a,dataSourceName:n}=e;if(a.length===0)return;const o=a.map(y=>y.code.split(`${n}_`).pop()),h=(0,et.Z)(o).map(y=>{var R;const S=a.find(Q=>Q.code===`${n}_${y}`);let E;!((R=S?.aggregationConfig)===null||R===void 0)&&R.aggregationFunction&&(E=c.DataSchemaAttributeType.AggregationAttribute);const Y=S.code.split(`${n}_`).pop(),N=S.path||Y,B=(0,ge.Z)(S?.aggregationConfig);return S==null||delete S.aggregationConfig,S==null||delete S.captionResources,S==null||delete S.originalCaption,{name:Y,path:N,type:E,aggregationConfig:B,caption:S?.caption}}),p=r.getEntityDataSourceConfigService(n);p&&p.setAttributes(h).apply()})()}_updateViewItem(e,r){return(0,u.Z)(function*(){const{viewElementConfig:a,columns:n}=e,l=r.getViewConfigInfoByName(a.name).viewConfig;l.columns=n.map(h=>({...h,code:(0,f._fv)(h.code)}))})()}_updateViewModelAttributes(e,r){return(0,u.Z)(function*(){const{viewElementConfig:a,columns:n,dataSourceName:o}=e,h=a.items.toString().split("$").pop(),p=n.map(R=>R.code).map(R=>(0,f._fv)(R)).map(R=>R.split(`${o}_`).pop());a.primaryColumnName&&p.push(a.primaryColumnName.split(`${o}_`).pop());const y=(0,et.Z)(p);r.bindViewModelAttributeCollection(h,o,y,`${o}_`,jt.Gk.Override)})()}innerHandle(e){var r=this;const a=e?.columns,n=e?.previousColumns,l=a?.length!==n?.length||a?.some(h=>h.changed);return(0,v.from)(this._schemaPartsService.apply(function(){var h=(0,u.Z)(function*([p]){yield r._updateDataSourceAttributes(e,p),yield r._updateViewModelAttributes(e,p),yield r._updateViewItem(e,p)});return function(p){return h.apply(this,arguments)}}())).pipe((0,A.w)(()=>this._schemaPartsService.commit({silent:l===!1})),(0,O.U)(()=>{}))}handle(e,r){return super.handle({...e},r)}}return i.\u0275fac=function(e){return new(e||i)(s.\u0275\u0275inject(H.QF),s.\u0275\u0275inject(H.xr))},i.\u0275prov=s.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac}),i})();function Zt(i){return()=>(0,v.lastValueFrom)(i.init(),{defaultValue:null})}let T=class{constructor(t){this._materialIconsRegistrator=t;const e=["copy-row-action","delete-row-action","edit-row-action"].map(r=>({name:r,icon:m(53994)(`./${r}.svg`)}));this._materialIconsRegistrator.addIcons(e)}};T.\u0275fac=function(t){return new(t||T)(s.\u0275\u0275inject(C.ZH))},T.\u0275mod=s.\u0275\u0275defineNgModule({type:T}),T.\u0275inj=s.\u0275\u0275defineInjector({providers:[$t,Tt,{provide:s.APP_INITIALIZER,useFactory:Zt,deps:[kt],multi:!0}],imports:[[V.at],P.kB8]}),T=(0,d.gn)([(0,c.CrtModule)({includes:[V.at]}),(0,d.w6)("design:paramtypes",[C.ZH])],T),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(T,{imports:[V.at],exports:[P.kB8]})}();function tt(i){if(!Array.isArray(i))return null;if(i.length===0||i.every(r=>r?.success))return{success:!0};const e=i.map(r=>r?.success===!0?void 0:r?.errorInfo).filter(Boolean);return{success:!1,errorInfo:e.length===0?void 0:e.join(`
`)}}let ve=class extends c.BaseRequestHandler{constructor(t){super(),this._dialogService=t,this._maskService=new c.MaskService}_cancelPrimaryDataChanges(t){var e=this;return(0,u.Z)(function*(){const r={type:"crt.CancelPrimaryDataChangesRequest",$context:t.$context},a=yield e.handlerChain.process(r);return tt(a)})()}_displayErrorDialog(t){const e=t?.message;e&&this._dialogService.openInfoDialog(e)}handle(t){var e=this;return(0,u.Z)(function*(){yield e._maskService.showBodyMask();try{const r=yield e._cancelPrimaryDataChanges(t);if(r.success===!0)return!0;throw new Error(r.errorInfo)}catch(r){return e._displayErrorDialog(r),!1}finally{e._maskService.hideBodyMask()}})()}};ve=(0,d.gn)([(0,c.CrtRequestHandler)({type:"crt.CancelRecordChangesHandler",requestType:"crt.CancelRecordChangesRequest"}),(0,d.w6)("design:paramtypes",[C.xA])],ve);let ye=class extends c.BaseRequestHandler{constructor(t){super(),this._dialogService=t,this._maskService=new c.MaskService}_cancelCollectionPrimaryDataChanges(t){var e=this;return(0,u.Z)(function*(){const r={type:"crt.CancelCollectionPrimaryDataChangesRequest",$context:t.$context,primaryAttributeValues:t.recordIds,collectionAttributeName:t.itemsAttributeName},a=yield e.handlerChain.process(r);return tt(a)})()}_displayErrorDialog(t){const e=t?.message;e&&this._dialogService.openInfoDialog(e)}handle(t){var e=this;return(0,u.Z)(function*(){yield e._maskService.showBodyMask();try{const r=yield e._cancelCollectionPrimaryDataChanges(t);if(r.success===!0)return!0;throw new Error(r.errorInfo)}catch(r){return e._displayErrorDialog(r),!1}finally{e._maskService.hideBodyMask()}})()}};ye=(0,d.gn)([(0,c.CrtRequestHandler)({type:"crt.CancelRecordsChangesHandler",requestType:"crt.CancelRecordsChangesRequest"}),(0,d.w6)("design:paramtypes",[C.xA])],ye);var D=(()=>(function(i){i.AllSections="BaseGridSectionTemplate",i.AllCards="BasePageTemplate"}(D||(D={})),D))();let fe=class extends c.BaseRequestHandler{handle(t){var e=this;return(0,u.Z)(function*(){var r;const a=t.$context;if((yield a.CardState)===c.ModelInPageAction.Edit){const n=yield(r=e.next)===null||r===void 0?void 0:r.handle(t);return n&&(a.IsChanged=!1),n}else if((yield a.CardState)===c.ModelInPageAction.Add||(yield a.CardState)===c.ModelInPageAction.Copy)return yield e.handlerChain.process({type:"crt.7XRequest",action:"BackHistoryState",$context:t.$context})})()}};fe=(0,d.gn)([(0,c.CrtRequestHandler)({type:"crt.CardCancelRecordChangesHandler",requestType:"crt.CancelRecordChangesRequest",scopes:[D.AllCards]})],fe);function Se(i){return Object.values(i.dataSchemas||{})[0]}function U(i){return Object.keys(i.dataSchemas||{})[0]}let Ce=class extends c.BaseRequestHandler{_getDefaultCaption(t){return(0,u.Z)(function*(){var e,r,a,n;const o=yield(r=(e=t.$context.Resources)===null||e===void 0?void 0:e.Strings)===null||r===void 0?void 0:r.NewRecord,l=yield(n=(a=t.$context.Resources)===null||a===void 0?void 0:a.Strings)===null||n===void 0?void 0:n.Record;return(yield t.$context.CardState)===c.ModelInPageAction.Add?o:l})()}_updateCardCaption(t,e){var r=this;return(0,u.Z)(function*(){const a=Se(e),n=U(e),o=e.getViewModelAttributePath(n,a?.primaryDisplayAttributeName);if(t.attributeName===o){const l=yield r._getDefaultCaption(t);yield r.handlerChain.process({type:"crt.7XRequest",action:"InitDataViews",$context:e,payload:{caption:t.value||l,hidePageCaption:!0}})}})()}_setDefaultCaption(t){var e=this;return(0,u.Z)(function*(){var r,a;if(t.attributeName==="CardState"&&(t.value===c.ModelInPageAction.Add||t.value===c.ModelInPageAction.Copy)){const n=yield(a=(r=t.$context.Resources)===null||r===void 0?void 0:r.Strings)===null||a===void 0?void 0:a.NewRecord;yield e.handlerChain.process({type:"crt.7XRequest",action:"InitDataViews",$context:t.$context,payload:{caption:n,hidePageCaption:!0}})}})()}_isAttributeBoundToPrimaryDS(t,e){const r=U(e),a=e.getBoundDataSourceNameByAttributePath(t);return a&&a===r}handle(t){var e=this;return(0,u.Z)(function*(){var r;const a=t.$context;return(yield a.IsChangesTrackingEnabled)&&!(yield a.IsChanged)&&!t.silent&&e._isAttributeBoundToPrimaryDS(t.attributeName,a)&&(a.IsChanged=!0),t.attributeName==="CardState"?yield e._setDefaultCaption(t):yield e._updateCardCaption(t,a),yield(r=e.next)===null||r===void 0?void 0:r.handle(t)})()}};Ce=(0,d.gn)([(0,c.CrtRequestHandler)({requestType:"crt.HandleViewModelAttributeChangeRequest",type:"crt.CardChangeAttributeHandler",scopes:[D.AllCards]})],Ce);let te=class extends c.BaseRequestHandler{constructor(t,e){super(),this.translateService=t,this.dialogService=e}_getEntitySchemaName(t){var e,r;const a=this._getDataSourceName(t),n=(r=(e=t.$context.dataSchemas[a])===null||e===void 0?void 0:e.dataSourceConfig)===null||r===void 0?void 0:r.config;return n?.entitySchemaName}_getDataSourceName(t){return t.$context.getBoundDataSourceName(t.itemsAttributeName)}handle(t){var e=this;return(0,u.Z)(function*(){var r;if(!t.entityName&&!t.itemsAttributeName&&!t.entityPageName){const n=e.translateService.instant("InfoDialog.OpenPage.SettingsErrorMessage");e.dialogService.openInfoDialog(n);return}const a={type:"crt.7XRequest",action:"AddRecord",$context:t.$context,payload:{entityName:(r=t.entityName)!==null&&r!==void 0?r:e._getEntitySchemaName(t),defaultValues:t.defaultValues,entityPageName:t.entityPageName}};yield e.handlerChain.process(a)})()}};te=(0,d.gn)([(0,c.CrtRequestHandler)({requestType:"crt.CreateRecordRequest",type:"crt.CreateRecordHandler"}),(0,d.w6)("design:paramtypes",[x.sK,C.xA])],te);let _e=class extends te{handle(t){var e=this;return(0,u.Z)(function*(){var r;if(!t.entityName&&!t.itemsAttributeName&&!t.entityPageName){const o=e.translateService.instant("InfoDialog.OpenPage.SettingsErrorMessage");e.dialogService.openInfoDialog(o);return}const a={type:"crt.SaveRecordRequest",preventCardClose:!1,$context:t.$context};(yield e.handlerChain.process(a))&&(yield(r=e.next)===null||r===void 0?void 0:r.handle(t))})()}};_e=(0,d.gn)([(0,c.CrtRequestHandler)({requestType:"crt.CreateRecordRequest",type:"crt.CardCreateRecordHandler",scopes:[D.AllCards]})],_e);let re=class extends c.BaseRequestHandler{_setPrimaryDSAttribute(t,e){const r=e.name,a=t.dataSchemas[r],n=e.recordId,o=t.getViewModelAttributePath(r,a.primaryAttributeName);t[o]=n}_loadDataSource(t,e,r=[]){var a=this;return(0,u.Z)(function*(){yield a.handlerChain.process({type:"crt.LoadDataRequest",$context:e,dataSourceName:t,parameters:r})})()}_loadDS(t,e){var r=this;return(0,u.Z)(function*(){const a=e.name,n=t.dataSchemas[a],o=t.getViewModelAttributePath(a,n.primaryAttributeName);yield r._loadDataSource(a,t,[{type:c.ModelParameterType.PrimaryColumnValue,value:o}])})()}_copyDS(t,e,r){var a=this;return(0,u.Z)(function*(){yield a.handlerChain.process({type:"crt.CopyDataRequest",$context:t,dataSourceName:e,recordId:r})})()}_loadDefaultValues(t,e){var r=this;return(0,u.Z)(function*(){return r.handlerChain.process({type:"crt.LoadDefaultValuesRequest",$context:t,dataSourceName:e})})()}_isString(t){return t!==null&&typeof t=="string"}_getAttributeValue(t,e,r,a){var n=this;return(0,u.Z)(function*(){const l=t.dataSchemas[e].findAttributeByName(r);return l.dataValueType===c.DataValueType.Lookup&&n._isString(a)?new H.Wl().convert(a,t,l.referenceSchemaName):a})()}_setValuePairs(t,e,r){var a=this;return(0,u.Z)(function*(){var n;if(t===c.ModelInPageAction.Add||t===c.ModelInPageAction.Copy){const o=e.name;if(!(!((n=e.defaultValues)===null||n===void 0)&&n.length))return(0,v.lastValueFrom)(r.create(o),{defaultValue:null});const l={};for(const{attributeName:h,value:p}of e.defaultValues)if(p){let y=p;const R=r?.getViewModelAttributePath(o,h);R&&(y=yield a._getAttributeValue(r,o,h,p),r[R]=y),l[h]=y}return(0,v.lastValueFrom)(r.create(o,l),{defaultValue:null})}})()}initModelInEditModeAsync(t,e){var r=this;return(0,u.Z)(function*(){r._setPrimaryDSAttribute(t,e),yield r._loadDS(t,e)})()}initModelInCopyModeAsync(t,e){var r=this;return(0,u.Z)(function*(){yield r._loadDefaultValues(t,e.name),yield r._copyDS(t,e.name,e.recordId),yield r._setValuePairs(c.ModelInPageAction.Copy,e,t)})()}initModelInAddingModeAsync(t,e){var r=this;return(0,u.Z)(function*(){yield r._loadDefaultValues(t,e.name),yield r._setValuePairs(c.ModelInPageAction.Add,e,t)})()}handle(t){var e=this;return(0,u.Z)(function*(){const r=t.$context;(r.modelInitConfigs||[]).forEach(n=>{const o=n.action;n.name=n.name||U(r),o===c.ModelInPageAction.Edit?e.initModelInEditModeAsync(r,n):o===c.ModelInPageAction.Add?e.initModelInAddingModeAsync(r,n):o===c.ModelInPageAction.Copy?e.initModelInCopyModeAsync(r,n):e._loadDataSource(n.name,r)})})()}};re=(0,d.gn)([(0,c.CrtRequestHandler)({type:"crt.PageInitHandler",requestType:"crt.HandleViewModelInitRequest"})],re);let Re=class extends re{initModelInEditModeAsync(t,e){var r=()=>super.initModelInEditModeAsync,a=this;return(0,u.Z)(function*(){r().call(a,t,e).then(()=>{t.IsChangesTrackingEnabled=!0})})()}initModelInCopyModeAsync(t,e){return t.IsChanged=!0,t.IsChangesTrackingEnabled=!0,super.initModelInCopyModeAsync(t,e)}initModelInAddingModeAsync(t,e){return t.IsChanged=!0,t.IsChangesTrackingEnabled=!0,super.initModelInAddingModeAsync(t,e)}handle(t){var e=()=>super.handle,r=this;return(0,u.Z)(function*(){const a=t.$context,n=a.modelInitConfigs||[];n&&n.length>0&&(a.CardState=n[0].action),e().call(r,t)})()}};Re=(0,d.gn)([(0,c.CrtRequestHandler)({type:"crt.CardInitHandler",requestType:"crt.HandleViewModelInitRequest",scopes:[D.AllCards]})],Re);let De=class extends c.BaseRequestHandler{_backHistoryState(t){var e=this;return(0,u.Z)(function*(){yield e.handlerChain.process({type:"crt.7XRequest",action:"BackHistoryState",$context:t})})()}handle(t){var e=this;return(0,u.Z)(function*(){var r;const a=yield(r=e.next)===null||r===void 0?void 0:r.handle(t),n=yield t.$context.CardState;return a&&!t.preventCardClose&&(n===c.ModelInPageAction.Add||n===c.ModelInPageAction.Copy)&&(yield e._backHistoryState(t.$context)),a})()}};De=(0,d.gn)([(0,c.CrtRequestHandler)({requestType:"crt.SaveRecordRequest",type:"crt.CardSaveRecordHandler",scopes:[D.AllCards]})],De);let Ie=class extends c.BaseRequestHandler{constructor(t,e){super(),this._translateService=t,this._dialogService=e}handle(t){var e=this;return(0,u.Z)(function*(){var r;if(!t.entityName&&!t.itemsAttributeName||!t.recordId){const n=e._translateService.instant("InfoDialog.OpenPage.SettingsErrorMessage");e._dialogService.openInfoDialog(n);return}const a=yield t.$context.CardState;return t.trackUnsavedData==null&&(t.trackUnsavedData=a==null||a===c.ModelInPageAction.Edit),(r=e.next)===null||r===void 0?void 0:r.handle(t)})()}};Ie=(0,d.gn)([(0,c.CrtRequestHandler)({requestType:"crt.UpdateRecordRequest",type:"crt.CardUpdateRecordHandler",scopes:[D.AllCards,D.AllSections]}),(0,d.w6)("design:paramtypes",[x.sK,C.xA])],Ie);let ae=class extends c.BaseRequestHandler{handle(t){var e=this;return(0,u.Z)(function*(){yield e.handlerChain.process({type:"crt.7XRequest",action:"BackHistoryState",$context:t.$context})})()}};(0,d.gn)([(0,g.xB)(),(0,d.w6)("design:type",Function),(0,d.w6)("design:paramtypes",[Object]),(0,d.w6)("design:returntype",Promise)],ae.prototype,"handle",null),ae=(0,d.gn)([(0,c.CrtRequestHandler)({type:"crt.ClosePageHandler",requestType:"crt.ClosePageRequest"})],ae);let rt=class extends c.BaseRequest{constructor(){super(...arguments),this.type="crt.CopyRecordRequest"}};rt=(0,d.gn)([(0,c.CrtRequest)({type:"crt.CopyRecordRequest"})],rt);let ne=class extends c.BaseRequestHandler{_getEntitySchemaName(t){var e,r;const a=this._getDataSourceName(t),n=(r=(e=t.$context.dataSchemas[a])===null||e===void 0?void 0:e.dataSourceConfig)===null||r===void 0?void 0:r.config;return n?.entitySchemaName}_getDataSourceName(t){return t.$context.getBoundDataSourceName(t.itemsAttributeName)||U(t.$context)}handle(t){var e=this;return(0,u.Z)(function*(){var r;const a={type:"crt.7XRequest",action:"CopyRecord",$context:t.$context,payload:{entityName:(r=t.entityName)!==null&&r!==void 0?r:e._getEntitySchemaName(t),recordId:t.recordId}};yield e.handlerChain.process(a)})()}};(0,d.gn)([(0,g.xB)(),(0,d.w6)("design:type",Function),(0,d.w6)("design:paramtypes",[Object]),(0,d.w6)("design:returntype",Promise)],ne.prototype,"handle",null),ne=(0,d.gn)([(0,c.CrtRequestHandler)({requestType:"crt.CopyRecordRequest",type:"crt.CopyRecordHandler",scopes:[]})],ne);let Me=class extends c.BaseRequestHandler{_getDataSchema(t){const e=this._getDataSourceName(t);return t.$context.dataSchemas[e]}_getDataSourceName(t){return t.$context.getBoundDataSourceName(t.itemsAttributeName)}handle(t){var e=this;return(0,u.Z)(function*(){var r,a;const n=e._getDataSchema(t),o={type:"crt.7XRequest",action:"AddRecordFromLookup",$context:t.$context,payload:{attributeName:t.attributeName,entityName:(r=t.schemaName)!==null&&r!==void 0?r:n?.name,displayValue:((a=t.detail)===null||a===void 0?void 0:a.searchValue)||"",displayColumn:n?.primaryDisplayAttributeName}};yield e.handlerChain.process(o)})()}};Me=(0,d.gn)([(0,c.CrtRequestHandler)({requestType:"crt.CreateRecordFromLookupRequest",type:"crt.CreateRecordFromLookupHandler",scopes:[D.AllSections,D.AllCards]})],Me);let xe=class extends c.BaseRequestHandler{constructor(t,e){super(),this._dialogService=t,this._translateService=e,this._maskDelay=250,this._handlerChain=c.HandlerChainService.instance,this._maskService=new c.MaskService}_deleteRecordFromCollection(t,e,r){return(0,u.Z)(function*(){const a=yield t.$context[r],o=(yield Promise.all(a.map(l=>l[e]))).findIndex(l=>l===t.recordId);a.remove(o)})()}_deleteRecord(t,e){var r=this;return(0,u.Z)(function*(){return yield r._handlerChain.process({type:"crt.DeleteDataRequest",$context:t.$context,dataSourceName:e,parameters:[{type:c.ModelParameterType.PrimaryColumnValue,value:"@requestPayload.primaryColumnValue"}],config:{payload:{primaryColumnValue:t.recordId}}})})()}_showInsufficientRightsDialog(t){var e=this;return(0,u.Z)(function*(){var r;yield e._maskService.hideBodyMask();const a=e._getDataSourceName(t),n=(r=t.$context.dataSchemas[a])===null||r===void 0?void 0:r.caption,l=e._translateService.instant("InfoDialog.RightLevelWarningMessage").replace("{0}",n);yield(0,v.lastValueFrom)(e._dialogService.openInfoDialog(l))})()}_getDataSourceName(t){const e=t.$context;return e.getBoundDataSourceName(t.itemsAttributeName)||U(e)}_performDelete(t){var e=this;return(0,u.Z)(function*(){const r=t.$context,a=Se(r),n=e._getDataSourceName(t),o=r.getViewModelAttributePath(n,a.primaryAttributeName);try{const{success:l,rowsAffected:h,errorInfo:p}=yield e._deleteRecord(t,n);if(yield e._maskService.hideBodyMask(),l&&h){const y=o.split(".").pop();yield e._deleteRecordFromCollection(t,y,t.itemsAttributeName);return}if(!l&&p){e._dialogService.openInfoDialog(p);return}}catch{yield e._maskService.hideBodyMask();const l=e._translateService.instant("InfoDialog.UnableToDeleteSelectedRecord");yield(0,v.lastValueFrom)(e._dialogService.openInfoDialog(l))}})()}_canDelete(t){var e=this;return(0,u.Z)(function*(){return t.$context.canDelete(e._getDataSourceName(t),{primaryColumnValue:t.recordId})})()}handle(t){var e=this;return(0,u.Z)(function*(){const r=e._translateService.instant("ConfirmationDialog.DeleteRecordConfirmation");if((yield(0,v.lastValueFrom)(e._dialogService.openConfirmationDialog(r)))!==C.Zz.result)return;yield e._maskService.showBodyMask({delay:e._maskDelay});const{result:n}=yield e._canDelete(t);return n?e._performDelete(t):e._showInsufficientRightsDialog(t)})()}};xe=(0,d.gn)([(0,c.CrtRequestHandler)({requestType:"crt.DeleteRecordRequest",type:"crt.DeleteRecordHandler",scopes:[]}),(0,d.w6)("design:paramtypes",[C.xA,x.sK])],xe);let at=class extends c.BaseRequest{};at=(0,d.gn)([(0,c.CrtRequest)({type:"crt.DeleteRecordRequest"})],at);let nt=class extends c.BaseRequest{};nt=(0,d.gn)([(0,c.CrtRequest)({type:"crt.DownloadEntityFileRequest"})],nt);let we=class extends c.BaseRequestHandler{constructor(t){super(),this.fileApiService=t}handle(t){var e=this;return(0,u.Z)(function*(){return yield e.fileApiService.download(t.detail.file.url,t.detail.file.displayValue)})()}};we=(0,d.gn)([(0,c.CrtRequestHandler)({requestType:"crt.DownloadEntityFileRequest",type:"crt.DownloadEntityFileHandler",scopes:[D.AllSections,D.AllCards]}),(0,d.w6)("design:paramtypes",[f.ZrX])],we);let Ee=class extends c.BaseRequestHandler{handle(t){var e=this;return(0,u.Z)(function*(){const r=t.$context,{referenceSchemaName:a}=yield(0,g.f9)(r,t.primaryAttributeName),n={type:"crt.7XRequest",action:"HandleEmailLinkClick",$context:r,$initialEvent:{...t.$initialEvent,recordId:t.recordId,primaryDisplayName:t.primaryDisplayName,entitySchemaName:a,emailAddress:t.emailAddress}};return yield e.handlerChain.process(n)})()}};Ee=(0,d.gn)([(0,c.CrtRequestHandler)({type:"crt.EmailLinkClickHandler",requestType:"crt.EmailLinkClickRequest",scopes:[]})],Ee);var Gt=m(16738),Lt=m.n(Gt);class ie extends Error{constructor(t){super(t),Object.setPrototypeOf(this,ie.prototype)}}class oe extends Error{constructor(t){super(t),Object.setPrototypeOf(this,oe.prototype)}}let se=class extends c.BaseRequestHandler{constructor(t,e,r,a,n,o,l,h){var p;super(),p=this,this._rightsService=t,this._dialogService=e,this._exportToExcelService=r,this._resourceFinderService=a,this._entitySchemaQueryBuilder=n,this._translateService=o,this._injector=l,this._dateTimeFormatToken=h,this._exportEntityOperationName="Export",this._exportOperationCode="CanExportGrid",this._maskService=new c.MaskService,this._maskDelay=250,this._maximumFileNameLength=76,this._defaultDateTimePattern="DD_MM_YYYY_HH_mm",this._isCanExecuteExportExcelOperation=(0,u.Z)(function*(){return(0,v.firstValueFrom)(p._rightsService.getCanExecuteOperation(p._exportOperationCode))}),this._isCanExecuteEntityExportOperation=function(){var y=(0,u.Z)(function*(R){return(0,v.firstValueFrom)(p._rightsService.getCanExecuteEntityOperation(R,p._exportEntityOperationName))});return function(R){return y.apply(this,arguments)}}(),this._isCanExportToExcel=function(){var y=(0,u.Z)(function*(R){return(yield p._isCanExecuteExportExcelOperation())||(yield p._isCanExecuteEntityExportOperation(R.name))});return function(R){return y.apply(this,arguments)}}(),this._searchAttributeInDataSchema=(y,R)=>{var S;return(S=y.attributes)===null||S===void 0?void 0:S.find(E=>E.name===R)},this._handleError=y=>this._dialogService.openInfoDialog(this._getDialogErrorMessage(y)),this.getItemsAttributeName=y=>y?.items.toString().split("$").pop()}_buildColumnAttribute(t,e,r,a){var n=this;return(0,u.Z)(function*(){let o,l;typeof t=="string"?o=t:(o=r[t.code].modelConfig.path.split(".").slice(1).join("."),l=t.caption);const h=n._searchAttributeInDataSchema(e,o),p=yield n._resourceFinderService.findViewModelResourceValue(l,a);return{path:h?.path||o,name:o,caption:p||null,aggregationConfig:h?.aggregationConfig}})()}_createColumns(t,e,r,a){var n=this;return(0,u.Z)(function*(){const o=[];if(!t.columns)return o;for(const l of t.columns){const h=yield n._buildColumnAttribute(l,e,r,a.$context.Resources);o.push(h)}return o})()}_getSelectedRows(t,e){if(e.selectedRows&&typeof e.selectedRows!="string")return e.selectedRows;const r=e.selectedRows||(0,f.IhY)(e.items.toString());return t.attributes[r]}_addSelectedRowsToEsq(t,e,r){r&&r.length>0&&t.filters.addSchemaColumnInFilterWithParameters(c.ComparisonType.Equal,e,r)}_buildEsq(t,e){var r=this;return(0,u.Z)(function*(){const a=t.$context,n=r.getViewConfig(t),o=r.getItemsAttributeName(n),l=a.getBoundDataSourceNameByAttributePath(o),h=yield a.getDataSourceLoadParameters(l);h||r.throwSettingsExportError();const p=a.getAttributeViewModelConfig(o),y=yield r._createColumns(n,e,p,t),R={pagingConfig:h.options.pagingConfig,sortingConfig:h.options.sortingConfig};return(0,v.firstValueFrom)(r._entitySchemaQueryBuilder.build(e,y,h.parameters,R).pipe((0,w.b)(S=>{const E=r._getSelectedRows(a,n);r._addSelectedRowsToEsq(S,e.primaryAttributeName,E)})))})()}_buildFileName(t){const e=this._getDateTimePattern(),r=Lt()(new Date).format(e),a=this.getExportedViewTitle(t);return`${this._formattingFileName(a,r.length)}_${r}`}_getDateTimePattern(){if(!this._dateTimeFormatToken)return this._defaultDateTimePattern;const t=this._dateTimeFormatToken.shortDatePattern,e=this._dateTimeFormatToken.shortTimePattern;return`${t}_${e}`.replace(/[^\w]/gi,"_")}_formattingFileName(t,e){const r=this._maximumFileNameLength-e;return(0,f.PD7)(t).substring(0,r)}_export(t){var e=this;return(0,u.Z)(function*(){const r=e.getDataSchema(t);if(!(yield e._isCanExportToExcel(r)))throw new ie;const a=yield e._buildEsq(t,r),n=e._buildFileName(t);return(0,v.firstValueFrom)(e._exportToExcelService.exportRecordsFromEsqToExcel(a?.getMetadata(),n).pipe((0,O.U)(o=>{var l;if(!(!((l=o?.GetExportToExcelKeyResult)===null||l===void 0)&&l.success))throw new Error(o.GetExportToExcelKeyResult.errorInfo.message)})))})()}_getDialogErrorMessage(t){return t instanceof ie?this._translateService.instant("InfoDialog.ExportToExcel.PermissionsErrorMessage"):t instanceof oe?this._translateService.instant("InfoDialog.ExportToExcel.SettingsErrorMessage"):t.message}throwSettingsExportError(){throw new oe}getDataSchema(t){const e=t.$context,r=this.getViewItemsAttributeName(t),a=e.getBoundDataSchemaByAttributePath(r);return a||this.throwSettingsExportError(),a}handle(t){var e=this;return(0,u.Z)(function*(){try{return e._maskService.showBodyMask({delay:e._maskDelay}),yield e._export(t)}catch(r){e._handleError(r)}finally{e._maskService.hideBodyMask()}})()}};se=(0,d.gn)([(0,d.fM)(7,(0,s.Inject)(f.fI7)),(0,d.w6)("design:paramtypes",[_._h,C.xA,_.sQ,f.xYn,g.WX,x.sK,s.Injector,Object])],se);let Ne=class extends se{constructor(t,e,r,a,n,o,l,h){super(t,e,r,a,n,o,l,h),this._rightsService=t,this._dialogService=e,this._exportToExcelService=r,this._resourceFinderService=a,this._entitySchemaQueryBuilder=n,this._translateService=o,this._injector=l,this._dateTimeFormatToken=h}getViewConfig(t){return{columns:(Array.isArray(t.columns),t.columns),items:`$${this.getViewItemsAttributeName(t)}`}}getViewItemsAttributeName(t){return t.viewModelAttributeName}getExportedViewTitle(t){return t.fileName}};Ne=(0,d.gn)([(0,c.CrtRequestHandler)({requestType:"crt.ExportChartDataGridToExcelRequest",type:"crt.ExportChartDataGridToExcelHandler"}),(0,d.fM)(7,(0,c.CrtInject)(f.fI7)),(0,d.w6)("design:paramtypes",[_._h,C.xA,_.sQ,f.xYn,g.WX,x.sK,s.Injector,Object])],Ne);let be=class extends se{constructor(t,e,r,a,n,o,l,h,p){super(e,r,a,n,o,l,h,p),this._schemaService=t,this._rightsService=e,this._dialogService=r,this._exportToExcelService=a,this._resourceFinderService=n,this._entitySchemaQueryBuilder=o,this._translateService=l,this._injector=h,this._dateTimeFormatToken=p}getViewConfig(t){var e;return(e=this._schemaService.getViewConfigInfoByName(t.viewName))===null||e===void 0?void 0:e.viewConfig}getViewItemsAttributeName(t){const e=this.getViewConfig(t);return e?.items||this.throwSettingsExportError(),this.getItemsAttributeName(e)}getExportedViewTitle(t){const e=this.getDataSchema(t);return(0,f.BBt)(e.caption,this._translateService.currentLang)}};be=(0,d.gn)([(0,c.CrtRequestHandler)({requestType:"crt.ExportDataGridToExcelRequest",type:"crt.ExportDataGridToExcelHandler"}),(0,d.fM)(8,(0,c.CrtInject)(f.fI7)),(0,d.w6)("design:paramtypes",[H.QF,_._h,C.xA,_.sQ,f.xYn,g.WX,x.sK,s.Injector,Object])],be);let Pe=class extends c.BaseRequestHandler{constructor(t,e,r){super(),this._rightsService=t,this._dialogService=e,this._window=r,this._importOperationName="CanImportFromExcel"}_buildImportManagerUrl(t){const e=(0,f.MAR)(),r="NUI",a="ViewModule.aspx?isFreedomUI=true&vm=FileImportWizard#FileImportModule/FileImportStartPage",n=(0,c.generateGuid)(),o=t.entitySchemaName||"";return(0,f.Vo9)(e,r,a,n,o)}_openImportManager(t){const e=this._buildImportManagerUrl(t);this._window.open(e,"_blank")}_showOperationProhibitionDialog(){var t=this;return(0,u.Z)(function*(){(0,v.firstValueFrom)(t._dialogService.openOperationPermissionsErrorDialog(t._importOperationName))})()}_isCanImportFromExcel(){var t=this;return(0,u.Z)(function*(){return(0,v.firstValueFrom)(t._rightsService.getCanExecuteOperation(t._importOperationName))})()}handle(t){var e=this;return(0,u.Z)(function*(){if(!(yield e._isCanImportFromExcel())){yield e._showOperationProhibitionDialog();return}e._openImportManager(t)})()}};Pe=(0,d.gn)([(0,c.CrtRequestHandler)({requestType:"crt.ImportDataRequest",type:"crt.ImportDataHandler"}),(0,d.fM)(2,(0,c.CrtInject)(f.SCh)),(0,d.w6)("design:paramtypes",[_._h,C.xA,Object])],Pe);let it=class extends c.BaseRequest{};it=(0,d.gn)([(0,c.CrtRequest)({type:"crt.LoadRightsModuleRequest"})],it);let Ae=class extends c.BaseRequestHandler{handle(t){var e=this;return(0,u.Z)(function*(){const r=t.$context,a={type:"crt.7XRequest",action:"LoadRightsModule",$context:r,payload:{...t.payload}};return yield e.handlerChain.process(a)})()}};Ae=(0,d.gn)([(0,c.CrtRequestHandler)({type:"crt.LoadRightsModuleHandler",requestType:"crt.LoadRightsModuleRequest",scopes:[]})],Ae);let Ve=class extends c.BaseRequestHandler{_getDataSchema(t){const e=this._getDataSourceName(t);return t.$context.dataSchemas[e]}_getDataSourceName(t){return t.$context.getBoundDataSourceName(t.itemsAttributeName)}handle(t){var e=this;return(0,u.Z)(function*(){var r;const a=e._getDataSchema(t),n={type:"crt.7XRequest",action:"OpenLookupSource",$context:t.$context,payload:{entitySchemaName:(r=t.schemaName)!==null&&r!==void 0?r:a?.name,displayValue:a?.caption.toString()}};yield e.handlerChain.process(n)})()}};Ve=(0,d.gn)([(0,c.CrtRequestHandler)({requestType:"crt.OpenLookupSourceRequest",type:"crt.OpenLookupSourceHandler",scopes:[D.AllSections,D.AllCards]})],Ve);let Fe=class extends c.BaseRequestHandler{constructor(t,e){super(),this._translateService=t,this._dialogService=e}handle(t){var e=this;return(0,u.Z)(function*(){if(!t.schemaName){const a=e._translateService.instant("InfoDialog.OpenPage.SettingsErrorMessage");e._dialogService.openInfoDialog(a);return}const r={type:"crt.7XRequest",action:"OpenPage",$context:t.$context,payload:{schemaName:t.schemaName,modelInitConfigs:(0,ge.Z)(t.modelInitConfigs)}};return e.handlerChain.process(r)})()}};Fe=(0,d.gn)([(0,c.CrtRequestHandler)({requestType:"crt.OpenPageRequest",type:"crt.OpenPageHandler"}),(0,d.w6)("design:paramtypes",[x.sK,C.xA])],Fe);let He=class extends c.BaseRequestHandler{handle(t){var e=this;return(0,u.Z)(function*(){const r=t.$context,a={type:"crt.7XRequest",action:"HandlePhoneLinkClick",$context:r,$initialEvent:{...t.$initialEvent,phoneNumber:t.phoneNumber}};return yield e.handlerChain.process(a)})()}};He=(0,d.gn)([(0,c.CrtRequestHandler)({type:"crt.PhoneLinkClickHandler",requestType:"crt.PhoneLinkClickRequest",scopes:[]})],He);let Te=class extends c.BaseRequestHandler{_setTopRecord(t,e,r){var a=this;return(0,u.Z)(function*(){for(const[n,o]of Object.entries(t.attributes)){if(!(o instanceof g.xq&&t.getBoundDataSourceName(n)===e))continue;const p=o;if(p.length<2)continue;const y=p.slice(-1)[0];p.moveTo(y,0),yield a._processSetTopRecordRequest(t,n,r)}})()}_processSetTopRecordRequest(t,e,r){var a=this;return(0,u.Z)(function*(){const n={type:"crt.SetTopRecordRequest",$context:t,itemsAttributeName:e,primaryAttributeValue:r};yield a.handlerChain.process(n)})()}removedItemIndex(t,e,r){return(0,u.Z)(function*(){for(let a=0;a<t.length;a++){const n=t[a],o=n.getViewModelAttributePath(e,r.name);if((yield n[o])===r.value)return a}return-1})()}_onRecordDeleted(t,e,r){var a=this;return(0,u.Z)(function*(){for(const[n,o]of Object.entries(t.attributes))if(o instanceof g.xq&&t.getBoundDataSourceName(n)===e){const l=o,h=yield a.removedItemIndex(l,e,r);h>=0&&l.splice(h,1)}})()}_onRecordUpdated(t,e,r){var a=this;return(0,u.Z)(function*(){return yield a.handlerChain.process({type:"crt.LoadDataRequest",$context:t,dataSourceName:e,parameters:[{type:c.ModelParameterType.PrimaryColumnValue,value:"@requestPayload.primaryColumnValue"}],config:{loadType:f.BDN.Load,payload:{primaryColumnValue:r}}})})()}_onRecordCreated(t,e,r,a){var n=this;return(0,u.Z)(function*(){const o=yield n._onRecordUpdated(t,e,r),l=o?.[0];l?.[a.primaryAttributeName]===r.value&&(yield n._setTopRecord(t,e,r))})()}handle(t){var e=this;return(0,u.Z)(function*(){var r,a;const n=t.$context,o=(r=t.modelEvent.payload)===null||r===void 0?void 0:r.primaryAttributesValues,l=t.modelName,h=n.dataSchemas[l];for(const p of o){const y=p.find(R=>R.name===h.primaryAttributeName);switch(t.modelEvent.type){case g.wJ.Create:yield e._onRecordCreated(n,l,y,h);break;case g.wJ.Update:yield e._onRecordUpdated(n,l,y);break;case g.wJ.Delete:yield e._onRecordDeleted(n,l,y);break}}return(a=e.next)===null||a===void 0?void 0:a.handle(t)})()}};Te=(0,d.gn)([(0,c.CrtRequestHandler)({requestType:"crt.HandleModelEventRequest",type:"crt.ViewModelCollectionRecordChangedHandler"})],Te);let Be=class extends c.BaseRequestHandler{constructor(t){super(),this._processEngineService=t}_getPrimaryDsId(t){const e=t.$context,r=U(e),a=Se(e);if(!a||!r)return;const n=e.getViewModelAttributePath(r,a.primaryAttributeName);return t.$context[n]}_applyRecordIdToProcessParameters(t){var e=this;return(0,u.Z)(function*(){var r;if(t.recordIdProcessParameterName){const a=yield e._getPrimaryDsId(t);if(a){const n=(r=(0,ge.Z)(t.processParameters))!==null&&r!==void 0?r:{};return n[t.recordIdProcessParameterName]=a,n}}return t.processParameters})()}handle(t){var e=this;return(0,u.Z)(function*(){const r=t.processName,a=yield e._applyRecordIdToProcessParameters(t);return(0,v.lastValueFrom)(e._processEngineService.executeProcessByName(r,a),{defaultValue:null})})()}};Be=(0,d.gn)([(0,c.CrtRequestHandler)({type:"crt.RunBusinessProcessHandler",requestType:"crt.RunBusinessProcessRequest"}),(0,d.w6)("design:paramtypes",[_.zV])],Be);function ot(i){if(!Array.isArray(i))return null;const t=i.map(e=>e?.errorInfo).filter(Boolean);return{success:i.length===0||i.every(e=>e?.success),errorInfo:t.length===0?void 0:t.join(`
`),rowsAffected:i.reduce((e,r)=>e+r?.rowsAffected||0,0)}}let $e=class extends c.BaseRequestHandler{constructor(t){super(),this._dialogService=t,this._maskService=new c.MaskService}_savePrimaryData(t){var e=this;return(0,u.Z)(function*(){const r={type:"crt.SavePrimaryDataRequest",$context:t.$context},a=yield e.handlerChain.process(r);return ot(a)})()}_sendCardResponse(t,e){var r=this;return(0,u.Z)(function*(){var a,n,o;const l=yield t.getPrimaryModelName(),h=yield t.getPrimaryDataSchema(),p=t.getViewModelAttributePath(l,h.primaryAttributeName),y=t.getViewModelAttributePath(l,h.primaryDisplayAttributeName),R={type:"crt.7XRequest",action:"CardResponse",payload:{action:t.CardState,success:e,primaryDisplayColumnName:h.primaryDisplayAttributeName,uId:yield t[p],primaryColumnValue:yield t[p],primaryDisplayColumnValue:yield t[y],referenceSchemaName:(o=(n=(a=t.dataSchemas[l])===null||a===void 0?void 0:a.dataSourceConfig)===null||n===void 0?void 0:n.config)===null||o===void 0?void 0:o.entitySchemaName},$context:t};return r.handlerChain.process(R)})()}_displayErrorDialog(t){const e=t?.message;e&&this._dialogService.openInfoDialog(e)}handle(t){var e=this;return(0,u.Z)(function*(){yield e._maskService.showBodyMask({delay:0});try{const r=yield e._savePrimaryData(t);if(!r.success)throw new Error(r.errorInfo);return yield e._sendCardResponse(t.$context,!0),t.$context.IsChanged=!1,!0}catch(r){return e._displayErrorDialog(r),!1}finally{e._maskService.hideBodyMask()}})()}};$e=(0,d.gn)([(0,c.CrtRequestHandler)({requestType:"crt.SaveRecordRequest",type:"crt.SaveRecordHandler"}),(0,d.w6)("design:paramtypes",[C.xA])],$e);let ke=class extends c.BaseRequestHandler{constructor(t){super(),this._dialogService=t,this._maskService=new c.MaskService}_saveCollectionPrimaryData(t){var e=this;return(0,u.Z)(function*(){const r={type:"crt.SaveCollectionPrimaryDataRequest",$context:t.$context,primaryAttributeValues:t.recordIds,collectionAttributeName:t.itemsAttributeName},a=yield e.handlerChain.process(r);return ot(a)})()}_displayErrorDialog(t){const e=t?.message;e&&this._dialogService.openInfoDialog(e)}handle(t){var e=this;return(0,u.Z)(function*(){yield e._maskService.showBodyMask();try{const r=yield e._saveCollectionPrimaryData(t);if(r.success)return!0;throw new Error(r.errorInfo)}catch(r){return e._displayErrorDialog(r),!1}finally{e._maskService.hideBodyMask()}})()}};ke=(0,d.gn)([(0,c.CrtRequestHandler)({requestType:"crt.SaveRecordsRequest",type:"crt.SaveRecordsHandler"}),(0,d.w6)("design:paramtypes",[C.xA])],ke);let je=class extends c.BaseRequestHandler{_getEntityName(t){var e,r;const a=U(t.$context),n=(r=(e=t.$context.dataSchemas[a])===null||e===void 0?void 0:e.dataSourceConfig)===null||r===void 0?void 0:r.config;return n?.entitySchemaName}_updateSectionCaption(t){var e=this;return(0,u.Z)(function*(){yield e.handlerChain.process({type:"crt.7XRequest",action:"InitDataViews",$context:t.$context,payload:{entityName:e._getEntityName(t)}})})()}handle(t){var e=this;return(0,u.Z)(function*(){var r;return yield e._updateSectionCaption(t),(r=e.next)===null||r===void 0?void 0:r.handle(t)})()}};je=(0,d.gn)([(0,c.CrtRequestHandler)({requestType:"crt.HandleViewModelInitRequest",type:"crt.SectionInitHandler",scopes:[D.AllSections]})],je);var Ut=m(68338);let Oe=class extends c.BaseRequestHandler{constructor(t,e){super(),this._dialogService=t,this._translateService=e}_getPrimaryColumnValue(t){return(0,u.Z)(function*(){const e=yield t.getPrimaryModelName(),r=yield t.getPrimaryDataSchema(),a=t.getViewModelAttributePath(e,r.primaryAttributeName);return yield t[a]})()}_getLoadRightsModuleParameters(t){var e=this;return(0,u.Z)(function*(){const r=t.$context,a=yield r.getPrimaryDataSchema();return{primaryColumnValue:yield e._getPrimaryColumnValue(r),entitySchemaName:a.name}})()}_saveViewModel(t){var e=this;return(0,u.Z)(function*(){const{$context:r,scopes:a}=t,n={type:"crt.SaveRecordRequest",scopes:a,$context:r};return e.handlerChain.process(n)})()}_showSettingsErrorDialog(){var t=this;return(0,u.Z)(function*(){const e=t._translateService.instant("InfoDialog.SetRecordRights.SettingsErrorMessage");yield(0,v.firstValueFrom)(t._dialogService.openInfoDialog(e))})()}_isHasPrimaryDataSource(t){return(0,u.Z)(function*(){return!!(yield t.$context.getPrimaryModelName())})()}handle(t){var e=this;return(0,u.Z)(function*(){if(!(yield e._isHasPrimaryDataSource(t))){e._showSettingsErrorDialog();return}if(!(yield e._saveViewModel(t)))return;const{$context:r,scopes:a}=t,n=yield e._getLoadRightsModuleParameters(t),o={type:"crt.LoadRightsModuleRequest",scopes:a,$context:r,payload:n};return e.handlerChain.process(o)})()}};Oe=(0,d.gn)([(0,c.CrtRequestHandler)({requestType:"crt.SetRecordRightsRequest",type:"crt.SetRecordRightsRequest"}),(0,d.w6)("design:paramtypes",[Ut.xA,x.sK])],Oe);let ce=class extends c.BaseRequestHandler{constructor(t,e){super(),this._translateService=t,this._dialogService=e}_getEntitySchemaName(t){var e,r;const a=this._getDataSourceName(t),n=(r=(e=t.$context.dataSchemas[a])===null||e===void 0?void 0:e.dataSourceConfig)===null||r===void 0?void 0:r.config;return n?.entitySchemaName}_getDataSourceName(t){return t.$context.getBoundDataSourceName(t.itemsAttributeName)||U(t.$context)}handle(t){var e=this;return(0,u.Z)(function*(){var r;if(!t.entityName&&!t.itemsAttributeName||!t.recordId){const n=e._translateService.instant("InfoDialog.OpenPage.SettingsErrorMessage");e._dialogService.openInfoDialog(n);return}const a={type:"crt.7XRequest",action:"EditRecord",$context:t.$context,payload:{recordId:t.recordId,entityName:(r=t.entityName)!==null&&r!==void 0?r:e._getEntitySchemaName(t)}};return yield e.handlerChain.process(a)})()}};(0,d.gn)([(0,g.xB)(),(0,d.w6)("design:type",Function),(0,d.w6)("design:paramtypes",[Object]),(0,d.w6)("design:returntype",Promise)],ce.prototype,"handle",null),ce=(0,d.gn)([(0,c.CrtRequestHandler)({requestType:"crt.UpdateRecordRequest",type:"crt.UpdateRecordHandler"}),(0,d.w6)("design:paramtypes",[x.sK,C.xA])],ce);let st=class extends c.BaseRequest{};st=(0,d.gn)([(0,c.CrtRequest)({type:"crt.UploadEntityFileRequest"})],st);let Ze=class extends c.BaseRequestHandler{constructor(t){super(),this.fileApiService=t}_getDataSchema(t){const e=this._getDataSourceName(t);return t.$context.models.find(r=>r.dataSource.dataSourceName===e)}_getDataSourceName(t){return t.$context.getBoundDataSourceName(t.filesAttributeName)}handle(t){var e=this;return(0,u.Z)(function*(){var r;const a=e._getDataSchema(t),n=(r=a?.dataSource)===null||r===void 0?void 0:r.initialConfig,o=n.storageSchemaName,l=n.recordSchemaName,h=n.recordColumnName,p=t.$context.attributes[t.recordAttributeName],y={...t.detail.file,fileEntitySchemaName:o,recordEntitySchemaName:l,recordColumnName:h,recordId:p?.value||p};return n.storageSchemaName===n.entitySchemaName?yield(0,v.lastValueFrom)(e.fileApiService.upload(y),{defaultValue:null}):yield(0,v.lastValueFrom)(e.fileApiService.uploadAndAttach(y),{defaultValue:null})})()}};Ze=(0,d.gn)([(0,c.CrtRequestHandler)({requestType:"crt.UploadEntityFileRequest",type:"crt.UploadEntityFileHandler",scopes:[D.AllSections,D.AllCards]}),(0,d.w6)("design:paramtypes",[f.ZrX])],Ze);let ct=class extends c.BaseRequest{};ct=(0,d.gn)([(0,c.CrtRequest)({type:"crt.UploadDataAttributeFileRequest"})],ct);let Ge=class extends c.BaseRequestHandler{constructor(t){super(),this.fileApiService=t}handle(t){var e=this;return(0,u.Z)(function*(){const r={...t.detail.file,fileEntitySchemaName:"SysFile"};return yield(0,v.lastValueFrom)(e.fileApiService.uploadAsColumn(r),{defaultValue:null})})()}};Ge=(0,d.gn)([(0,c.CrtRequestHandler)({requestType:"crt.UploadDataAttributeFileRequest",type:"crt.UploadDataAttributeFileHandler",scopes:[D.AllSections,D.AllCards]}),(0,d.w6)("design:paramtypes",[f.ZrX])],Ge);const zt=JSON.parse(`{"ConfirmationDialog":{"DeleteRecordConfirmation":"Are you sure that you want to delete the selected record?","SaveDataGridConfigsForAllUsers":"Save list settings for all users?","ResetDataGridConfigsToDefault":"Restore default list settings?"},"InfoDialog":{"RightLevelWarningMessage":"Insufficient rights to delete records in the '{0}' object","UnableToDeleteSelectedRecord":"Unable to delete selected record","ExportToExcel":{"PermissionsErrorMessage":"You do not have permission to perform this operation.\\nPlease contact your system administrator. Check access to the export object and permission to perform the system operation.","SettingsErrorMessage":"Unable to execute the action.\\n\\rSystem administrator must check the button settings in the Freedom UI Designer."},"FileUpload":{"SizeValidationMessage":"{0} MB maximum file size limit exceeded.\\n\\r\\n\\r Files:\\n- {1}","NoConnectedFileList":"The file upload destination is not set.\\n\\rPlease choose the destination in the button settings.","InvalidRequestParams":"Unable to upload the file(s) as the page component has not been set up yet. The system administrator can finish the setup in the Freedom UI designer.","ChangeFileSizeInfoMessage":"You can increase the maximum file size in the \\"Attachment max size\\" system setting.","FileListHeader":"Files","MaxFileSizeExceededExceptionMessage":"{0} MB maximum file size limit exceeded."},"SetRecordRights":{"SettingsErrorMessage":"Action error.\\nContact your system administrator. Check the action settings in System Designer."},"OpenPage":{"SettingsErrorMessage":"Action error.\\nContact your system administrator. Check the action settings in System Designer."}}}`),qt=JSON.parse(`{"ConfirmationDialog":{"DeleteRecordConfirmation":"\u0412\u044B \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043B\u044C\u043D\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u0432\u044B\u0434\u0435\u043B\u0435\u043D\u043D\u0443\u044E \u0437\u0430\u043F\u0438\u0441\u044C?","SaveDataGridConfigsForAllUsers":"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0440\u0435\u0435\u0441\u0442\u0440\u0430 \u0434\u043B\u044F \u0432\u0441\u0435\u0445 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u0439?","ResetDataGridConfigsToDefault":"\u0412\u0435\u0440\u043D\u0443\u0442\u044C \u0434\u043B\u044F \u0440\u0435\u0435\u0441\u0442\u0440\u0430 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u043F\u043E \u0443\u043C\u043E\u043B\u0447\u0430\u043D\u0438\u044E?"},"InfoDialog":{"RightLevelWarningMessage":"\u041D\u0435\u0434\u043E\u0441\u0442\u0430\u0442\u043E\u0447\u043D\u043E \u043F\u0440\u0430\u0432 \u0434\u043B\u044F \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F \u0437\u0430\u043F\u0438\u0441\u0438 \u0432 \u043E\u0431\u044A\u0435\u043A\u0442\u0435 '{0}'","UnableToDeleteSelectedRecord":"\u0412\u044B\u0434\u0435\u043B\u0435\u043D\u043D\u0443\u044E \u0437\u0430\u043F\u0438\u0441\u044C \u043D\u0435 \u043F\u043E\u043B\u0443\u0447\u0438\u043B\u043E\u0441\u044C \u0443\u0434\u0430\u043B\u0438\u0442\u044C","ExportToExcel":{"PermissionsErrorMessage":"\u0423 \u0432\u0430\u0441 \u043D\u0435\u0442 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043D\u0438\u044F \u043D\u0430 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u0435 \u044D\u0442\u043E\u0439 \u043E\u043F\u0435\u0440\u0430\u0446\u0438\u0438.\\n\u041E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u043C\u0443 \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443. \u041F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435 \u0434\u043E\u0441\u0442\u0443\u043F \u043A \u043E\u0431\u044A\u0435\u043A\u0442\u0443 \u044D\u043A\u0441\u043F\u043E\u0440\u0442\u0430 \u0438 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043D\u0438\u0435 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u0439 \u043E\u043F\u0435\u0440\u0430\u0446\u0438\u0438.","SettingsErrorMessage":"\u041E\u0448\u0438\u0431\u043A\u0430 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044F.\\n\\r\u0421\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u043C\u0443 \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443 \u043D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u043F\u0440\u043E\u0432\u0435\u0440\u0438\u0442\u044C \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u043A\u043D\u043E\u043F\u043A\u0438 \u0432  \u0434\u0438\u0437\u0430\u0439\u043D\u0435\u0440\u0435 Freedom UI."},"FileUpload":{"SizeValidationMessage":"\u041F\u0440\u0435\u0432\u044B\u0448\u0435\u043D \u043C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u044B\u0439 \u0440\u0430\u0437\u043C\u0435\u0440 \u0444\u0430\u0439\u043B\u0430: {0} \u041C\u0411.\\n\\r\\n\\r \u0424\u0430\u0439\u043B\u044B:\\n- {1}","NoConnectedFileList":"\u0421\u043F\u0438\u0441\u043E\u043A, \u043A\u0443\u0434\u0430 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0442\u044C \u0444\u0430\u0439\u043B\u044B, \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D.\\n\\r\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043F\u0438\u0441\u043E\u043A \u0434\u043B\u044F \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0444\u0430\u0439\u043B\u043E\u0432 \u0432 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430\u0445 \u044D\u0442\u043E\u0439 \u043A\u043D\u043E\u043F\u043A\u0438.","InvalidRequestParams":"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0444\u0430\u0439\u043B(\u044B), \u0442\u0430\u043A \u043A\u0430\u043A \u0434\u0430\u043D\u043D\u044B\u0439 \u043A\u043E\u043C\u043F\u043E\u043D\u0435\u043D\u0442 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u044B \u0435\u0449\u0435 \u043D\u0435 \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043D. \u0410\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440 \u0441\u0438\u0441\u0442\u0435\u043C\u044B \u043C\u043E\u0436\u0435\u0442 \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044C \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0443 \u043A\u043E\u043C\u043F\u043E\u043D\u0435\u043D\u0442\u0430 \u0432 \u0434\u0438\u0437\u0430\u0439\u043D\u0435\u0440\u0435 Freedom UI.","ChangeFileSizeInfoMessage":"\u0423\u0432\u0435\u043B\u0438\u0447\u0438\u0442\u044C \u044D\u0442\u043E \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435 \u043C\u043E\u0436\u043D\u043E \u0432 \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u0439 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0435 \xAB\u041C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u044B\u0439 \u0440\u0430\u0437\u043C\u0435\u0440 \u0444\u0430\u0439\u043B\u0430\xBB.","FileListHeader":"\u0424\u0430\u0439\u043B\u044B","MaxFileSizeExceededExceptionMessage":"\u041F\u0440\u0435\u0432\u044B\u0448\u0435\u043D \u043C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u044B\u0439 \u0440\u0430\u0437\u043C\u0435\u0440 \u0444\u0430\u0439\u043B\u0430 {0} \u041C\u0411."},"SetRecordRights":{"SettingsErrorMessage":"\u041E\u0448\u0438\u0431\u043A\u0430 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044F.\\n\u041E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u043C\u0443 \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443. \u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u0430 \u043F\u0440\u043E\u0432\u0435\u0440\u043A\u0430 \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043A \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044F \u0432 System Designer."},"OpenPage":{"SettingsErrorMessage":"\u041E\u0448\u0438\u0431\u043A\u0430 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044F.\\n\u041E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u043C\u0443 \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443. \u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u0430 \u043F\u0440\u043E\u0432\u0435\u0440\u043A\u0430 \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043A \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044F \u0432 System Designer."}}}`),Xt={"en-US":zt,"ru-RU":qt};let lt=class extends c.BaseRequest{};lt=(0,d.gn)([(0,c.CrtRequest)({type:"crt.7XRequest"})],lt);let Le=class extends c.BaseRequestHandler{handle(t){var e=this;return(0,u.Z)(function*(){var r;const a=t.$context,n=a.dataSchemas,o=Object.entries(n).filter(([,l])=>{var h,p;return((p=(h=l.dataSourceConfig)===null||h===void 0?void 0:h.config)===null||p===void 0?void 0:p.entitySchemaName)===t.entitySchemaName}).map(([l])=>l);for(const l of o)yield e.handlerChain.process({type:"crt.HandleModelEventRequest",$context:a,modelName:l,modelEvent:t.modelEvent});return(r=e.next)===null||r===void 0?void 0:r.handle(t)})()}};Le=(0,d.gn)([(0,c.CrtRequestHandler)({requestType:"crt.7XHandleModelEventRequest",type:"crt.CrtModelEventHandler"})],Le);var Wt=m(23931),Jt=m(44551),le=m(73328);let Ue=class extends c.BaseRequestHandler{constructor(t,e,r,a,n,o){super(),this._window=t,this._fileApiService=e,this._fileService=r,this._dialogService=a,this._translateService=n,this._sysSettingsService=o,this._maskDelay=0,this._maskService=new c.MaskService}_tryReloadLinkedList(t){if(!t.viewElementName)return;const e=`${t.viewElementName}${g.gW}`,{scopes:r,$context:a}=t,n={type:"crt.LoadDataRequest",scopes:r,config:{loadType:f.BDN.Reload},$context:a,dataSourceName:e};this.handlerChain.process(n)}_onFileSelected(t,e){var r=this;return(0,u.Z)(function*(){const a=[...t],n=yield(0,v.lastValueFrom)(r._sysSettingsService.getByCode("MaxFileSize")),o=e.maximumAllowedFileSize,l=n?.value||0,h=o?Math.min(l,e.maximumAllowedFileSize):l,p=h*1048576,y=a.filter(N=>N.size<=p),R=r._getMaxFileSizeExceededExceptionCode(),S=le.String.Format(r._translateService.instant("InfoDialog.FileUpload.MaxFileSizeExceededExceptionMessage"),h),E=a.filter(N=>N.size>p).map(N=>({error:R,message:S,file:N}));let Y=0;r._maskService.showBodyMask({delay:r._maskDelay}),(0,v.from)(y).pipe((0,qe.z)(N=>r._fileService.read(N)),(0,O.U)(N=>{const B=(0,c.generateGuid)();return{...N,id:B,recordColumnName:e.recordColumnName,fileEntitySchemaName:e.fileEntitySchemaName,recordEntitySchemaName:e.recordEntitySchemaName,recordId:e.recordId,fileGroup:e.fileGroup,tag:e.tag}}),(0,Jt.b)(N=>r._fileApiService.upload(N).pipe((0,v.catchError)(B=>{var Q;const ut=B?.status===400,ht=(Q=B.error)===null||Q===void 0?void 0:Q.error,er={file:B.file,error:ut?ht:B.errorCode,message:ut?ht:B.message};return E.push(er),(0,v.of)(null)})))).subscribe({next:N=>{Y++,Y>=y.length&&(r._maskService.hideBodyMask(),r._tryReloadLinkedList(e),r._checkErrorsAndShowMessage(E))},complete:()=>{y.length===0&&r._checkErrorsAndShowMessage(E),r._maskService.hideBodyMask()}})})()}_checkErrorsAndShowMessage(t){const e=this._getFilesUploadErrorMessage(t);e&&this._dialogService.openInfoDialog(e)}_getMaxFileSizeExceededExceptionCode(){return"MaxFileSizeExceededException"}_getIsOversizedErrorExist(t){return t&&t.some(e=>e.error===this._getMaxFileSizeExceededExceptionCode())}_getOversizeErrorTipMessage(t){const e=this._getIsOversizedErrorExist(t),r=`{0}\r
\r
`;return e?le.String.Format(r,this._translateService.instant("InfoDialog.FileUpload.ChangeFileSizeInfoMessage")):le.String.Empty}_getFormattedFilesNames(t){const e=`\r
`;return t.map(a=>"- "+a.file.name).join(e)}_getFilesUploadErrorMessage(t){t=t.reverse();const e=`\r
\r
`,r=this._translateService.instant("InfoDialog.FileUpload.FileListHeader"),a="{0}"+e+r+`:\r
{1}`,n=Wt.Z.groupBy(t,"message");let o="";for(const[l,h]of Object.entries(n)){const p=this._getFormattedFilesNames(h);o+=le.String.Format(a,l,p),o+=e}return o+=this._getOversizeErrorTipMessage(t),o.slice(0,o.length-e.length)}_removeInput(t,e){setTimeout(()=>{delete t.onchange,e.documentElement.removeChild(t)},1e3)}checkRequestParams(t){const e=t.recordId;return e?.value&&(t.recordId=e.value),t.recordId instanceof g.Z1&&(t.recordId=null),this.validateRequest(t)}validateRequest(t){if(!t.recordId||!t.recordColumnName||!t.fileEntitySchemaName){const e=this._translateService.instant("InfoDialog.FileUpload.InvalidRequestParams");return this._dialogService.openInfoDialog(e),!1}return!0}handle(t){var e=this;return(0,u.Z)(function*(){if(!e.checkRequestParams(t))return;if(t.files){yield e._onFileSelected(t.files,t);return}const r=e._window.document,a=r.createElement("input");a.id="file-upload",a.type="file",a.multiple=!0,a.accept=t.allowedFileTypes,a.style="display: none",a.onchange=function(){var n=(0,u.Z)(function*(o){yield e._onFileSelected(o.target.files,t)});return function(o){return n.apply(this,arguments)}}(),r.documentElement.appendChild(a),yield a.click(),e._removeInput(a,r)})()}};Ue=(0,d.gn)([(0,c.CrtRequestHandler)({requestType:"crt.UploadFileRequest",type:"crt.UploadFileHandler"}),(0,d.fM)(0,(0,c.CrtInject)(f.SCh)),(0,d.w6)("design:paramtypes",[Object,f.ZrX,f.OKr,C.xA,x.sK,_.lI])],Ue);var K=m(59085);let dt=(()=>{class i{constructor(){this._repository=new Map}set(e,r){this._repository.set(e,r)}get(e){return this._repository.get(e)}getAll(){return Array.from(this._repository.values())}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=s.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),Kt=(()=>{class i extends g.pe{constructor(e,r,a){super(r,a),this._dataSourceRepository=e}create(e,r,a={}){return super.create(e,r,a).pipe((0,w.b)(n=>{this._dataSourceRepository.set(e,n)}))}}return i.\u0275fac=function(e){return new(e||i)(s.\u0275\u0275inject(dt),s.\u0275\u0275inject(s.Injector),s.\u0275\u0275inject(g.lW))},i.\u0275prov=s.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac}),i})(),Yt=(()=>{class i extends K.hCW{constructor(e,r,a,n){super(),this._dataSourceRepository=e,this._dataSchemaRepository=r,this._entityBackwardReferenceService=a,this._featureValues=n}getDataSchemaAttributeByPath(e){return(0,v.throwError)(new Error("Method not implemented"))}getDataSchemaByName(e){return this._dataSchemaRepository.get(e)}getDataSourceByName(e){return(0,v.of)(this._dataSourceRepository.get(e))}getDataSources(){return(0,v.of)(this._dataSourceRepository.getAll())}getDataSchemaBackReference(e){return this._featureValues.UseBackwardReferencesInStructureExplorer?this._entityBackwardReferenceService.getBackwardReferences(e):(0,v.of)([])}}return i.\u0275fac=function(e){return new(e||i)(s.\u0275\u0275inject(dt),s.\u0275\u0275inject(g.af),s.\u0275\u0275inject(K.EGN),s.\u0275\u0275inject(_.Sf))},i.\u0275prov=s.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac}),i})(),ze=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=s.\u0275\u0275defineNgModule({type:i}),i.\u0275inj=s.\u0275\u0275defineInjector({providers:[{provide:K.hCW,useClass:Yt}],imports:[[K.NUS]]}),i})();(function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(ze,{imports:[K.NUS]})})();var Qt=m(33177);let L=class{};L.\u0275fac=function(t){return new(t||L)},L.\u0275mod=s.\u0275\u0275defineNgModule({type:L}),L.\u0275inj=s.\u0275\u0275defineInjector({providers:[_.g4,_.Ln,_.hH,_.ig,{provide:f.IYW,useClass:f.Sst},g.yo,{provide:P.Ecz,useClass:Ot},V.yL,{provide:P.ebJ,useFactory:i=>new V.S$(i),deps:[V.Y5]},V.Y5,{provide:g.pe,useClass:Kt},f.OKr,f.ZrX,_.js,_.jC,{provide:P.dfR,useClass:V.Nk},j.r$,f.GfR,{provide:j.JQ,useExisting:j.oq}],imports:[[k.PW,Z.iu,M.CommonModule,P.MV_,C.Su,b.u5,Z.xC,Z.Io,g.kz,b.UX,me,ze,T,F.qi,$.HttpClientXsrfModule.withOptions({cookieName:"BPMCSRF",headerName:"BPMCSRF"}),x.aw.forRoot({defaultLanguage:"en-US",loader:{provide:x.Zw,useFactory:(i,t)=>new ee.w(i,t+"ClientApp/assets/i18n/"),deps:[$.HttpClient,M.APP_BASE_HREF]}}),I.X.forRoot({i18n:Xt}),X.Kq]]}),L=(0,d.gn)([(0,c.CrtModule)({includes:[P.MV_,Z.iu,Z.xC,Z.Io,Z.Lr,g.kz,T],converters:[pe],requestHandlers:[Re,Ce,ve,ye,fe,ae,$e,ke,De,ce,Ie,te,_e,Me,ne,xe,re,je,Be,Fe,Ee,He,Te,Le,Ae,Ve,Ze,Ue,Ge,we,Ne,be,Pe,Oe],handlerChainServices:[g.a8,C.Bm,_.Yh,_._h,_.lI,j.JQ,f.tIP,_.UZ]})],L),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(L,{declarations:[We,Je,Ke,Ye],imports:[k.PW,Z.iu,M.CommonModule,P.MV_,C.Su,b.u5,Z.xC,Z.Io,g.kz,b.UX,me,ze,T,F.qi,$.HttpClientXsrfModule,x.aw,Qt.CrtLibTranslateModule,X.Kq]})}()},40038:G=>{G.exports=`<svg id="Component_164_1" data-name="Component 164 \u2013 1" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
  <g id="Rectangle_6510" data-name="Rectangle 6510" transform="translate(2 3)" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="1">
    <rect width="11" height="13" stroke="none"/>
    <rect x="0.5" y="0.5" width="10" height="12" fill="none"/>
  </g>
  <g id="Group_7507" data-name="Group 7507" transform="translate(424.867 -406.301)">
    <path id="Path_6950" data-name="Path 6950" d="M-419.367,406.8h10v12" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="1"/>
  </g>
  <path id="Path_5597" data-name="Path 5597" d="M-419.3,412.284h4.985" transform="translate(424.305 -405.784)" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="1"/>
  <path id="Path_5598" data-name="Path 5598" d="M-419.3,414.2h2.971" transform="translate(424.305 -405.784)" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="1"/>
  <rect id="Rectangle_1928" data-name="Rectangle 1928" width="16" height="16" fill="none"/>
</svg>
`},77896:G=>{G.exports=`<svg id="Delete" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
  <g id="Delete-2" data-name="Delete">
    <g id="Group_2209" data-name="Group 2209" transform="translate(2 1)">
      <rect id="Rectangle_1349" data-name="Rectangle 1349" width="1" height="7" transform="translate(3 4)" fill="currentColor"/>
      <rect id="Rectangle_1350" data-name="Rectangle 1350" width="1" height="7" transform="translate(7 4)" fill="currentColor"/>
      <rect id="Rectangle_1351" data-name="Rectangle 1351" width="1" height="7" transform="translate(5 4)" fill="currentColor"/>
      <path id="Path_1876" data-name="Path 1876" d="M1026-153h-3v-2h-5v2h-3v1h1v8.9l1.41,1.1h6.15l1.45-1.1V-152h1Zm-7-1h3v1h-3Zm5,10.4-.78.6h-5.47l-.75-.59V-152h7Z" transform="translate(-1015 155)" fill="currentColor"/>
    </g>
    <rect id="Rectangle_1352" data-name="Rectangle 1352" width="16" height="16" fill="none"/>
  </g>
</svg>
`},80525:G=>{G.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M7.00011 5.50028L10.5001 5.50028L10.5001 9.00031" stroke="currentColor"/>
<path d="M5 11L10.5 5.5" stroke="currentColor"/>
<rect x="2.5" y="2.5" width="11" height="11" rx="0.5" stroke="currentColor"/>
</svg>
`}}]);
