(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[410],{17410:(ne,ae,S)=>{"use strict";S.r(ae);var X=S(84693),ee=S(13622),u=S(55069),f=S(34553),y=S(64762),I=S(30660),w=S(37686),c=S(36599),k=S(21278),_=S(75629),F=S(93555),N=S(58377),p=S(16724),b=S(12182),A=S(94881),v=S(69678),g=S(33376),te=S(13528),V=S(27969),T=S(33568);let Ve=(()=>{class n{constructor(e){this.httpClient=e,this._getDcmServiceEndpoint="rest/DcmService/GetDcmStageColumnName",this._destroyed$=new g.Subject}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}getStageColumnName(e){return this.httpClient.post(this._getDcmServiceEndpoint,{entitySchemaName:e}).pipe((0,te.R)(this._destroyed$),(0,V.U)(t=>t.GetDcmStageColumnNameResult),(0,T.K)(()=>(0,g.of)(null)))}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(w.HttpClient))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})(),at=(()=>{class n{constructor(e,t){this._featureService=e,this._dcmSettingsService=t,this._actionDashboardPreprocessingDisableFeature="DisableActionDashboardPreprocessing"}get isProcessingDisabled(){return(0,g.lastValueFrom)(this._featureService.getFeatureState(this._actionDashboardPreprocessingDisableFeature))}_getStageColumnName(e){var t=this;return(0,f.Z)(function*(){return(0,g.lastValueFrom)(t._dcmSettingsService.getStageColumnName(e),{defaultValue:null})})()}_checkExistingAttribute(e,t){var r;let i=!1;for(const a in e)((r=e[a].modelConfig)===null||r===void 0?void 0:r.path)===t&&(i=!0);return i}_addStageAttribute(e,t,r){const i=e.viewModelConfig.attributes||{},a=`${r}.${t}`;if(!this._checkExistingAttribute(i,a)){const s=`LookupAttribute_${t}`;i[s]={modelConfig:{path:a}},e.viewModelConfig.attributes=i}}_extendWithDcmStageAttribute(e,t){var r=this;return(0,f.Z)(function*(){const i=yield r._getStageColumnName(t.viewConfig.entitySchemaName);i&&r._addStageAttribute(e,i,t.viewConfig.dataSourceName)})()}_getPrimaryModel(e,t){return t.find(i=>i.name===e)||t[0]}processItemsAsync(e,t,r){var i=this;return(0,f.Z)(function*(){const a=e.map(function(){var s=(0,f.Z)(function*(l){const d=t.getDataSource(),m=yield(0,g.lastValueFrom)(t.getSchema());l.viewConfig.dataSourceName=d.dataSourceName,l.viewConfig.entitySchemaName=m.name,l.viewConfig.primaryColumnValue=`$${m.primaryAttributeName}`,l.viewConfig.primaryDisplayColumnValue=`$${m.primaryDisplayAttributeName}`,yield i._extendWithDcmStageAttribute(r,l)});return function(l){return s.apply(this,arguments)}}());yield Promise.all(a)})()}crtOnMetaDataInit(e){var t=this;return(0,f.Z)(function*(){if(yield t.isProcessingDisabled)return e;const r=e;return v.AXp.getViewConfigInfoByProperty("type","crt.ActionDashboard",r.viewConfig).forEach(a=>{a.viewConfig.allowedActions||(a.viewConfig.allowedActions=(0,A.L0N)())}),e})()}crtOnViewModelInit(e,t,r){var i=this;return(0,f.Z)(function*(){if((yield i.isProcessingDisabled)||t.length===0)return e;const a=e,s=v.AXp.getViewConfigInfoByProperty("type","crt.ActionDashboard",a.viewConfig),d=yield r.getPrimaryModelName(),m=i._getPrimaryModel(d,t);return yield i.processItemsAsync(s,m,a),e})()}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(b.UZ),c.\u0275\u0275inject(Ve))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})(),st=(()=>{class n{constructor(e){this._featureService=e,this._componentName="crt.Approval"}get isProcessingDisabled(){return(0,g.lastValueFrom)(this._featureService.getFeatureState("DisableApprovalsPreprocessing"))}_getApprovals(e){return v.AXp.getViewConfigInfoByProperty("type",this._componentName,e.viewConfig)}_getApprovalName(e){return e.name.replace(/\./g,"_")}crtOnModelInit(e,t){var r=this;return(0,f.Z)(function*(){if(yield r.isProcessingDisabled)return e;const i=e,a=r._getApprovals(i);for(const s of a){const l=s?.viewConfig;let d=i.viewModelConfig.attributes;d||(d=i.viewModelConfig.attributes={});const m=r._getApprovalName(l);d[`${m}_ApprovalsList`]={value:[]}}return e})()}crtOnViewModelInit(e,t,r){var i=this;return(0,f.Z)(function*(){if(yield i.isProcessingDisabled)return e;const a=e,s=i._getApprovals(a);for(const l of s){const d=l?.viewConfig,C=`${i._getApprovalName(d)}_ApprovalsList`;d.recordId="$Id",d.approvals=`$${C}`,d.loadData={request:"crt.ApprovalLoadDataRequest",params:{dataAttribute:C,config:"@event"}},d.approvalClick={request:"crt.ApprovalActionHandlerRequest",params:{config:"@event"}}}return e})()}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(b.UZ))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})(),lt=(()=>{class n{constructor(e){this._configurationDataService=e}_getMenuItem(e,t,r){return{type:"crt.MenuItem",caption:e.captionLcz,clicked:{request:"crt.CreateRecordRequest",params:{entityName:t,entityPageName:e.cardSchemaName,defaultValues:r}}}}_getDefaultValues(e,t,r){const i=r?[{attributeName:r,value:e.typeId}]:[];return t.length&&i.splice(0,0,...t),i}_getEntityName(e,t){const r=e.viewConfig.clicked.params;let i=r.entityName;if(!i){const a=r.itemsAttributeName;if(a){const s=t.getBoundDataSourceNameByAttributePath(a),l=t.dataSchemas[s];i=l?.name}}return i}_getButtonsWithCreateRecordRequest(e){return v.AXp.getViewConfigInfoByProperty("type","crt.Button",e.viewConfig).filter(r=>{const i=r.viewConfig.clicked;return i?.params&&i.request==="crt.CreateRecordRequest"})}_fillMenuItems(e,t){var r=this;return(0,f.Z)(function*(){var i,a,s,l,d,m,C;const h=r._getEntityName(e,t);if(!h)return;const D=yield(0,g.lastValueFrom)(r._configurationDataService.getEntityData(h),{defaultValue:null}),M=((a=(i=D?.data)===null||i===void 0?void 0:i.entityStructure)===null||a===void 0?void 0:a.pages)||[];if(M.length>1){e.viewConfig.clickMode="menu";const R=(l=(s=D?.data)===null||s===void 0?void 0:s.entityStructure)===null||l===void 0?void 0:l.typeColumnName,q=((d=e.viewConfig.clicked.params)===null||d===void 0?void 0:d.defaultValues)||[],Z=M.map(W=>{const K=r._getDefaultValues(W,q,R);return r._getMenuItem(W,h,K)});(m=(C=e.viewConfig).menuItems)!==null&&m!==void 0||(C.menuItems=[]),e.viewConfig.menuItems.splice(0,0,...Z)}})()}crtOnViewModelInit(e,t,r){var i=this;return(0,f.Z)(function*(){const a=e,s=i._getButtonsWithCreateRecordRequest(a);return yield Promise.all(s.map(function(){var l=(0,f.Z)(function*(d){yield i._fillMenuItems(d,r)});return function(d){return l.apply(this,arguments)}}())),e})()}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(b.iD))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})();var Ee=S(33177);function xe(n){return{request:"crt.LoadDataRequest",params:{dataSourceName:n,parameters:[]}}}function $e(){return{rowCount:30}}function z(n,o){if(typeof n=="string"){const e=n.startsWith("$"),t=n.slice(1).split(".").pop()||"",r=o?.[t]!=null;return e&&r}return!1}const Be=["crt.DataGrid","crt.FileList"];function se(n,o){const{viewConfig:e}=n;return o=o&&o.length>0?o:void 0,v.AXp.getViewConfigInfoByPropertyForValues("type",o||Be,e).filter(t=>Boolean(t)).map(({viewConfig:t})=>t).filter(({name:t})=>t)||[]}function L(n,o){const{viewModelConfig:e}=n;return se(n,o).filter(({items:t})=>z(t,e.attributes))}let le=(()=>{class n{constructor(e,t,r){this._sysSettingsService=e,this._translateService=t,this._dataSchemaRepository=r,this._defaultDropdownPageSize=50,this._dropdownMinimumPageSize=10}_extendWithList(e,t){e.showList={request:"crt.LoadDataRequest",params:{dataSourceName:`${t}_DS`,config:{loadType:"reload"},parameters:[],viewElement:"@event.viewElement",filterValue:"@event.filterValue"},useRelativeContext:!0}}_extendWithListActions(e,t){if(!e.listActions&&(e.listActions=[],e.isAddAllowed)){const i={...A.RCT,name:Ee.NameGenerator.generateUnique("ListAction")};e.listActions.push(i)}const r=e.listActions.find(i=>i.code===A.aIe.AddRecord);if(r){const i=e.attributeName;r.clicked.params={itemsAttributeName:`${t}`,attributeName:`${i}`,detail:"@event.detail"}}}_extendWithControlActions(e,t){if(!e.controlActions&&(e.controlActions=[],e.isGoToSourceAllowed)){const i={...A.FFE,name:Ee.NameGenerator.generateUnique("ControlAction")};e.controlActions.push(i)}const r=e.controlActions.find(i=>i.code===A.aIe.GoToRecordList);r&&(r.clicked.params={itemsAttributeName:`${t}`})}_getReferenceSchemaName(e,t){const r=e.items.slice(1);return t.getBoundDataSchemaByAttributePath(r).name}_formBusinessRuleFilterAttributeName(e){return`${e}_BusinessRule_Filter`}_extendWithLinkViewConfig(e,t,r){const i=this._getReferenceSchemaName(e,t),a=this._translateService.instant("ComboBox.EmptyDisplayValue"),s=e.attributeName;e.linkViewConfig={type:"crt.Link",mode:"preventDefault",caption:`$${s} | crt.ToObjectProp : 'displayValue' : '${a}'`,href:`$${s} | crt.ToObjectProp : 'value' | crt.ToRecordLinkAsync : '${r}'`,clicked:{request:"crt.UpdateRecordRequest",params:{itemsAttributeName:s,recordId:`$${s} | crt.ToObjectProp : 'value'`,entityName:i}}}}_extendCombobox(e,t){this._extendWithList(e,t),this._extendWithListActions(e,t),this._extendWithControlActions(e,t)}_setPaginationChange(e,t){if(e.paginationChange)return;const r=e.items.slice(1),i=t.getBoundDataSourceNameByAttributePath(r);e.paginationChange={request:"crt.LoadDataRequest",params:{dataSourceName:i,parameters:[]},useRelativeContext:!0}}_checkEditPagesAndExtendWithLinkViewConfig(e,t){var r=this;return(0,f.Z)(function*(){if(!e.showValueAsLink)return;if(yield r._hasSectionEditPage(e,t)){const a=e.items.slice(1);r._extendWithLinkViewConfig(e,t,a)}})()}_addListAttribute(e,t){e[t]||(e[t]={isCollection:!0,isLookup:!0})}_addBusinessRuleListFilterAttribute(e,t){const r=this._formBusinessRuleFilterAttributeName(t);e[r]||(e[r]={value:{}})}_setBusinessRuleLookupFilterConfig(e,t){var r;const i=e[t],a=[...new Set([...((r=i.businessRulesConfig)===null||r===void 0?void 0:r.businessRulesFilters)||[],this._formBusinessRuleFilterAttributeName(`${t}_List`)])];i.businessRulesConfig={...i.businessRulesConfig,businessRulesFilters:a}}_setEmbeddedModel(e,t){return(0,f.Z)(function*(){var r;const{vmListAttribute:i,model:a,comboboxAttributeName:s}=e,l=yield(0,g.lastValueFrom)(a.getSchema(),{defaultValue:null}),d=l?.attributes,m=(r=d?.find(({name:h})=>h===t))===null||r===void 0?void 0:r.referenceSchemaName,C={name:`${s}_List_DS`,config:{type:"crt.EntityDataSource",config:{entitySchemaName:m}}};i.embeddedModel=C})()}_setViewModelConfig(e,t){var r=this;return(0,f.Z)(function*(){const{vmListAttribute:i,model:a,comboboxAttributeName:s}=e,l=yield(0,g.lastValueFrom)(a.getSchema(),{defaultValue:null}),d=l?.findAttributeByName(t),m=yield(0,g.lastValueFrom)(r._dataSchemaRepository.get(d?.referenceSchemaName),{defaultValue:null}),C={attributes:{value:{modelConfig:{path:`${s}_List_DS.${m?.primaryAttributeName}`}},displayValue:{modelConfig:{path:`${s}_List_DS.${m?.primaryDisplayAttributeName}`}}}};i.viewModelConfig=C})()}_setModelConfig(e,t){var r=this;return(0,f.Z)(function*(){const{vmListAttribute:i,model:a,comboboxAttributeName:s}=e,l=yield(0,g.lastValueFrom)(a.getSchema(),{defaultValue:null}),d=l?.findAttributeByName(t),m=yield(0,g.lastValueFrom)(r._dataSchemaRepository.get(d?.referenceSchemaName),{defaultValue:null}),C=yield r._getPagingSize(),h={path:`${s}_List_DS`,sortingConfig:{attributeName:`${s}_List_Sorting`,default:[{columnName:m?.primaryDisplayAttributeName,direction:"asc"}]},pagingConfig:{rowCount:C,rowsOffset:null},filterAttributes:[{name:r._formBusinessRuleFilterAttributeName(`${s}_List`),loadOnChange:!0}]};i.modelConfig=h})()}_getPagingSize(){var e=this;return(0,f.Z)(function*(){const t=yield e._getSystemPagingSize();return e._getValidPagingSize(t)})()}_getSystemPagingSize(){return(0,g.lastValueFrom)(this._sysSettingsService.getByCode("DropdownPageSize").pipe((0,V.U)(e=>this._parseSystemPagingSize(e.value)),(0,T.K)(()=>(0,g.of)(this._defaultDropdownPageSize))))}_getValidPagingSize(e){return e>=this._dropdownMinimumPageSize?e:this._dropdownMinimumPageSize}_parseSystemPagingSize(e){const t=parseInt(e);return t||this._defaultDropdownPageSize}_setComboboxListAttribute({attributes:e,models:t,comboboxAttributeName:r}){var i=this;return(0,f.Z)(function*(){var a,s;const l=(a=e[r].modelConfig)===null||a===void 0?void 0:a.path.split(".")[0],d=(s=e[r].modelConfig)===null||s===void 0?void 0:s.path.split(".").pop(),m=e[`${r}_List`],C=t.find(D=>D.name===l),h={vmListAttribute:m,model:C,comboboxAttributeName:r};i._setEmbeddedModel(h,d),i._setViewModelConfig(h,d),yield i._setModelConfig(h,d)})()}_setComboboxListSortingAttribute(e,t){e[`${t}_List_Sorting`]={isCollection:!0,viewModelConfig:{attributes:{columnName:{},direction:{}}}}}_hasSectionEditPage(e,t){var r=this;return(0,f.Z)(function*(){const i=r._getReferenceSchemaName(e,t),a={type:"crt.7XRequest",action:"HasEntityEditPage",$context:t,payload:{entityName:i}};return yield u.HandlerChainService.instance.process(a)})()}crtOnMetaDataInit(e,t){const r=e.control;if(z(r,t)){const i=r.slice(1).split(".").pop()||"";this._setBusinessRuleLookupFilterConfig(t,i);const a=e.items,s=`${i}_List`;z(a,t)?t[a.slice(1)].isLookup=!0:(this._addListAttribute(t,s),e.items=`${r}_List`),this._addBusinessRuleListFilterAttribute(t,s),e.attributeName=i,this._extendCombobox(e,s)}}crtOnModelInit(e,t,r){var i=this;return(0,f.Z)(function*(){const a=e.control;if(z(a,t)){const s=a.slice(1).split(".").pop()||"";i._setComboboxListSortingAttribute(t,s),yield i._setComboboxListAttribute({attributes:t,models:r,comboboxAttributeName:s})}})()}crtOnViewModelInit(e,t,r){var i=this;return(0,f.Z)(function*(){const a=e.items;z(a,t)&&(yield i._checkEditPagesAndExtendWithLinkViewConfig(e,r),i._setPaginationChange(e,r))})()}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(b.lI),c.\u0275\u0275inject(_.sK),c.\u0275\u0275inject(p.af))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})(),dt=(()=>{class n{constructor(e,t){this._featureService=e,this._comboboxPreprocessorService=t,this._comboboxActionsProcessingDisableFeature="DisableComboboxActionsPreprocessing"}get _isProcessingDisabled(){return(0,g.lastValueFrom)(this._featureService.getFeatureState(this._comboboxActionsProcessingDisableFeature))}crtOnMetaDataInit(e){var t=this;return(0,f.Z)(function*(){if(yield t._isProcessingDisabled)return e;const r=e,i=r.viewModelConfig.attributes;return v.AXp.getViewConfigInfoByProperty("type","crt.ComboBox",r.viewConfig).forEach(s=>{t._comboboxPreprocessorService.crtOnMetaDataInit(s.viewConfig,i)}),e})()}crtOnModelInit(e,t){var r=this;return(0,f.Z)(function*(){if(yield r._isProcessingDisabled)return e;const i=e,a=i.viewModelConfig.attributes,s=v.AXp.getViewConfigInfoByProperty("type","crt.ComboBox",i.viewConfig);for(const l of s)yield r._comboboxPreprocessorService.crtOnModelInit(l.viewConfig,a,t);return e})()}crtOnViewModelInit(e,t,r){var i=this;return(0,f.Z)(function*(){if(yield i._isProcessingDisabled)return e;const a=e,s=a.viewModelConfig.attributes,l=v.AXp.getViewConfigInfoByProperty("type","crt.ComboBox",a.viewConfig);for(const d of l)yield i._comboboxPreprocessorService.crtOnViewModelInit(d.viewConfig,s,r);return e})()}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(b.UZ),c.\u0275\u0275inject(le))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})();var ct=S(65598);let ut=(()=>{class n{constructor(e,t,r,i){this._editingCellViewConfigCreatorFactory=e,this._featureService=t,this._metadataModifierService=r,this._comboboxPreprocessorService=i,this._featureName="DisableDataGridEditingMode"}_addColumnsEditingCellViewConfigs(e,t){var r=this;return(0,f.Z)(function*(){const i=e.columns;if(!Array.isArray(i))return;const a=e.items,s=i.filter(l=>!l.editingCellView);for(const l of s){const m=yield r._editingCellViewConfigCreatorFactory.create(l.dataValueType).getViewElementConfig({column:l,itemsAttributeName:a,context:t});m&&r._metadataModifierService.addProperty(l,"editingCellView",m)}})()}_getDataGrids(e){const r=e.viewConfig;return v.AXp.getViewConfigInfoByPropertyForValues("type",Be,r)}_getDataGridComboBoxColumnDefinitions(e){return(e.columns||[]).filter(r=>r.dataValueType===u.DataValueType.Lookup&&r.editingCellView)}_getDataGridItemsAttributeConfig(e,t){var r;const i=(0,N.TN)(e);if(!i)return;const s=t.viewModelConfig.attributes[i];return(r=s?.viewModelConfig)===null||r===void 0?void 0:r.attributes}_getIsEnabledDataGridEditingMode(){var e=this;return(0,f.Z)(function*(){const t=e._featureService.getFeatureState(e._featureName).pipe((0,V.U)(r=>!r),(0,ct.q)(1));return(0,g.lastValueFrom)(t)})()}_addEditableFeature(e,t){e.features||this._metadataModifierService.addProperty(e,"features",{}),this._metadataModifierService.addProperty(e.features,"editable",Boolean(t))}crtOnMetaDataInit(e){var t=this;return(0,f.Z)(function*(){var r;const i=yield t._getIsEnabledDataGridEditingMode(),a=t._getDataGrids(e);for(const s of a){const l=s.viewConfig,d=i&&((r=l.features)===null||r===void 0?void 0:r.editable)!==!1;t._addEditableFeature(l,d),!i||t._getDataGridItemsAttributeConfig(s.viewConfig,e)}return e})()}crtOnModelInit(e,t){var r=this;return(0,f.Z)(function*(){if(!(yield r._getIsEnabledDataGridEditingMode()))return e;const a=r._getDataGrids(e);for(const s of a)r._getDataGridItemsAttributeConfig(s.viewConfig,e);return e})()}crtOnViewModelInit(e,t,r){var i=this;return(0,f.Z)(function*(){if(!(yield i._getIsEnabledDataGridEditingMode()))return e;const s=i._getDataGrids(e);for(const l of s){const d=i._getDataGridItemsAttributeConfig(l.viewConfig,e);if(!d)continue;yield i._addColumnsEditingCellViewConfigs(l.viewConfig,r);const m=i._getDataGridComboBoxColumnDefinitions(l.viewConfig);for(const C of m)yield i._comboboxPreprocessorService.crtOnMetaDataInit(C.editingCellView,d),yield i._comboboxPreprocessorService.crtOnModelInit(C.editingCellView,d,t),yield i._comboboxPreprocessorService.crtOnViewModelInit(C.editingCellView,d,r)}return e})()}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(N.z6),c.\u0275\u0275inject(b.UZ),c.\u0275\u0275inject(p.pi),c.\u0275\u0275inject(le))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})();var Y=S(61528);let He=(()=>{class n{constructor(e,t,r){this.featureService=e,this.metadataModifierService=t,this.dataGridColumnDefinitionService=r,this.featureName="DisableDataGridColumnsPreprocessing",this.viewItemTypes=["crt.DataGrid"]}_getColumnDefinitions(e,t){var r=this;return(0,f.Z)(function*(){const i=e.columns,a=yield r.getGenerateCellViewConfig(e,t);return a?yield(0,g.lastValueFrom)(r.dataGridColumnDefinitionService.processDataGridColumnDefinitions(a,i)):[]})()}_addColumnsCellViewConfigs(e,t){var r=this;return(0,f.Z)(function*(){const i=e.columns;if(!Array.isArray(i)||i.length===0)return;const a=yield r._getColumnDefinitions(e,t);r._addColumnProperty(i,a,"cellView"),r._addColumnProperty(i,a,"readonly")})()}_addColumnProperty(e,t,r){e.filter(i=>!i[r]).map(i=>[i,t.find(a=>a.code===i.code)]).forEach(([i,a])=>this.metadataModifierService.addProperty(i,r,a?.[r]))}getGenerateCellViewConfig(e,t){const r=(0,g.of)(t),i=(0,N.TN)(e);if(!i)return Promise.resolve(null);const a=r.pipe((0,V.U)(d=>d?.getBoundDataSourceName(i))),s=r.pipe((0,V.U)(d=>d?.getBoundDataSchema(i))),l=e.items;return(0,g.lastValueFrom)((0,g.forkJoin)([a,s]).pipe((0,Y.w)(([d,m])=>d&&m?(0,g.of)({dataSchema:m,dataSourceName:d,itemsAttributeName:l,viewModel:t,features:e.features}):(0,g.of)(null))))}crtOnViewModelInit(e,t,r){var i=this;return(0,f.Z)(function*(){if(yield(0,g.lastValueFrom)(i.featureService.getFeatureState(i.featureName),{defaultValue:null}))return e;const s=v.AXp.getViewConfigInfoByPropertyForValues("type",i.viewItemTypes,e.viewConfig);for(const l of s)yield i._addColumnsCellViewConfigs(l.viewConfig,r);return e})()}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(b.UZ),c.\u0275\u0275inject(p.pi),c.\u0275\u0275inject(N.bL))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})(),ft=(()=>{class n{constructor(e){this._featureService=e,this._featureName="DisableDataGridPagingPreprocessing"}_setPaginationChange(e,t){if(e.paginationChange)return;const r=e.items.slice(1),i=t.getBoundDataSourceNameByAttributePath(r);e.paginationChange=xe(i)}_setPagingConfig(e,t){var r,i;const a=e.items.slice(1),s=(i=((r=t?.viewModelConfig)===null||r===void 0?void 0:r.attributes)[a])===null||i===void 0?void 0:i.modelConfig;!s||s?.pagingConfig||(s.pagingConfig=$e())}get _isFeatureDisabled(){return(0,g.lastValueFrom)(this._featureService.getFeatureState(this._featureName))}crtOnMetaDataInit(e){var t=this;return(0,f.Z)(function*(){if(yield t._isFeatureDisabled)return e;const r=e,i=L(e);for(const a of i)t._setPagingConfig(a,r);return e})()}crtOnViewModelInit(e,t,r){var i=this;return(0,f.Z)(function*(){if(yield i._isFeatureDisabled)return e;const a=L(e);for(const s of a)i._setPaginationChange(s,r);return e})()}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(b.UZ))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})(),mt=(()=>{class n{constructor(e){this._featureService=e,this._featureName="DisableDataGridPlaceholderPreprocessing"}crtOnMetaDataInit(e){var t=this;return(0,f.Z)(function*(){if(yield(0,g.lastValueFrom)(t._featureService.getFeatureState(t._featureName),{defaultValue:null}))return e;const{viewModelConfig:i}=e;return se(e).filter(({items:a})=>!z(a,i.attributes)).filter(({placeholder:a})=>a==null).forEach(a=>{a.placeholder=!0}),e})()}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(b.UZ))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})(),pt=(()=>{class n{constructor(e){this._featureService=e,this._featureName="DisableDataGridRowDoubleClickPreprocessing"}_hasSectionEditPage(e,t){return(0,f.Z)(function*(){const r={type:"crt.7XRequest",action:"HasEntityEditPage",$context:t,payload:{entityName:e}};return yield u.HandlerChainService.instance.process(r)})()}_getReferenceSchemaName(e,t){return(0,f.Z)(function*(){const r=yield(0,p.f9)(t,e);return r?.referenceSchemaName})()}_getPrimaryAttributeName(e,t){const r=(0,N.TN)(e),i=t.getBoundDataSourceNameByAttributePath(r),a=t.getBoundDataSchemaByAttributePath(r),{primaryAttributeName:s}=a??{};return s?`${i}_${s}`:""}_isPageExists(e,t){var r=this;return(0,f.Z)(function*(){const i=r._getPrimaryAttributeName(e,t),a=yield r._getReferenceSchemaName(i,t);return r._hasSectionEditPage(a,t)})()}_getDataGridViewConfigs(e,t){var r=this;return(0,f.Z)(function*(){const i=L(e);return(yield Promise.all(i.map(s=>r._isPageExists(s,t)))).reduce((s,l,d)=>(l&&s.push(i[d]),s),[])})()}crtOnViewModelInit(e,t,r){var i=this;return(0,f.Z)(function*(){if(yield(0,g.lastValueFrom)(i._featureService.getFeatureState(i._featureName),{defaultValue:null}))return e;const s=yield i._getDataGridViewConfigs(e,r);for(const l of s)l.rowDoubleClick={request:"crt.DataGridRowDoubleClickRequest",params:{itemsAttributeName:(0,N.TN)(l),rowId:"@event.rowId"}};return e})()}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(b.UZ))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})(),gt=(()=>{class n{constructor(e){this._featureService=e,this._featureName="DisableDataGridRowsSelectionPreprocessing"}_setSelectedRowsConfig(e,t){const r=this._getSelectedRowsAttributeName(t);!r||(this._setSelectedRowsInput(e,t,r),this._setSelectedRowsChangeOutput(t,r))}_setSelectedRowsInput(e,t,r){var i;e.viewModelConfig.attributes||(e.viewModelConfig.attributes={});const a=e.viewModelConfig.attributes;a[r]=(i=a[r])!==null&&i!==void 0?i:{},t.selectedRows=`$${r}`}_setSelectedRowsChangeOutput(e,t){if(e.selectedRowsChange)return;let r="";e.items&&typeof e.items=="string"&&(r=e.items.slice(1)),e.selectedRowsChange={request:"crt.ChangeDataGridSelectedRowRequest",params:{attributeName:t,attributeValue:"@event",collectionAttributeName:r,identifierAttributeName:e.primaryColumnName}}}_getSelectedRowsAttributeName(e){const t=e.selectedRows;return t?typeof t=="string"&&t.startsWith("$")?t.slice(1):null:(0,v.IhY)(e.items)}crtOnMetaDataInit(e){var t=this;return(0,f.Z)(function*(){if(yield(0,g.lastValueFrom)(t._featureService.getFeatureState(t._featureName),{defaultValue:null}))return e;const i=e,a=L(e);for(const s of a)t._setSelectedRowsConfig(i,s);return e})()}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(b.UZ))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})(),vt=(()=>{class n{constructor(e){this._featureService=e,this._featureName="DisableDataGridEditingMode"}_setSaveItemsChangesOutput(e){const t=e.items.slice(1);e.saveItemsChanges={request:"crt.SaveRecordsRequest",params:{itemsAttributeName:t}}}crtOnMetaDataInit(e){var t=this;return(0,f.Z)(function*(){return(yield(0,g.firstValueFrom)(t._featureService.getFeatureState(t._featureName)))||L(e).filter(i=>i.saveItemsChanges==null).forEach(i=>t._setSaveItemsChangesOutput(i)),e})()}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(b.UZ))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})(),ht=(()=>{class n{constructor(e){this._featureService=e,this._featureName="DisableDataGridEditingMode"}_setCancelItemsChangesOutput(e){const t=e.items.slice(1);e.cancelItemsChanges={request:"crt.DataGridCancelItemsChangesRequest",params:{itemsAttributeName:t,changedItems:"@event"}}}crtOnMetaDataInit(e){var t=this;return(0,f.Z)(function*(){return(yield(0,g.firstValueFrom)(t._featureService.getFeatureState(t._featureName)))||L(e).filter(i=>i.cancelItemsChanges==null).forEach(i=>t._setCancelItemsChangesOutput(i)),e})()}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(b.UZ))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})(),yt=(()=>{class n{constructor(e){this._featureService=e,this._featureName="DisableDataGridSortingPreprocessing"}_setSorting(e,t){if(e.sorting)return;const r=`${e.name.split(" ").join("").replace(/\./g,"_")}Sorting`,i=t.viewModelConfig.attributes;i[r]||(i[r]={});const s=`| crt.ToDataTableSortingConfig: '${e.items.slice(1)}'`;e.sorting=`$${r} ${s}`}_setSortingChange(e){if(e.sortingChange)return;const t=e.items.slice(1);e.sortingChange={request:"crt.DataGridSortDataRequest",params:{itemsAttributeName:t,sorting:"@event"}}}_setSortingConfig(e,t){var r,i,a;const s=e.items.slice(1),l=t.viewModelConfig.attributes;l[s]||(l[s]={});const d=((r=t?.viewModelConfig)===null||r===void 0?void 0:r.attributes)[s],m=d?.modelConfig;!m||((i=m.sortingConfig)===null||i===void 0?void 0:i.attributeName)||(d.modelConfig={...d.modelConfig,sortingConfig:{...(a=d.modelConfig)===null||a===void 0?void 0:a.sortingConfig,attributeName:`${e.name.split(" ").join("").replace(/\./g,"_")}Sorting`}})}setSortingValuesToViewConfig(e,t){this._setSorting(e,t),this._setSortingChange(e),this._setSortingConfig(e,t)}crtOnMetaDataInit(e){var t=this;return(0,f.Z)(function*(){if(yield(0,g.lastValueFrom)(t._featureService.getFeatureState(t._featureName),{defaultValue:null}))return e;const i=e,a=L(e);for(const s of a)t.setSortingValuesToViewConfig(s,i);return e})()}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(b.UZ))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})(),Ct=(()=>{class n{constructor(e){this._defaultFeatures=e}crtOnMetaDataInit(e){var t=this;return(0,f.Z)(function*(){var r,i;const a=se(e).filter(s=>!s.headerToolbarItems);for(const s of a)s.headerToolbarItems=[{type:"crt.MenuItem",caption:"DataGrid.ActionsToolbar.ResetToDefault",icon:"reset",clicked:{request:"crt.DataGridResetConfigsToDefaultRequest",params:{dataGridName:s.name}}}],!((i=(r=t._defaultFeatures)===null||r===void 0?void 0:r.operations)===null||i===void 0)&&i.canCreateDefaultGridSettings&&s.headerToolbarItems.unshift({type:"crt.MenuItem",caption:"DataGrid.ActionsToolbar.SaveForAll",icon:"save",clicked:{request:"crt.DataGridSaveConfigsForAllRequest",params:{dataGridName:s.name}}});return e})()}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(A.ud6,8))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})();class qe{crtOnViewModelInit(o,e,t){var r=this;return(0,f.Z)(function*(){return yield Promise.all(L(o,r.viewItemTypes).filter(i=>!i.rowToolbarItems).map(i=>r.setRowToolbarMenuItems(i,t))),o})()}}let St=(()=>{class n extends qe{constructor(){super(...arguments),this.viewItemTypes=["crt.DataGrid"]}_hasEntityEditPage(e,t){return(0,f.Z)(function*(){const r={type:"crt.7XRequest",action:"HasEntityEditPage",$context:e,payload:{entityName:t}};return yield u.HandlerChainService.instance.process(r)})()}setRowToolbarMenuItems(e,t){var r=this;return(0,f.Z)(function*(){var i;const a=e.items.slice(1),s=t.getBoundDataSourceNameByAttributePath(a),l=(i=t.getBoundDataSchemaByAttributePath(a))===null||i===void 0?void 0:i.name,d=yield r._hasEntityEditPage(t,l);e.rowToolbarItems=[{type:"crt.MenuItem",caption:"DataGrid.RowToolbar.Open",icon:"edit-row-action",visible:d,clicked:{request:"crt.UpdateRecordRequest",params:{itemsAttributeName:a,recordId:`$${a}.${s}_Id`},useRelativeContext:!0}},{type:"crt.MenuItem",caption:"DataGrid.RowToolbar.Copy",icon:"copy-row-action",visible:d,clicked:{request:"crt.CopyRecordRequest",params:{itemsAttributeName:a,recordId:`$${a}.${s}_Id`},useRelativeContext:!0}},{type:"crt.MenuItem",caption:"DataGrid.RowToolbar.Delete",icon:"delete-row-action",clicked:{request:"crt.DeleteRecordRequest",params:{itemsAttributeName:a,recordId:`$${a}.${s}_Id`},useRelativeContext:!1}}]})()}}return n.\u0275fac=function(){let o;return function(t){return(o||(o=c.\u0275\u0275getInheritedFactory(n)))(t||n)}}(),n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})(),_t=(()=>{class n{constructor(e){this._featureService=e,this._expPanelActionsProcessingDisableFeature="DisableExpansionPanelPreprocessing"}_filterItemsByGridType(e){var t;if(!e.items||e.items.length===0)return;const r=(t=e?.tools)!==null&&t!==void 0?t:[],i=e.items.filter(a=>a.gridContainerType===A.$df.TOOLS);r?.length===0&&i?.length>0&&(e.items=e.items.filter(a=>a.gridContainerType!==A.$df.TOOLS),e.tools=i)}get _isProcessingDisabled(){return(0,g.lastValueFrom)(this._featureService.getFeatureState(this._expPanelActionsProcessingDisableFeature))}crtOnMetaDataInit(e){var t=this;return(0,f.Z)(function*(){if(yield t._isProcessingDisabled)return e;const r=e;return v.AXp.getViewConfigInfoByProperty("type","crt.ExpansionPanel",r.viewConfig).forEach(a=>{t._filterItemsByGridType(a.viewConfig)}),e})()}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(b.UZ))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})(),bt=(()=>{class n{constructor(e){this._featureService=e,this._fileInputPreprocessingDisableFeature="DisableFileInputPreprocessing"}get isProcessingDisabled(){return(0,g.lastValueFrom)(this._featureService.getFeatureState(this._fileInputPreprocessingDisableFeature))}_getRecordAttributeName(e,t){var r,i,a;if(!((r=e.modelConfig)===null||r===void 0)&&r.dependencies){const s=`${t.name}${p.gW}`,d=((i=e.modelConfig)===null||i===void 0?void 0:i.dependencies[s])[0].relationPath;if(d){let m="";for(const C in e.viewModelConfig.attributes)((a=e.viewModelConfig.attributes[C].modelConfig)===null||a===void 0?void 0:a.path)===d&&(m=C);return m}}}crtOnMetaDataInit(e){var t=this;return(0,f.Z)(function*(){if(yield t.isProcessingDisabled)return e;const r=e;return v.AXp.getViewConfigInfoByProperty("type","crt.FileInput",r.viewConfig).forEach(a=>{if(!a.viewConfig.upload){const l=a.viewConfig.control.slice(1);a.viewConfig.upload={request:"crt.UploadDataAttributeFileRequest",params:{fileAttributeName:l,detail:"@event.detail"}}}a.viewConfig.download||(a.viewConfig.download={request:"crt.DownloadEntityFileRequest",params:{detail:"@event.detail"}})}),e})()}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(b.UZ))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})(),Ft=(()=>{class n extends qe{constructor(){super(...arguments),this.viewItemTypes=["crt.FileList"]}setRowToolbarMenuItems(e,t){return(0,f.Z)(function*(){const r=e.items.slice(1),i=t.getBoundDataSourceNameByAttributePath(r);e.rowToolbarItems=[{type:"crt.MenuItem",caption:"DataGrid.RowToolbar.Delete",icon:"delete-row-action",clicked:{request:"crt.DeleteRecordRequest",params:{itemsAttributeName:r,recordId:`$${r}.${i}_Id`},useRelativeContext:!1}}]})()}}return n.\u0275fac=function(){let o;return function(t){return(o||(o=c.\u0275\u0275getInheritedFactory(n)))(t||n)}}(),n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})(),Dt=(()=>{class n extends He{constructor(e,t,r,i){super(e,t,r),this.featureService=e,this.metadataModifierService=t,this.dataGridColumnDefinitionService=r,this._cellViewConfigCreatorFactory=i,this._predefinedColumns={},this.viewItemTypes=["crt.FileList"]}_setPredefinedColumnDefinitions(e){for(const t of e){const r=t.viewConfig.name,i=t.viewConfig.columns,a=[];for(const s of i)s.cellView&&a.push(s.code);this._predefinedColumns[r]=a}}_processFileListColumnDefinitions(e,t,r){var i=this;return(0,f.Z)(function*(){var a;const{dataSourceName:s,dataSchema:l,itemsAttributeName:d,viewModel:m}=t,{primaryAttributeName:C,primaryDisplayAttributeName:h}=l??{},D=l.name,M=C&&`${s}_${C}`;for(const R of r){const q=l.attributes.find(oe=>(0,v._fv)(`${s}_${oe.name}`)===R.code);if(!q)continue;const Z=q.name,W={columnName:Z,dataValueType:q.dataValueType,primaryDisplayAttributeName:h},K={column:R,context:m,itemsAttributeName:d,primaryAttributeName:M,dataSchemaName:D,columnName:Z},Q=i._cellViewConfigCreatorFactory.create(W),P=yield Q?.getViewElementConfig(K);P&&!(!((a=i._predefinedColumns[e])===null||a===void 0)&&a.includes(R.code))&&i.metadataModifierService.addProperty(R,"cellView",P)}})()}crtOnViewModelInit(e,t,r){var i=()=>super.crtOnViewModelInit,a=this;return(0,f.Z)(function*(){if(yield(0,g.lastValueFrom)(a.featureService.getFeatureState(a.featureName),{defaultValue:null}))return e;const l=v.AXp.getViewConfigInfoByPropertyForValues("type",a.viewItemTypes,e.viewConfig);a._setPredefinedColumnDefinitions(l),e=yield i().call(a,e,t,r);for(const d of l){const m=d.viewConfig.columns,C=d.viewConfig.name,h=yield a.getGenerateCellViewConfig(d.viewConfig,r);h&&(yield a._processFileListColumnDefinitions(C,h,m))}return e})()}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(b.UZ),c.\u0275\u0275inject(p.pi),c.\u0275\u0275inject(N.bL),c.\u0275\u0275inject(N.ec))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})();var Le=S(73328);let Nt=(()=>{class n{constructor(e){this._featureService=e,this._fileListPreprocessingDisableFeature="DisableFileListPreprocessing",this._fileListDropPreprocessingDisableFeature="DisableFileListDropPreprocessing"}get isProcessingDisabled(){return(0,g.lastValueFrom)(this._featureService.getFeatureState(this._fileListPreprocessingDisableFeature))}get isDropProcessingDisabled(){return(0,g.lastValueFrom)(this._featureService.getFeatureState(this._fileListDropPreprocessingDisableFeature))}_getAttributeDSName(e){return`${e}${p.gW}`}_getModelByName(e,t){return e.find(r=>r.getDataSource().dataSourceName===t)}_getDataSchemaName(e){var t=this;return(0,f.Z)(function*(){var r,i,a;const{models:s,schema:l,dataSourceName:d,attributeName:m}=e,C=t._getModelByName(s,d);if(!C){const D=((r=l.modelConfig)===null||r===void 0?void 0:r.dataSources)&&((i=l.modelConfig)===null||i===void 0?void 0:i.dataSources[d]);return(a=D?.config)===null||a===void 0?void 0:a.entitySchemaName}const h=yield(0,g.firstValueFrom)(C.getSchema()||(0,g.of)(null));if(m){const D=h?.attributes.find(M=>M.name===m);return D?.referenceSchemaName||h?.name}return h?.name})()}_createDataSourceConfig(){return{type:"crt.EntityDataSource",scope:u.DataSourceScope.ViewElement,config:{entitySchemaName:this.getDefaultFilesEntitySchemaName()}}}_createDependency(e,t){return[{attributePath:t,relationPath:e}]}_getRightFilterTagExpressions(e){const t=[],r={expressionType:2,parameter:{dataValueType:1,value:e}};return t.push(r),t}_getRightFilterFileGroupExpressions(e){const t=[];return e.forEach(r=>{const i={expressionType:2,parameter:{dataValueType:10,value:{Id:r,value:r}}};t.push(i)}),t}_createFilterAttribute(e,t,r){const i={};if(e?.length>0){const a=(0,u.generateGuid)(),s={filterType:4,comparisonType:3,isEnabled:!0,trimDateTimeParameterToDate:!1,leftExpression:{expressionType:0,columnPath:"FileGroup"},isAggregative:!1,dataValueType:10,referenceSchemaName:"FileGroup",rightExpressions:this._getRightFilterFileGroupExpressions(e)};i[a]=s}if(!Le.String.IsNullOrWhiteSpace(t)){const a=(0,u.generateGuid)(),s={filterType:4,comparisonType:3,isEnabled:!0,trimDateTimeParameterToDate:!1,leftExpression:{expressionType:0,columnPath:"Tag"},isAggregative:!1,dataValueType:2,rightExpressions:this._getRightFilterTagExpressions(t)};i[a]=s}return{value:{items:i,logicalOperation:0,isEnabled:!0,filterType:6,rootSchemaName:r||this.getDefaultFilesEntitySchemaName()}}}_createViewModelAttribute(e){return{isCollection:!0,modelConfig:{path:e},viewModelConfig:{attributes:{}}}}_getAdditionalFilterName(e){return`${e}_PredefinedFilter`}_findRelatedPath(e,t){var r,i;const a=e.split(".");if(a.length!==2)return;const s=a[0],l=a[1],d=(r=t.modelConfig)===null||r===void 0?void 0:r.dataSources,m=d&&d[s],C=(i=m?.config)===null||i===void 0?void 0:i.attributes,h=C&&C[l];if(!!h?.path)return`${s}.${h?.path}`}_getRelativeAttributePath(e,t){var r;const a=(t.viewModelConfig.attributes||{})[e];if(!a||!(!((r=a.modelConfig)===null||r===void 0)&&r.path))return;const s=a.modelConfig.path;return this._findRelatedPath(s,t)||s}_addDependencies(e,t,r){var i;const a=((i=e.modelConfig)===null||i===void 0?void 0:i.dependencies)||{};if(!a[r]&&t.viewConfig.masterRecordColumnValue){const s=t.viewConfig.masterRecordColumnValue.split("$")[1];if(!s)return;const l=this._getRelativeAttributePath(s,e);if(!l)return;const d=t.viewConfig.recordColumnName||this.getDefaultRecordColumnName();a[r]=this._createDependency(l,d),e.modelConfig=e.modelConfig||{},e.modelConfig.dependencies=a}}_linkFilterToAttribute(e,t){!e.modelConfig||(e.modelConfig.filterAttributes=[{loadOnChange:!0,name:t}])}_getDataSourcePrimaryAttribute(e){var t,r;const i=this.getDefaultPrimaryColumnName(),a=(t=e.modelConfig)===null||t===void 0?void 0:t.primaryDataSourceName;if(!a)return"";const s=(r=e.viewModelConfig)===null||r===void 0?void 0:r.attributes;return s&&!s[i]&&(s[i]={modelConfig:{path:`${a}.${i}`}}),i}_setFileListDropZoneParameters(e,t){t&&(e.viewConfig.droppable=!1,e.viewConfig.fileDropped=void 0),e.viewConfig.droppable!==!1&&(e.viewConfig.droppable=!0,e.viewConfig.fileDropped||(e.viewConfig.fileDropped={request:"crt.UploadFileRequest",params:{viewElementName:e.viewConfig.name}}))}getDefaultFilesEntitySchemaName(){return"SysFile"}getDefaultRecordColumnName(){return"RecordId"}getDefaultPrimaryColumnName(){return"Id"}getRecordSchemaNameColumnName(){return"RecordSchemaName"}getFilesEntitySchemaName(e,t,r){var i=this;return(0,f.Z)(function*(){const a=i._getFileDataSourceName(e);return a?i._getDataSchemaName({models:r,schema:t,dataSourceName:a}):null})()}getMasterRecordEntitySchemaName(e,t,r){var i=this;return(0,f.Z)(function*(){var a;if(!e?.startsWith("$"))return null;const s=e.substring(1),l=t.viewModelConfig.attributes&&t.viewModelConfig.attributes[s];if(!l)return null;const d=(a=l.modelConfig)===null||a===void 0?void 0:a.path,m=d?.split("."),C=m?.shift()||"",h=m?.pop()||"";return i._getDataSchemaName({models:r,schema:t,dataSourceName:C,attributeName:h})})()}setRequestParam(e,t,r){!e[t]&&r&&(e[t]=r)}tryAddFileListProperties(e,t){if(t.viewConfig.items||(t.viewConfig.items=`$${t.viewConfig.name}`),!t.viewConfig.primaryColumnName){const r=t.viewConfig.name,i=`${this._getAttributeDSName(r)}_${this.getDefaultPrimaryColumnName()}`;t.viewConfig.primaryColumnName=i}}tryAddAttributeAndDataSource(e,t){var r;const i=t.viewConfig.items;if(typeof i!="string")return;const a=i.split("$")[1];if(!a)return;const s=this._getAttributeDSName(a),l=this._getAdditionalFilterName(a);e.modelConfig||(e.modelConfig={});const d=e.modelConfig.dataSources||{},m=e.viewModelConfig.attributes||{};d[s]||(d[s]=this._createDataSourceConfig(),e.modelConfig.dataSources=d),this._addDependencies(e,t,s),m[a]||(m[a]=this._createViewModelAttribute(s),e.viewModelConfig.attributes=m);const C=t.viewConfig.fileGroups,h=t.viewConfig.tag||"";if(!m[l]&&(C?.length>0||!Le.String.IsNullOrWhiteSpace(h))){const D=(r=d[s].config)===null||r===void 0?void 0:r.entitySchemaName;m[l]=this._createFilterAttribute(C,h,D),this._linkFilterToAttribute(m[a],l),e.viewModelConfig.attributes=m}}getUploadFileRequestConfigs(e){return v.AXp.getViewConfigInfoByPropertyForValues("type",["crt.Button","crt.MenuItem"],e.viewConfig).filter(r=>{var i;return((i=r.viewConfig.clicked)===null||i===void 0?void 0:i.request)==="crt.UploadFileRequest"}).map(r=>r.viewConfig.clicked)}getFileDropRequestConfigs(e){return e.filter(t=>{var r;return((r=t.viewConfig.fileDropped)===null||r===void 0?void 0:r.request)==="crt.UploadFileRequest"}).map(t=>t.viewConfig.fileDropped)}crtOnModelInit(e,t){var r=this;return(0,f.Z)(function*(){var i,a,s;if(yield r.isProcessingDisabled)return e;const l=e,d=v.AXp.getViewConfigInfoByProperty("type","crt.FileList",l.viewConfig),m=yield r.isDropProcessingDisabled;d.forEach(h=>{r._setFileListDropZoneParameters(h,m),r.tryAddFileListProperties(l,h),r.tryAddAttributeAndDataSource(l,h)});const C=[...r.getFileDropRequestConfigs(d),...r.getUploadFileRequestConfigs(l)];for(const h of C){h.params=h.params||{};let D=p.jf.Attachments,M="",R,q,Z;const W=d.find(P=>P.viewConfig.name===h.params.viewElementName);let K=!1;if(W){const P=W.viewConfig;D=P?.fileGroups&&P.fileGroups[0],M=P?.tag,R=P?.masterRecordColumnValue,r.setRequestParam(h.params,"itemsAttributeName",P.name);const oe=P.items;q=(yield r.getFilesEntitySchemaName(oe,l,t))||r.getDefaultFilesEntitySchemaName();const nt=r._getFileDataSourceName(oe);nt&&(K=!!(!((s=(a=(i=r._getModelByName(t,nt))===null||i===void 0?void 0:i.dataSource)===null||a===void 0?void 0:a.dataSchema)===null||s===void 0)&&s.findAttributeByName(r.getRecordSchemaNameColumnName()))),Z=P.recordColumnName||r.getDefaultRecordColumnName()}else R=`$${r._getDataSourcePrimaryAttribute(l)}`,q=r.getDefaultFilesEntitySchemaName(),Z=r.getDefaultRecordColumnName();const Q=yield r.getMasterRecordEntitySchemaName(R,l,t);r.setRequestParam(h.params,"fileGroup",D),r.setRequestParam(h.params,"tag",M),r.setRequestParam(h.params,"recordColumnName",Z),r.setRequestParam(h.params,"fileEntitySchemaName",q),r.setRequestParam(h.params,"recordId",R),r.setRequestParam(h.params,"files","@event.files"),K&&r.setRequestParam(h.params,"recordEntitySchemaName",Q)}return e})()}_getFileDataSourceName(e){if(!e?.startsWith("$"))return null;const t=e.substring(1);return this._getAttributeDSName(t)}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(b.UZ))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})(),wt=(()=>{class n{_setProperties(e){return(0,f.Z)(function*(){const t=e.viewConfig.folderTree,{activeFolderIdAttrName:r,activeFolderNameAttrName:i,activeFolderFavoriteStateAttrName:a,itemsAttrName:s,favoriteItemsAttrName:l}=(0,v.E_N)(t);e.viewConfig.activeFolderId||(e.viewConfig.activeFolderId=t?`$${r}`:null),e.viewConfig.activeFolderName||(e.viewConfig.activeFolderName=t?`$${i}`:null),e.viewConfig.activeFolderFavoriteState||(e.viewConfig.activeFolderFavoriteState=t?`$${a}`:null),e.viewConfig.items||(e.viewConfig.items=t?`$${s}`:null),e.viewConfig.favoriteItems||(e.viewConfig.favoriteItems=t?`$${l}`:null)})()}_setActiveFolderChangedRequest(e){var t;e.viewConfig.activeFolderChanged||(e.viewConfig.activeFolderChanged={request:"crt.FolderTreeActiveFolderChangedRequest",params:{folderTreeName:(t=e.viewConfig.folderTree)!==null&&t!==void 0?t:null,id:"@event.id",name:"@event.name",filterData:"@event.filterData",isFavorite:"@event.isFavorite"}})}_setFolderTreeVisibleChangedRequest(e){var t;e.viewConfig.folderTreeVisibleChanged||(e.viewConfig.folderTreeVisibleChanged={request:"crt.FolderTreeVisibleRequest",params:{folderTreeName:(t=e.viewConfig.folderTree)!==null&&t!==void 0?t:null,visible:"@event.visible"}})}crtOnMetaDataInit(e){var t=this;return(0,f.Z)(function*(){const r=e,i=v.AXp.getViewConfigInfoByProperty("type","crt.FolderTreeActions",r.viewConfig);for(const a of i)yield t._setProperties(a),t._setActiveFolderChangedRequest(a),t._setFolderTreeVisibleChangedRequest(a);return e})()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})(),Pt=(()=>{class n{constructor(e,t){this._featureService=e,this._userInfo=t,this._folderTreeProcessingDisableFeature="DisableFolderTreePreprocessing"}get _isProcessingDisabled(){return(0,g.firstValueFrom)(this._featureService.getFeatureState(this._folderTreeProcessingDisableFeature))}_setActiveFolderChanged(e){e.viewConfig.activeFolderChanged||(e.viewConfig.activeFolderChanged={request:"crt.FolderTreeActiveFolderChangedRequest",params:{folderTreeName:e.viewConfig.name,id:"@event.id",name:"@event.name",filterData:"@event.filterData",isFavorite:"@event.isFavorite"}})}_setFolderTreeVisibleChanged(e){e.viewConfig.folderTreeVisibleChanged||(e.viewConfig.folderTreeVisibleChanged={request:"crt.FolderTreeVisibleRequest",params:{folderTreeName:e.viewConfig.name,visible:"@event.visible"}})}_setAddFolderRequest(e){e.viewConfig.addFolder||(e.viewConfig.addFolder={request:"crt.AddFolderDataRequest",params:{folderTreeName:e.viewConfig.name,folderId:"@event.folderId",folderName:"@event.folderName",rootSchemaName:"@event.rootSchemaName",sourceSchemaName:"@event.sourceSchemaName",parentId:"@event.parentId",filterData:"@event.filterData"}})}_setCopyFolderRequest(e){e.viewConfig.copyFolder||(e.viewConfig.copyFolder={request:"crt.CopyFolderDataRequest",params:{folderTreeName:e.viewConfig.name,folderId:"@event.folderId",sourceId:"@event.sourceId",copyRights:"@event.copyRights",folderName:"@event.folderName",rootSchemaName:"@event.rootSchemaName",sourceSchemaName:"@event.sourceSchemaName",parentId:"@event.parentId",filterData:"@event.filterData"}})}_setFolderRenameRequest(e){e.viewConfig.folderRenamed||(e.viewConfig.folderRenamed={request:"crt.FolderTreeRenameRequest",params:{folderTreeName:e.viewConfig.name,folderId:"@event.folderId",folderName:"@event.folderName",sourceSchemaName:"@event.sourceSchemaName",reloadFavorites:"@event.reloadFavorites"}})}_setToggleFolderFavoriteRequest(e){e.viewConfig.toggleFolderFavorite||(e.viewConfig.toggleFolderFavorite={request:"crt.ToggleFolderFavoriteRequest",params:{folderTreeName:e.viewConfig.name,id:"@event.id",favoriteId:"@event.favoriteId",rootSchemaName:"@event.rootSchemaName",status:"@event.status"}})}_setFolderFiltersUpdatedRequest(e){e.viewConfig.folderFiltersUpdated||(e.viewConfig.folderFiltersUpdated={request:"crt.FolderTreeUpdateFiltersRequest",params:{folderTreeName:e.viewConfig.name,filterData:"@event.filterData",sourceSchemaName:"@event.sourceSchemaName",folderId:"@event.folderId",reloadFavorites:"@event.reloadFavorites"}})}_setDeleteFolderRequest(e,t){if(t.viewConfig.deleteFolder)return;const{itemsAttrName:r}=(0,v.E_N)(t.viewConfig.name);t.viewConfig.deleteFolder={request:"crt.DeleteFolderDataRequest",params:{dataSourceName:this._getDataSourceNameByItems(e,r),folderTreeName:t.viewConfig.name,folderId:"@event.folderId",reloadFavorites:"@event.reloadFavorites"}}}_getDataSourceNameByItems(e,t){var r,i,a,s;const l=(i=(r=e?.viewModelConfig)===null||r===void 0?void 0:r.attributes)===null||i===void 0?void 0:i[t];return(s=(a=l?.embeddedModel)===null||a===void 0?void 0:a.name)!==null&&s!==void 0?s:""}_setItemsAttrValue(e){if(e.viewConfig.items)return;const{itemsAttrName:t}=(0,v.E_N)(e.viewConfig.name);e.viewConfig.items=`$${t}`}_setVisibleAttrValue(e){if(e.viewConfig.visible)return;const{visibleAttrName:t}=(0,v.E_N)(e.viewConfig.name);e.viewConfig.visible=`$${t}`}_setActiveFolderIdAttrValue(e){if(e.viewConfig.activeFolderId)return;const{activeFolderIdAttrName:t}=(0,v.E_N)(e.viewConfig.name);e.viewConfig.activeFolderId=`$${t}`}_setFavoriteItemsConfig(e,t){const{favoriteItemsAttrName:r}=(0,v.E_N)(t.viewConfig.name);t.viewConfig.favoriteItems=`$${r}`;const i=`${r}_DS`,a=`${i}_filter`;this._setFavoriteItemsFilterAttr(a,e,t);const s={isCollection:!0,viewModelConfig:{attributes:{Id:{modelConfig:{path:`${i}.Id`}},Name:{modelConfig:{path:`${i}.FolderTree.Name`}},FolderTreeId:{modelConfig:{path:`${i}.FolderTree.Id`}},FilterData:{modelConfig:{path:`${i}.FolderTree.FilterData`}}}},modelConfig:{path:i,filterAttributes:[{name:a,loadOnChange:!0}]},embeddedModel:{name:i,config:{type:"crt.EntityDataSource",config:{entitySchemaName:"FolderTreeFavorite"},hiddenInPageDesigner:!1}}};this._addViewModelConfigAttribute(e,r,s)}_setFavoriteItemsFilterAttr(e,t,r){var i,a,s;if(((a=(i=t?.viewModelConfig)===null||i===void 0?void 0:i.attributes)===null||a===void 0?void 0:a[e])||!t.viewModelConfig.attributes)return;const l=new u.FilterGroup(u.LogicalOperatorType.And),d=new u.CompareFilter(u.ComparisonType.Equal,new u.ColumnExpression({columnPath:"EntitySchemaName"}),new u.ParameterExpression({value:r.viewConfig.rootSchemaName})),m=new u.CompareFilter(u.ComparisonType.Equal,new u.ColumnExpression({columnPath:"SysAdminUnit.Id"}),new u.ParameterExpression({value:(s=this._userInfo)===null||s===void 0?void 0:s.id,dataValueType:u.DataValueType.Guid}));l.add(d,"schemaFilter"),l.add(m,"adminUnitFilter"),t.viewModelConfig.attributes[e]={value:l}}_setExpandedItemsAttrValue(e,t){if(t.viewConfig.expandedItems)return;const{expandedItemsAttrName:r}=(0,v.E_N)(t.viewConfig.name);t.viewConfig.expandedItems=`$${r}`,this._addViewModelConfigAttribute(e,r,{})}_addViewModelConfigAttribute(e,t,r){var i;!(!((i=e?.viewModelConfig)===null||i===void 0)&&i.attributes)||e.viewModelConfig.attributes[t]||(e.viewModelConfig.attributes[t]=r)}_setFolderTreeExpandedItemsChanged(e){e.viewConfig.folderTreeExpandedItemsChanged||(e.viewConfig.folderTreeExpandedItemsChanged={request:"crt.FolderTreeExpandedItemsRequest",params:{folderTreeName:e.viewConfig.name,expandedItems:"@event.expandedItems"}})}_setFolderChangeRights(e){e.viewConfig.folderChangeRights||(e.viewConfig.folderChangeRights={request:"crt.LoadRightsModuleRequest",params:{payload:{entitySchemaName:"@event.entitySchemaName",entitySchemaCaption:"@event.entitySchemaCaption",primaryColumnValue:"@event.primaryColumnValue",primaryDisplayColumnValue:"@event.primaryDisplayColumnValue"}}})}crtOnMetaDataInit(e){var t=this;return(0,f.Z)(function*(){if(yield t._isProcessingDisabled)return e;const r=e,i=v.AXp.getViewConfigInfoByProperty("type","crt.FolderTree",r.viewConfig);for(const a of i)t._setItemsAttrValue(a),t._setExpandedItemsAttrValue(r,a),t._setVisibleAttrValue(a),t._setActiveFolderIdAttrValue(a),t._setActiveFolderChanged(a),t._setFolderTreeVisibleChanged(a),t._setAddFolderRequest(a),t._setCopyFolderRequest(a),t._setFolderRenameRequest(a),t._setFolderFiltersUpdatedRequest(a),t._setDeleteFolderRequest(r,a),t._setFolderTreeExpandedItemsChanged(a),t._setFolderChangeRights(a),t._setFavoriteItemsConfig(r,a),t._setToggleFolderFavoriteRequest(a);return e})()}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(b.UZ),c.\u0275\u0275inject(v.aoG))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})(),At=(()=>{class n{constructor(e){this._featureService=e,this._labelProcessingDisableFeature="DisableLabelPreprocessing"}_actualizeLabelType(e){const t=A.JF[e.labelType];t&&(e.labelType=t)}get _isProcessingDisabled(){return(0,g.lastValueFrom)(this._featureService.getFeatureState(this._labelProcessingDisableFeature))}crtOnMetaDataInit(e){var t=this;return(0,f.Z)(function*(){if(yield t._isProcessingDisabled)return e;const r=e;return v.AXp.getViewConfigInfoByProperty("type","crt.Label",r.viewConfig).forEach(a=>{t._actualizeLabelType(a.viewConfig)}),e})()}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(b.UZ))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})(),It=(()=>{class n{constructor(){}_modifyInputType(e,t,r,i){var a,s;const l=e.control.replace("$",""),d=(s=(a=t.attributes[l])===null||a===void 0?void 0:a.modelConfig)===null||s===void 0?void 0:s.path;if(d){const m=this._getDataSchemaAttributeByPath(d,r);m?.dataValueType===u.DataValueType.PHONE_TEXT&&(e.type="crt.PhoneInput",e.phoneAsLink=!0,e.displayAsPhone=m.isMasked,e.isTelephonyEnabled=i,i&&(e.callNumber={request:"crt.PhoneLinkClickRequest",params:{phoneNumber:"@event.phoneNumber"}}))}}_isTelephonyEnabled(){return(0,f.Z)(function*(){const e={type:"crt.7XRequest",action:"IsTelephonyEnabled",$context:{},$initialEvent:{}};return yield u.HandlerChainService.instance.process(e)})()}_getDataSchemaAttributeByPath(e,t){var r;const[i,a]=e.split("."),s=(r=t.dataSchemas[i])===null||r===void 0?void 0:r.attributes;let l;for(const d in s)if(s[d].path===a){l=s[d];break}return l}crtOnViewModelInit(e,t,r){var i=this;return(0,f.Z)(function*(){const a=e,s=v.AXp.getViewConfigInfoByProperty("type","crt.Input",a.viewConfig),l=yield i._isTelephonyEnabled();return s.forEach(d=>{i._modifyInputType(d.viewConfig,a.viewModelConfig,r,l)}),e})()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})();var J=S(59085);let Rt=(()=>{class n{constructor(e){this._featureService=e,this._tabPanelActionsProcessingDisableFeature="DisableTabPanelPreprocessing"}_updateIconPosition(e){if(e.iconPosition)return;const t=!!e.icon;e.iconPosition=t?J.F9O.LeftIcon:J.F9O.OnlyText}_updateTabIconSource(e){A.E2J.updateTabIconSource(e)}_updateTabHint(e){e.hint=e.caption}get _isProcessingDisabled(){return(0,g.lastValueFrom)(this._featureService.getFeatureState(this._tabPanelActionsProcessingDisableFeature))}crtOnMetaDataInit(e){var t=this;return(0,f.Z)(function*(){if(yield t._isProcessingDisabled)return e;const r=e;return v.AXp.getViewConfigInfoByProperty("type","crt.TabContainer",r.viewConfig).forEach(a=>{t._updateIconPosition(a.viewConfig),t._updateTabIconSource(a.viewConfig),t._updateTabHint(a.viewConfig)}),e})()}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(b.UZ))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})(),Tt=(()=>{class n{constructor(e){this._featureService=e,this._chartWidgetName="crt.ChartWidget",this._indicatorWidgetName="crt.IndicatorWidget",this._gaugeWidgetName="crt.GaugeWidget",this._drillDownFeatureName="ChartDrilldown"}_getWidgetsArray(e){const t=v.AXp.getViewConfigInfoByProperty("type",this._chartWidgetName,e.viewConfig),r=v.AXp.getViewConfigInfoByProperty("type",this._indicatorWidgetName,e.viewConfig),i=v.AXp.getViewConfigInfoByProperty("type",this._gaugeWidgetName,e.viewConfig);return[...t,...r,...i]}_getWidgetName(e){return e.name.replace(/\./g,"_")}_getDataSetSortinAttributeName(e){return`${e.split(" ").join("").replace(/\./g,"_")}_ListDataDSSorting`}get _isDrillDownFeatureEnabled(){return(0,g.lastValueFrom)(this._featureService.getFeatureState(this._drillDownFeatureName))}crtOnModelInit(e,t){var r=this;return(0,f.Z)(function*(){const i=e,a=r._getWidgetsArray(i);for(const s of a){const l=s?.viewConfig;let d=i.viewModelConfig.attributes;d||(d=i.viewModelConfig.attributes={});const m=r._getWidgetName(l),C=`${p.$4}_${m}`,h=r._getDataSetSortinAttributeName(C);d[`${C}_ListConfig`]={value:[]},d[`${C}_UserProfileData`]={value:[]},d[`${C}_ListData`]={isCollection:!0,modelConfig:{path:`${C}_ListDataDS`,sortingConfig:{attributeName:h}},viewModelConfig:{attributes:{}}},h&&(d[h]={value:[]})}return e})()}crtOnViewModelInit(e,t,r){var i=this;return(0,f.Z)(function*(){const a=e,s=i._getWidgetsArray(a);for(const l of s){const d=l?.viewConfig,m=i._getWidgetName(d),C=`${p.$4}_${m}`,h=`${C}_ListDataDS`,D=`${C}_ListConfig`,M=`${C}_ListData`,R=`${C}_UserProfileData`;d.listData=`$${M}`,d.listConfig=`$${D}`,d.userProfileData=`$${R}`,d.drillDown={request:"crt.WidgetDrilldownRequest",params:{dataSourceName:h,listConfigAttributeName:D,listDataAttributeName:M,parameters:[],config:{schemaName:"@event.schemaName",groupByValue:"@event.groupByValue",pagingConfig:"@event.pagingConfig",sortingConfig:"@event.sortingConfig",groupBy:"@event.groupBy",aggregateBy:"@event.aggregateBy",columns:"@event.columns",filters:"@event.filters"}}},d.paginationChange=xe(h),d.getProfileColumns={request:"crt.AnalyticsDataGridGetColumnsRequest",params:{userProfileDataAttributeName:R,drilldownConfig:"@event.drilldownConfig",schemaName:"@event.schemaName",isDefault:!1}},d.columnsChange={request:"crt.AnalyticsDataGridSaveToProfileRequest",params:{schemaName:"@event.schemaName",isDefault:!1,dataTableData:"@event.dataTableData"}}}return e})()}crtOnMetaDataInit(e){var t=this;return(0,f.Z)(function*(){var r;if(!(yield t._isDrillDownFeatureEnabled))return e;const i=e,a=t._getWidgetsArray(i);for(const s of a)!s.viewConfig||((r=s.viewConfig)===null||r===void 0?void 0:r.pagingConfig)||(s.viewConfig.pagingConfig=$e());return e})()}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(b.UZ))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n})(),de=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=c.\u0275\u0275defineNgModule({type:n}),n.\u0275inj=c.\u0275\u0275defineInjector({providers:[N.yL,N.nk,N.mz,{provide:p.Gp,useClass:He,multi:!0},{provide:p.Gp,useClass:ft,multi:!0},{provide:p.Gp,useClass:mt,multi:!0},{provide:p.Gp,useClass:Ct,multi:!0},{provide:p.Gp,useClass:vt,multi:!0},{provide:p.Gp,useClass:ht,multi:!0},{provide:p.Gp,useClass:Pt,multi:!0},{provide:p.Gp,useClass:wt,multi:!0},{provide:p.Gp,useClass:gt,multi:!0},{provide:p.Gp,useClass:yt,multi:!0},{provide:p.Gp,useClass:dt,multi:!0},{provide:p.Gp,useClass:_t,multi:!0},{provide:p.Gp,useClass:Rt,multi:!0},{provide:p.Gp,useClass:at,multi:!0},{provide:p.Gp,useClass:ut,multi:!0},Ve,le,{provide:p.Gp,useClass:Tt,multi:!0},{provide:p.Gp,useClass:st,multi:!0},{provide:p.Gp,useClass:lt,multi:!0},{provide:p.Gp,useClass:pt,multi:!0},{provide:p.Gp,useClass:At,multi:!0},{provide:p.Gp,useClass:bt,multi:!0},{provide:p.Gp,useClass:Nt,multi:!0},{provide:p.Gp,useClass:It,multi:!0},{provide:p.Gp,useClass:St,multi:!0},{provide:p.Gp,useClass:Ft,multi:!0},{provide:p.Gp,useClass:Dt,multi:!0}],imports:[[I.CommonModule]]}),n})();(function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope(de,{imports:[I.CommonModule]})})();class G extends u.BaseRequest{}class Ge extends G{}let Ue=class extends G{};Ue=(0,y.gn)([(0,u.CrtRequest)({type:"crt.FolderTreeActiveFolderChangedRequest"})],Ue);let ce=class extends u.BaseRequestHandler{constructor(o){super(),this._folderTreeUserProfileService=o.get(A.I1V)}_isNeedSaveToProfile(o){const e=o.$context,{activeFolderIdAttrName:t}=(0,v.E_N)(o.folderTreeName);return e.attributes[t]!==o.id}handle(o){var e=this;return(0,f.Z)(function*(){var t,r,i,a;e._isNeedSaveToProfile(o)&&(yield e._folderTreeUserProfileService.setFolderTreeSelectedNode(o.folderTreeName,o.id,o.isFavorite));const s=(0,v.E_N)(o.folderTreeName),l=o.$context;return(0,g.lastValueFrom)(l.setValue({[(t=o.activeFolderIdAttrName)!==null&&t!==void 0?t:s.activeFolderIdAttrName]:o.id,[(r=o.activeFolderNameAttrName)!==null&&r!==void 0?r:s.activeFolderNameAttrName]:o.name,[(i=o.activeFolderFilterAttrName)!==null&&i!==void 0?i:s.activeFolderFilterAttrName]:o.filterData,[(a=o.activeFolderFavoriteStateAttrName)!==null&&a!==void 0?a:s.activeFolderFavoriteStateAttrName]:o.isFavorite}),{defaultValue:null})})()}};ce=(0,y.gn)([(0,u.CrtRequestHandler)({type:"crt.FolderTreeActiveFolderChangedHandler",requestType:"crt.FolderTreeActiveFolderChangedRequest"}),(0,y.w6)("design:paramtypes",[c.Injector])],ce);var ue=S(23664),fe=S(54882),Mt=S(48831);let re=(()=>{class n{constructor(e,t){this._ngZone=e,this._dialogService=t}reloadMainDs(e,t){const r=e.getBoundDataSourceNameByAttributePath(t.itemsAttrName);return e.load(r,[],{loadType:v.BDN.Reload})}reloadFavoritesDs(e,t){const r=e.$context;if(e.reloadFavorites){const i=r.getBoundDataSourceNameByAttributePath(t.favoriteItemsAttrName);return r.load(i,[],{loadType:v.BDN.Reload})}return(0,g.of)({})}handle(e,t,r){const i=t.$context,a=(0,v.E_N)(t.folderTreeName);return(0,g.lastValueFrom)(e.pipe((0,fe.z)(()=>(0,g.concat)([this.reloadMainDs(i,a),this.reloadFavoritesDs(t,a)])),(0,Mt.u)(),(0,T.K)(s=>this.handleError(s,t,r))),{defaultValue:null})}handleError(e,t,r){var i=this;const a=t.$context,s=(0,v.E_N)(t.folderTreeName);return this._ngZone.run(()=>this._dialogService.openInfoDialog(e.message||e.errorInfo.message)).subscribe({next:function(){var l=(0,f.Z)(function*(){yield r?.process({type:"crt.FolderTreeActiveFolderChangedRequest",folderTreeName:t.folderTreeName,$context:t.$context}),yield(0,g.lastValueFrom)(i.reloadMainDs(a,s),{defaultValue:null}),yield(0,g.lastValueFrom)(i.reloadFavoritesDs(t,s),{defaultValue:null})});return function(){return l.apply(this,arguments)}}()}),(0,g.of)({})}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(c.NgZone),c.\u0275\u0275inject(ue.xA))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();class je extends u.BaseRequestHandler{constructor(o){super(),this.modelRequestService=o.get(re)}insertModel(o){return(0,f.Z)(function*(){return(yield(0,g.lastValueFrom)(p.Hn.create(o.sourceSchemaName))).insert({Id:o.folderId,Name:o.folderName,EntitySchemaName:o.rootSchemaName,Parent:o.parentId,FilterData:o.filterData})})()}}let Ze=class extends Ge{};Ze=(0,y.gn)([(0,u.CrtRequest)({type:"crt.AddFolderDataRequest"})],Ze);let U=class extends je{constructor(o){super(o)}handle(o){var e=this;return(0,f.Z)(function*(){const t=o.$context,r=(0,v.E_N)(o.folderTreeName).itemsAttrName,i=t.getBoundDataSourceNameByAttributePath(r);return(0,g.lastValueFrom)((yield e.insertModel(o)).pipe((0,Y.w)(()=>t.load(i,[],{loadType:v.BDN.Reload})),(0,T.K)(a=>e.modelRequestService.handleError(a,o,e.handlerChain))),{defaultValue:null})})()}};U.\u0275fac=function(o){return new(o||U)(c.\u0275\u0275inject(c.Injector))},U.\u0275prov=c.\u0275\u0275defineInjectable({token:U,factory:U.\u0275fac,providedIn:"any"}),U=(0,y.gn)([(0,u.CrtRequestHandler)({type:"crt.FolderTreeAddFolderDataHandler",requestType:"crt.AddFolderDataRequest"}),(0,y.w6)("design:paramtypes",[c.Injector])],U);let ke=class extends Ge{};ke=(0,y.gn)([(0,u.CrtRequest)({type:"crt.CopyFolderDataRequest"})],ke);let j=class extends je{constructor(o){super(o),this._rightsService=o.get(b._h)}handle(o){var e=this;return(0,f.Z)(function*(){const t=o.$context,r=(0,v.E_N)(o.folderTreeName).itemsAttrName,i=t.getBoundDataSourceNameByAttributePath(r);return(0,g.lastValueFrom)((yield e.insertModel(o)).pipe((0,Y.w)(()=>o.copyRights&&o.folderId?e._rightsService.copyRights({schemaName:o.sourceSchemaName,sourceId:o.sourceId,targetId:o.folderId,options:{overwrite:!1}}):(0,g.of)({})),(0,Y.w)(()=>t.load(i,[],{loadType:v.BDN.Reload})),(0,T.K)(a=>e.modelRequestService.handleError(a,o,e.handlerChain))),{defaultValue:null})})()}};j.\u0275fac=function(o){return new(o||j)(c.\u0275\u0275inject(c.Injector))},j.\u0275prov=c.\u0275\u0275defineInjectable({token:j,factory:j.\u0275fac}),j=(0,y.gn)([(0,u.CrtRequestHandler)({type:"crt.FolderTreeCopyFolderDataHandler",requestType:"crt.CopyFolderDataRequest"}),(0,y.w6)("design:paramtypes",[c.Injector])],j);let Oe=class extends G{};Oe=(0,y.gn)([(0,u.CrtRequest)({type:"crt.DeleteFolderDataRequest"})],Oe);let me=class extends u.BaseRequestHandler{constructor(o){super(),this._modelRequestService=o.get(re)}handle(o){var e=this;return(0,f.Z)(function*(){const r=o.$context.delete(o.dataSourceName,[{type:u.ModelParameterType.PrimaryColumnValue,value:o.folderId}]);return e._modelRequestService.handle(r,o)})()}};me=(0,y.gn)([(0,u.CrtRequestHandler)({type:"crt.FolderTreeDeleteFolderDataHandler",requestType:"crt.DeleteFolderDataRequest"}),(0,y.w6)("design:paramtypes",[c.Injector])],me);let We=class extends G{};We=(0,y.gn)([(0,u.CrtRequest)({type:"crt.FolderTreeExpandedItemsRequest"})],We);let pe=class extends u.BaseRequestHandler{constructor(o){super(),this._folderTreeUserProfileService=o.get(A.I1V)}handle(o){var e=this;return(0,f.Z)(function*(){yield e._folderTreeUserProfileService.setFolderTreeExpandedItems(o.folderTreeName,o.expandedItems);const t=(0,v.E_N)(o.folderTreeName),r=o.$context;return(0,g.firstValueFrom)(r.setValue({[t.expandedItemsAttrName]:o.expandedItems}))})()}};pe=(0,y.gn)([(0,u.CrtRequestHandler)({type:"crt.FolderTreeExpandedItemsHandler",requestType:"crt.FolderTreeExpandedItemsRequest"}),(0,y.w6)("design:paramtypes",[c.Injector])],pe);let Xe=class extends G{};Xe=(0,y.gn)([(0,u.CrtRequest)({type:"crt.FolderTreeRenameRequest"})],Xe);let ge=class extends u.BaseRequestHandler{constructor(o){super(),this._modelRequestService=o.get(re)}handle(o){var e=this;return(0,f.Z)(function*(){const r=(yield(0,g.lastValueFrom)(p.Hn.create(o.sourceSchemaName))).update({Name:o.folderName},[{type:u.ModelParameterType.PrimaryColumnValue,value:o.folderId}]);return e._modelRequestService.handle(r,o,e.handlerChain)})()}};ge=(0,y.gn)([(0,u.CrtRequestHandler)({type:"crt.FolderTreeRenameHandler",requestType:"crt.FolderTreeRenameRequest"}),(0,y.w6)("design:paramtypes",[c.Injector])],ge);let ze=class extends G{};ze=(0,y.gn)([(0,u.CrtRequest)({type:"crt.ToggleFolderFavoriteRequest"})],ze);let ve=class extends u.BaseRequestHandler{handle(o){return(0,f.Z)(function*(){const e=o.$context,t=yield(0,g.lastValueFrom)(p.Hn.create("FolderTreeFavorite")),r=(0,v.E_N)(o.folderTreeName),i=e.getBoundDataSourceNameByAttributePath(r.favoriteItemsAttrName),a=(0,fe.z)(()=>e.load(i,[],{loadType:v.BDN.Reload}));return o.status?(0,g.lastValueFrom)(t.insert({FolderTree:o.id,EntitySchemaName:o.rootSchemaName}).pipe(a)):(0,g.lastValueFrom)(t.delete([{type:u.ModelParameterType.PrimaryColumnValue,value:o.favoriteId}]).pipe(a))})()}};ve=(0,y.gn)([(0,u.CrtRequestHandler)({type:"crt.ToggleFolderFavoriteHandler",requestType:"crt.ToggleFolderFavoriteRequest"})],ve);let Je=class extends G{};Je=(0,y.gn)([(0,u.CrtRequest)({type:"crt.FolderTreeUpdateFiltersRequest"})],Je);let he=class extends u.BaseRequestHandler{constructor(o){super(),this._modelRequestService=o.get(re)}handle(o){var e=this;return(0,f.Z)(function*(){const r=(yield(0,g.lastValueFrom)(p.Hn.create(o.sourceSchemaName))).update({FilterData:o.filterData},[{type:u.ModelParameterType.PrimaryColumnValue,value:o.folderId}]);return e._modelRequestService.handle(r,o)})()}};he=(0,y.gn)([(0,u.CrtRequestHandler)({type:"crt.FolderTreeUpdateFiltersHandler",requestType:"crt.FolderTreeUpdateFiltersRequest"}),(0,y.w6)("design:paramtypes",[c.Injector])],he);let Ke=class extends G{};Ke=(0,y.gn)([(0,u.CrtRequest)({type:"crt.FolderTreeVisibleRequest"})],Ke);let ye=class extends u.BaseRequestHandler{constructor(o){super(),this._folderTreeUserProfileService=o.get(A.I1V)}handle(o){var e=this;return(0,f.Z)(function*(){const t=(0,v.E_N)(o.folderTreeName),r=o.$context;yield e._folderTreeUserProfileService.setFolderTreeVisibleState(o.folderTreeName,o.visible);const i=r.setValue({[t.visibleAttrName]:o.visible});if(o.visible){const a=r.getBoundDataSourceNameByAttributePath(t.itemsAttrName),s=(0,fe.z)(()=>r.load(a,[],{loadType:v.BDN.Reload}));return(0,g.lastValueFrom)(i.pipe(s),{defaultValue:null})}return(0,g.lastValueFrom)(i,{defaultValue:null})})()}};ye=(0,y.gn)([(0,u.CrtRequestHandler)({type:"crt.FolderTreeVisibleHandler",requestType:"crt.FolderTreeVisibleRequest"}),(0,y.w6)("design:paramtypes",[c.Injector])],ye);let E=class{};E.\u0275fac=function(o){return new(o||E)},E.\u0275mod=c.\u0275\u0275defineNgModule({type:E}),E.\u0275inj=c.\u0275\u0275defineInjector({providers:[A.I1V],imports:[[I.CommonModule]]}),E=(0,y.gn)([(0,u.CrtModule)({requestHandlers:[ce,U,me,pe,ge,ve,he,ye,j]})],E),function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope(E,{imports:[I.CommonModule]})}();var O=S(2792),Vt=S(49457);let Ye=class extends u.BaseRequest{};Ye=(0,y.gn)([(0,u.CrtRequest)({type:"crt.LoadSamlMetadataRequest"})],Ye);let Ce=class extends u.BaseRequestHandler{constructor(o){super(),this.httpClient=o,this._samlMetadataUrl="/rest/SsoActionsService/GetSamlMetadata"}handle(o){var e=this;return(0,f.Z)(function*(){var t;return e.httpClient.get(e._samlMetadataUrl,{responseType:"text"}).pipe((0,V.U)(r=>{const i="creatio_saml_metadata.xml",a=new Blob([r],{type:"application/xml"});Vt.saveAs(a,i,{autoBom:!1})})).subscribe(),(t=e.next)===null||t===void 0?void 0:t.handle(o)})()}};Ce=(0,y.gn)([(0,u.CrtRequestHandler)({type:"crt.LoadSamlMetadataHandler",requestType:"crt.LoadSamlMetadataRequest",scopes:["CustomIdpSettingsForm"]}),(0,y.w6)("design:paramtypes",[w.HttpClient])],Ce);let Se=class extends u.BaseRequestHandler{_tryUpdateSamlEndpoints(o){var e=this;return(0,f.Z)(function*(){if(o.attributeName!=="AdfsUrl")return;const t=yield o.$context.AdfsUrl;o.oldValue!==t&&e._setSamlEndpoints(o,t)})()}_tryUpdateAdfsUrl(o){return(0,f.Z)(function*(){if(o.attributeName!=="PartnerIdentityName")return;const e=yield o.$context.AdfsUrl,t=yield o.$context.PartnerIdentityName;!e&&t&&(o.$context.AdfsUrl=new URL(t).host)})()}_setSamlEndpoints(o,e){o.$context.PartnerIdentityName=`http://${e}/adfs/services/trust`;const t=`https://${e}/adfs/ls`;o.$context.SingleLogoutServiceUrl=t,o.$context.SingleSignOnServiceUrl=t}handle(o){var e=this;return(0,f.Z)(function*(){var t;return yield e._tryUpdateSamlEndpoints(o),yield e._tryUpdateAdfsUrl(o),(t=e.next)===null||t===void 0?void 0:t.handle(o)})()}};Se=(0,y.gn)([(0,u.CrtRequestHandler)({type:"crt.AdfsUrlChangeHandler",requestType:"crt.HandleViewModelAttributeChangeRequest",scopes:["AdfsSettingsForm"]})],Se);var Et=S(5185);let Qe=class extends u.BaseRequest{};Qe=(0,y.gn)([(0,u.CrtRequest)({type:"crt.SsoHelperLinkRequest"})],Qe);let _e=class extends u.BaseRequestHandler{constructor(o,e){super(),this._window=o,this._academyHelpUrlService=e}_getAcademyHelpUrl(o){return this._academyHelpUrlService.getAcademyHelpUrl(o)}_openUrl(o){!o||this._window.open(o,"_blank")}handle(o){var e=this;return(0,f.Z)(function*(){var t;const r=o.contextHelpCode;return r&&e._getAcademyHelpUrl(r).subscribe(i=>e._openUrl(i)),(t=e.next)===null||t===void 0?void 0:t.handle(o)})()}};_e=(0,y.gn)([(0,u.CrtRequestHandler)({type:"crt.SsoHelperLinkHandler",requestType:"crt.SsoHelperLinkRequest",scopes:["SsoSettings"]}),(0,y.fM)(0,(0,u.CrtInject)(v.SCh)),(0,y.w6)("design:paramtypes",[Window,Et.C])],_e);var be=S(34349),et=S(33569);let tt=(()=>{class n{getEntity(e){const t=e;return{id:t.Id,ssoIdentityProvider:(0,et.Z)(t.SsoIdentityProvider)?null:t.SsoIdentityProvider,useJit:t.UseJit}}getEntityColumns(e){return[new v._H7("Id",e.id,u.DataValueType.Guid),new v._H7("SsoIdentityProvider",e.ssoIdentityProvider,u.DataValueType.Lookup),new v._H7("UseJit",e.useJit,u.DataValueType.Boolean),new v._H7("Name",e.name,u.DataValueType.Text),new v._H7("AssertionConsumerServiceUrl",e.assertionConsumerServiceUrl,u.DataValueType.Text),new v._H7("SingleLogoutServiceUrl",e.singleLogoutServiceUrl,u.DataValueType.Text)]}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"any"}),n})(),Fe=(()=>{class n extends be.UE{constructor(e,t,r){super(e,t,r),this.entitySchemaName="SsoServiceProvider"}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(be.oq),c.\u0275\u0275inject(_.sK),c.\u0275\u0275inject(tt))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"any"}),n})(),rt=(()=>{class n{constructor(e){this.queryExecutor=e}isUniqueIdpName(e,t){const r=new u.EntitySchemaQuery("SsoIdentityProvider");return r.addAggregationFunctionColumn("Id",u.AggregationType.Count,"Count"),r.filters.addSchemaColumnFilterWithParameter(u.ComparisonType.Equal,"Name",e),r.filters.addSchemaColumnFilterWithParameter(u.ComparisonType.Not_equal,"Id",t),this.queryExecutor.executeSelectQuery(r).pipe((0,V.U)(i=>{if(i&&i.length){const[a]=i;return a.Count===0}return!0}))}}return n.\u0275fac=function(e){return new(e||n)(c.\u0275\u0275inject(be.oq))},n.\u0275prov=c.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"any"}),n})(),De=class extends u.BaseRequestHandler{constructor(o){super(),this.ssoServiceProviderService=o,this._maskDelay=0,this._maskService=new u.MaskService}_setServiceProviderColumns(o,e){o.setValue({SpIdAttribute:e.id},{silent:!0}),o.setValue({SpIdentityProviderAttribute:e.ssoIdentityProvider},{silent:!0}),o.setValue({SpUseJitAttribute:e.useJit},{silent:!0})}handle(o){var e=this;return(0,f.Z)(function*(){const t=o.$context;return e._maskService.showBodyMask({delay:e._maskDelay}),e.ssoServiceProviderService.getItems().subscribe(r=>{var i;if(e._maskService.hideBodyMask(),r.success&&r.result.length){const[a]=r.result;e._setServiceProviderColumns(t,a)}return(i=e.next)===null||i===void 0?void 0:i.handle(o)})})()}};De=(0,y.gn)([(0,u.CrtRequestHandler)({type:"crt.LoadSpDataHandler",requestType:"crt.HandleViewModelInitRequest",scopes:["SsoSettings"]}),(0,y.w6)("design:paramtypes",[Fe])],De);let it=class extends u.BaseRequest{};it=(0,y.gn)([(0,u.CrtRequest)({type:"crt.SaveSpDataRequest"})],it);let Ne=class extends u.BaseRequestHandler{constructor(o,e){super(),this.ssoServiceProviderService=o,this._dialogService=e,this._maskDelay=0,this._ssoLoginEndpoint="/ServiceModel/AuthService.svc/SsoLogin",this._ssoLogoutEndpoint="/ServiceModel/AuthService.svc/SsoLogout",this._maskService=new u.MaskService}_getSiteOriginUrl(){return(0,v.MAR)().replace("/0/","").replace(new RegExp("/$"),"")}_onSavedSpData(o,e){var t=this;return(0,f.Z)(function*(){var r;return t._maskService.hideBodyMask(),o?.success?e.$context.IsSpChanged=!1:o?.success===!1&&o?.errorInfo&&t._dialogService.openInfoDialog(o?.errorInfo.message),(r=t.next)===null||r===void 0?void 0:r.handle(e)})()}handle(o){var e=this;return(0,f.Z)(function*(){const t=o.$context,r=e._getSiteOriginUrl(),i=yield t.SpIdentityProviderAttribute,a={id:yield t.SpIdAttribute,ssoIdentityProvider:i||null,useJit:yield t.SpUseJitAttribute,name:r,assertionConsumerServiceUrl:r+e._ssoLoginEndpoint,singleLogoutServiceUrl:r+e._ssoLogoutEndpoint};return e._maskService.showBodyMask({delay:e._maskDelay}),a.id?e.ssoServiceProviderService.updateItem(a).subscribe(s=>e._onSavedSpData(s,o)):(a.id=(0,u.generateGuid)(),t.SpIdAttribute=a.id,e.ssoServiceProviderService.insertItem(a).subscribe(s=>e._onSavedSpData(s,o)))})()}};Ne=(0,y.gn)([(0,u.CrtRequestHandler)({type:"crt.SaveSpDataHandler",requestType:"crt.SaveSpDataRequest",scopes:["SsoSettings"]}),(0,y.w6)("design:paramtypes",[Fe,ue.xA])],Ne);let we=class extends u.BaseRequestHandler{constructor(){super(...arguments),this._listeningColumns=["SpUseJitAttribute","SpIdentityProviderAttribute"]}handle(o){var e=this;return(0,f.Z)(function*(){var t;const r=o.$context;!o.silent&&e._listeningColumns.includes(o.attributeName)&&(r.IsSpChanged=!0);const i=yield r.IsSpChanged,a=yield r.SpIdentityProviderAttribute;return r.IsTestSsoVisible=!i&&!(0,et.Z)(a),(t=e.next)===null||t===void 0?void 0:t.handle(o)})()}};we=(0,y.gn)([(0,u.CrtRequestHandler)({type:"crt.SpDataChangeHandler",requestType:"crt.HandleViewModelAttributeChangeRequest",scopes:["SsoSettings"]})],we);let Pe=class extends u.BaseRequestHandler{_tryUpdateDisplayName(o){return(0,f.Z)(function*(){if(yield o.$context.DisplayName)return;const t=yield o.$context.Type,r=yield o.$context.PartnerIdentityName;if(t&&r){const i=new URL(r).host;o.$context.DisplayName=`${i} (${t.displayValue})`}})()}handle(o){var e=this;return(0,f.Z)(function*(){var t;return yield e._tryUpdateDisplayName(o),(t=e.next)===null||t===void 0?void 0:t.handle(o)})()}};Pe=(0,y.gn)([(0,u.CrtRequestHandler)({type:"crt.IdpNameChangeHandler",requestType:"crt.SaveRecordRequest",scopes:["CustomIdpSettingsForm"]})],Pe);let ot=class extends u.BaseRequest{};ot=(0,y.gn)([(0,u.CrtRequest)({type:"crt.TestSsoRequest"})],ot);let Ae=class extends u.BaseRequestHandler{constructor(o){super(),this._window=o,this._startSsoEndpoint="/ServiceModel/AuthService.svc/StartSsoLogin",this._returnUrlHashParameterName="ReturnUrlHash",this._partnerIdpParameterName="partnerIdp",this._maskDelay=0,this._maskService=new u.MaskService}_openUrl(o){this._window.open(o.href,"self")}_getSsoLoginUrl(o){const t=this._window.location.hash.replace("#",""),r=(0,v.MAR)().replace("/0/","").replace(new RegExp("/$"),""),i=new URL(r+this._startSsoEndpoint);return i.searchParams.append(this._partnerIdpParameterName,o),t&&i.searchParams.append(this._returnUrlHashParameterName,t),i}_startSsoLogin(o){const e=this._getSsoLoginUrl(o);this._openUrl(e),this._maskService.hideBodyMask()}handle(o){var e=this;return(0,f.Z)(function*(){var t;const r=yield o.$context.SpIdentityProviderAttribute;return r&&r.value&&(e._maskService.showBodyMask({delay:e._maskDelay}),e._startSsoLogin(r.value)),(t=e.next)===null||t===void 0?void 0:t.handle(o)})()}};Ae=(0,y.gn)([(0,u.CrtRequestHandler)({type:"crt.TestSsoHandler",requestType:"crt.TestSsoRequest",scopes:["SsoSettings"]}),(0,y.fM)(0,(0,u.CrtInject)(v.SCh)),(0,y.w6)("design:paramtypes",[Window])],Ae);let ie=class extends u.BaseRequestHandler{_getEntitySchemaName(o){var e,t;const r=this._getDataSourceName(o),i=(t=(e=o.$context.dataSchemas[r])===null||e===void 0?void 0:e.dataSourceConfig)===null||t===void 0?void 0:t.config;return i?.entitySchemaName}_getDataSourceName(o){return o.$context.getBoundDataSourceName(o.itemsAttributeName)}handle(o){var e=this;return(0,f.Z)(function*(){var t;const r=e._getEntitySchemaName(o);if(r==="SAMLFieldNameConverter"){const i={type:"crt.7XRequest",action:"OpenLookupSource",$context:o.$context,payload:{entitySchemaName:r}};return e.handlerChain.process(i)}else return(t=e.next)===null||t===void 0?void 0:t.handle(o)})()}};ie=(0,y.gn)([(0,u.CrtRequestHandler)({type:"crt.SamlDataGridRowDoubleClickHandler",requestType:"crt.DataGridRowDoubleClickRequest",scopes:["SsoSettings"]})],ie);let $=class extends ie{handle(o){var e=()=>super.handle,t=this;return(0,f.Z)(function*(){var r;return o.itemsAttributeName==="DataGrid_SamlAttributes"?e().call(t,o):(r=t.next)===null||r===void 0?void 0:r.handle(o)})()}};$.\u0275fac=function(){let n;return function(e){return(n||(n=c.\u0275\u0275getInheritedFactory($)))(e||$)}}(),$.\u0275prov=c.\u0275\u0275defineInjectable({token:$,factory:$.\u0275fac,providedIn:"any"}),$=(0,y.gn)([(0,u.CrtRequestHandler)({type:"crt.OpenSamlDataGridRowHandler",requestType:"crt.UpdateRecordRequest",scopes:["BasePageTemplate","BaseGridSectionTemplate"]})],$);let Ie=class extends u.BaseRequestHandler{constructor(o,e,t){super(),this._dialogService=o,this._service=e,this._translateService=t,this._duplicateErrorMessageCode="SsoSettings.SsoIdentityProvider.DuplicationError"}_showErrorMsg(){const o=this._translateService.instant(this._duplicateErrorMessageCode);this._dialogService.openInfoDialog(o)}handle(o){var e=this;return(0,f.Z)(function*(){const t=o.$context,r=yield t.PartnerIdentityName,i=yield t.Id;return e._service.isUniqueIdpName(r,i).subscribe(a=>{var s;return a?(s=e.next)===null||s===void 0?void 0:s.handle(o):e._showErrorMsg()})})()}};Ie=(0,y.gn)([(0,u.CrtRequestHandler)({type:"crt.IdpSaveValidationHandler",requestType:"crt.SaveRecordRequest",scopes:["CustomIdpSettingsForm"]}),(0,y.w6)("design:paramtypes",[ue.xA,rt,_.sK])],Ie);let Re=class extends p.nd{constructor(){super(...arguments),this.i18nMessageKey="SsoSettings.Validators.AdfsTenant.Message",this.async=!1}validate(o,e){const t=super.validate(o);return t||(o.value.trim().startsWith("http")?{required:this.defaultValidationError(e)}:null)}};Re=(0,y.gn)([(0,u.CrtValidator)({type:"crt.AdfsTenantValidator"})],Re);let Te=class extends p.nd{constructor(){super(...arguments),this.i18nMessageKey="SsoSettings.Validators.StringUrl.Message",this.async=!1}validate(o,e){const t=super.validate(o);if(t)return t;const r=o.value;try{new URL(r)}catch{return{required:this.defaultValidationError(e)}}return null}};Te=(0,y.gn)([(0,u.CrtValidator)({type:"crt.StringUrlValidator"})],Te);let B=class{};B.\u0275fac=function(o){return new(o||B)},B.\u0275mod=c.\u0275\u0275defineNgModule({type:B}),B.\u0275inj=c.\u0275\u0275defineInjector({providers:[Fe,tt,rt],imports:[[I.CommonModule,w.HttpClientModule]]}),B=(0,y.gn)([(0,u.CrtModule)({requestHandlers:[Ce,Se,_e,De,Ne,we,Ae,Pe,Ie,ie,$],validators:[Re,Te]})],B),function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope(B,{imports:[I.CommonModule,w.HttpClientModule]})}();var xt=S(92826),H=S(73068),Me;function $t(n,o){return(0,f.Z)(function*(){yield(0,g.lastValueFrom)(n.loadCurrentUserInfo().pipe((0,Y.w)(e=>{var t,r;return o.use((r=(t=e?.userInfo)===null||t===void 0?void 0:t.cultureInfo)===null||r===void 0?void 0:r.sysCultureName).pipe((0,T.K)(()=>(0,g.of)(null)))})),{defaultValue:null})})}let x=Me=class{constructor(o,e){this._customElementsBootstrapService=o,this._injector=e}ngDoBootstrap(){(0,u.bootstrapCrtModule)(Me,{moduleType:"host",resolveDependency:o=>this._injector.get(o)}),this._customElementsBootstrapService.defineComponent("crt-home-page-component",O.HomePageComponent),this._customElementsBootstrapService.defineComponent("crt-card-component",O.CardComponent),this._customElementsBootstrapService.defineComponent("crt-section-component",O.SectionComponent),this._customElementsBootstrapService.defineComponent("crt-page-component",O.PageComponent),this._customElementsBootstrapService.defineComponent("crt-chart-widget-component",H.hd),this._customElementsBootstrapService.defineComponent("crt-indicator-widget-component",H.$o),this._customElementsBootstrapService.defineComponent("crt-gauge-widget-component",H.fs),this._customElementsBootstrapService.defineComponent("crt-funnel-widget-component",H.yy),this._customElementsBootstrapService.defineComponent("crt-full-pipeline-widget-component",H.Cg)}};x.\u0275fac=function(o){return new(o||x)(c.\u0275\u0275inject(v.os7),c.\u0275\u0275inject(c.Injector))},x.\u0275mod=c.\u0275\u0275defineNgModule({type:x}),x.\u0275inj=c.\u0275\u0275defineInjector({providers:[{provide:I.APP_BASE_HREF,useValue:"/"},{provide:w.HTTP_INTERCEPTORS,useClass:v.H09,multi:!0},{provide:c.APP_INITIALIZER,useFactory:$t,deps:[v.$CV,_.sK],multi:!0},{provide:xt.Xj,useValue:[A.MV_,A.E2s,H.iu,H.Lr,H.xC,H.Io,J.kLW]}],imports:[[k.PW,X.BrowserModule,I.CommonModule,J.kLW,de,O.SchemaViewModule,w.HttpClientModule,E,w.HttpClientXsrfModule.withOptions({cookieName:"BPMCSRF",headerName:"BPMCSRF"}),_.aw.forRoot({defaultLanguage:"en-US",loader:{provide:_.Zw,useFactory:(n,o)=>new F.w(n,o+"ClientApp/assets/i18n/"),deps:[w.HttpClient,I.APP_BASE_HREF]}})]]}),x=Me=(0,y.gn)([(0,u.CrtModule)({includes:[O.SchemaViewModule,J.kLW,E,B]}),(0,y.w6)("design:paramtypes",[v.os7,c.Injector])],x),function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope(x,{imports:[k.PW,X.BrowserModule,I.CommonModule,J.kLW,de,O.SchemaViewModule,w.HttpClientModule,E,w.HttpClientXsrfModule,_.aw]})}(),(0,u.bootstrapCrtModuleHandlerChainServices)(x),X.platformBrowser().bootstrapModule(x).catch(n=>console.error(n))},49457:function(ne,ae){var S,X,ee;(function(u,f){X=[],S=f,ee=typeof S=="function"?S.apply(ae,X):S,ee!==void 0&&(ne.exports=ee)})(this,function(){"use strict";function u(_,F){return typeof F>"u"?F={autoBom:!1}:typeof F!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),F={autoBom:!F}),F.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(_.type)?new Blob(["\uFEFF",_],{type:_.type}):_}function f(_,F,N){var p=new XMLHttpRequest;p.open("GET",_),p.responseType="blob",p.onload=function(){k(p.response,F,N)},p.onerror=function(){console.error("could not download file")},p.send()}function y(_){var F=new XMLHttpRequest;F.open("HEAD",_,!1);try{F.send()}catch{}return 200<=F.status&&299>=F.status}function I(_){try{_.dispatchEvent(new MouseEvent("click"))}catch{var F=document.createEvent("MouseEvents");F.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),_.dispatchEvent(F)}}var w=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof global=="object"&&global.global===global?global:void 0,c=w.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),k=w.saveAs||(typeof window!="object"||window!==w?function(){}:"download"in HTMLAnchorElement.prototype&&!c?function(_,F,N){var p=w.URL||w.webkitURL,b=document.createElement("a");F=F||_.name||"download",b.download=F,b.rel="noopener",typeof _=="string"?(b.href=_,b.origin===location.origin?I(b):y(b.href)?f(_,F,N):I(b,b.target="_blank")):(b.href=p.createObjectURL(_),setTimeout(function(){p.revokeObjectURL(b.href)},4e4),setTimeout(function(){I(b)},0))}:"msSaveOrOpenBlob"in navigator?function(_,F,N){if(F=F||_.name||"download",typeof _!="string")navigator.msSaveOrOpenBlob(u(_,N),F);else if(y(_))f(_,F,N);else{var p=document.createElement("a");p.href=_,p.target="_blank",setTimeout(function(){I(p)})}}:function(_,F,N,p){if(p=p||open("","_blank"),p&&(p.document.title=p.document.body.innerText="downloading..."),typeof _=="string")return f(_,F,N);var b=_.type==="application/octet-stream",A=/constructor/i.test(w.HTMLElement)||w.safari,v=/CriOS\/[\d]+/.test(navigator.userAgent);if((v||b&&A||c)&&typeof FileReader<"u"){var g=new FileReader;g.onloadend=function(){var T=g.result;T=v?T:T.replace(/^data:[^;]*;/,"data:attachment/file;"),p?p.location.href=T:location=T,p=null},g.readAsDataURL(_)}else{var te=w.URL||w.webkitURL,V=te.createObjectURL(_);p?p.location=V:location.href=V,p=null,setTimeout(function(){te.revokeObjectURL(V)},4e4)}});w.saveAs=k.saveAs=k,ne.exports=k})}}]);
